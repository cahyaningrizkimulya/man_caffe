<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MAN CAFE - Tempat Nongki Asik</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <!-- SUPABASE JS -->
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <script>
        // CONFIGURASI SUPABASE
        const SUPABASE_URL = 'https://cuwtyfggfgykgjhrvdgi.supabase.co';
        const SUPABASE_ANON_KEY = 'sb_publishable_4e-uWWuKR2r7_jNaWHh03A_2UVQbPAx';
        
        // Inisialisasi Supabase client
        const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY, {
            auth: {
                autoRefreshToken: true,
                persistSession: true,
                detectSessionInUrl: false
            },
            db: {
                schema: 'public'
            },
            realtime: {
                params: {
                    eventsPerSecond: 10
                }
            }
        });
        
        // Export untuk digunakan di file lain
        window.supabaseClient = supabaseClient;
        console.log('✅ Supabase client initialized');
    </script>
    <style>
        /* ==================== VARIABLES ==================== */
        :root {
            --primary-color: #8B4513;
            --primary-light: #A0522D;
            --primary-dark: #5D2906;
            --secondary-color: #D2691E;
            --accent-color: #FFD700;
            --dark-color: #2C3E50;
            --light-color: #F8F9FA;
            --success-color: #28a745;
            --warning-color: #ffc107;
            --danger-color: #dc3545;
            --info-color: #17a2b8;
            --border-radius: 12px;
            --shadow: 0 6px 20px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
        }

        /* ==================== RESET & BASE ==================== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            -webkit-text-size-adjust: 100%;
            -ms-text-size-adjust: 100%;
        }

        body {
            font-family: 'Poppins', sans-serif;
            line-height: 1.6;
            color: #333;
            background: #fff;
            overflow-x: hidden;
            min-width: 320px;
        }

        .container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 15px;
        }

        /* ==================== HEADER & NAVIGATION ==================== */
        .header {
            background: white;
            padding: 1rem 0;
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 1000;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            transition: var(--transition);
        }

        .header.scrolled {
            padding: 0.5rem 0;
        }

        .navbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 0.8rem;
            text-decoration: none;
            color: var(--primary-color);
            font-weight: 700;
            font-size: 1.3rem;
        }

        /* ==================== LOGO STYLES ==================== */
        .logo-icon {
            width: 45px;
            height: 45px;
            background: var(--primary-color);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.2rem;
            overflow: hidden;
            border: 2px solid var(--primary-color);
        }

        .logo-icon img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 50%;
        }

        .logo-icon-alt {
            width: 45px;
            height: 45px;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        .logo-icon-alt img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }

        .nav-links {
            display: flex;
            list-style: none;
            gap: 1.5rem;
            align-items: center;
        }

        .nav-links a {
            text-decoration: none;
            color: var(--dark-color);
            font-weight: 500;
            padding: 0.5rem 0.8rem;
            border-radius: 6px;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 0.4rem;
            font-size: 0.95rem;
        }

        .nav-links a:hover,
        .nav-links a.active {
            color: var(--primary-color);
            background: rgba(139, 69, 19, 0.1);
        }

        .hamburger {
            display: none;
            font-size: 1.3rem;
            cursor: pointer;
            color: var(--dark-color);
            background: none;
            border: none;
        }

        /* ==================== BUTTONS ==================== */
        .btn-primary, .btn-secondary {
            padding: 0.9rem 1.8rem;
            border-radius: 50px;
            font-weight: 600;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            transition: var(--transition);
            border: none;
            cursor: pointer;
            font-size: 0.95rem;
        }

        .btn-primary {
            background: var(--accent-color);
            color: var(--dark-color);
        }

        .btn-primary:hover {
            background: #FFC107;
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(255, 193, 7, 0.2);
        }

        .btn-secondary {
            background: transparent;
            color: white;
            border: 2px solid white;
        }

        .btn-secondary:hover {
            background: white;
            color: var(--primary-color);
            transform: translateY(-3px);
        }

        .btn-order {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 0.7rem 1.2rem;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: var(--transition);
            width: 100%;
            justify-content: center;
            font-size: 0.9rem;
        }

        .btn-order:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
        }

        /* ==================== HERO SECTION ==================== */
        .hero {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 150px 0 80px;
            position: relative;
            overflow: hidden;
            min-height: 100vh;
            display: flex;
            align-items: center;
        }

        .hero-content {
            max-width: 600px;
            z-index: 1;
            position: relative;
        }

        .hero h1 {
            font-size: 2.8rem;
            margin-bottom: 1.5rem;
            line-height: 1.2;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        .hero p {
            font-size: 1.1rem;
            margin-bottom: 2rem;
            opacity: 0.9;
        }

        .hero-buttons {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .floating-coffee {
            position: absolute;
            right: 5%;
            top: 50%;
            transform: translateY(-50%);
            animation: float 6s ease-in-out infinite;
        }

        .floating-coffee i {
            font-size: 6rem;
            color: rgba(255, 255, 255, 0.1);
        }

        @keyframes float {
            0%, 100% { transform: translateY(-50%) translateX(0); }
            50% { transform: translateY(-50%) translateX(-15px); }
        }

        /* ==================== SECTIONS ==================== */
        section {
            padding: 80px 0;
        }

        .section-title {
            text-align: center;
            font-size: 2.2rem;
            color: var(--dark-color);
            margin-bottom: 3rem;
            position: relative;
        }

        .section-title::after {
            content: '';
            position: absolute;
            bottom: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 80px;
            height: 4px;
            background: var(--primary-color);
            border-radius: 2px;
        }

        /* ==================== STATS SECTION ==================== */
        .stats-section {
            background: var(--light-color);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1.5rem;
            text-align: center;
        }

        .stat-item h3 {
            font-size: 2.5rem;
            color: var(--primary-color);
            margin-bottom: 0.5rem;
        }

        .stat-item p {
            color: #666;
            font-size: 1rem;
        }

        /* ==================== MENU SECTION ==================== */
        .menu-section {
            background: white;
        }

        .menu-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1.5rem;
            margin-top: 3rem;
        }

        .menu-card {
            background: white;
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: var(--shadow);
            transition: var(--transition);
            position: relative;
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        .menu-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 15px 30px rgba(0,0,0,0.15);
        }

        .menu-card img {
            width: 100%;
            height: 180px;
            object-fit: cover;
            transition: transform 0.5s;
        }

        .menu-card:hover img {
            transform: scale(1.05);
        }

        .menu-info {
            padding: 1.2rem;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
        }

        .menu-info h3 {
            font-size: 1.2rem;
            margin-bottom: 0.5rem;
            color: var(--dark-color);
            line-height: 1.3;
        }

        .description {
            color: #666;
            font-size: 0.85rem;
            margin-bottom: 1rem;
            min-height: 40px;
            flex-grow: 1;
        }

        .price {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--primary-color);
            margin-bottom: 1rem;
        }

        .original-price {
            text-decoration: line-through;
            color: #999;
            font-size: 0.9rem;
            margin-right: 0.5rem;
        }

        .discount-price {
            color: var(--danger-color);
        }

        /* ==================== PROMO BADGES ==================== */
        .promo-badge {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: var(--danger-color);
            color: white;
            padding: 0.3rem 0.6rem;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 600;
            z-index: 2;
        }

        .category-badge {
            position: absolute;
            top: 1rem;
            left: 1rem;
            background: #2196F3;
            color: white;
            padding: 0.3rem 0.6rem;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 600;
            z-index: 2;
        }

        /* ==================== STOCK BADGE ==================== */
        .stock-badge {
            position: absolute;
            bottom: 1rem;
            left: 1rem;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 0.3rem 0.6rem;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 0.3rem;
            z-index: 2;
        }

        .stock-low {
            background: rgba(220, 53, 69, 0.8);
        }

        .stock-empty {
            background: rgba(220, 53, 69, 0.9);
        }

        .out-of-stock {
            opacity: 0.7;
            position: relative;
        }

        .out-of-stock::after {
            content: "STOK HABIS";
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(220, 53, 69, 0.9);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            font-weight: bold;
            font-size: 0.9rem;
            z-index: 3;
        }

        .out-of-stock .btn-order {
            background: #cccccc;
            cursor: not-allowed;
            pointer-events: none;
        }

        .out-of-stock img {
            filter: grayscale(0.7);
        }

        /* ==================== CART SECTION ==================== */
        .cart-section {
            background: var(--light-color);
        }

        .cart-items {
            background: white;
            border-radius: 10px;
            padding: 1.5rem;
            box-shadow: var(--shadow);
        }

        .cart-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 0;
            border-bottom: 1px solid #eee;
        }

        .cart-item:last-child {
            border-bottom: none;
        }

        .cart-total {
            text-align: right;
            margin-top: 1.5rem;
            font-size: 1.3rem;
            font-weight: bold;
            color: var(--primary-color);
        }

        .quantity-control {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .quantity-btn {
            width: 28px;
            height: 28px;
            border: none;
            background: #f0f0f0;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9rem;
            transition: background 0.3s;
        }

        .quantity-btn:hover {
            background: #e0e0e0;
        }

        /* ==================== ORDERS SECTION ==================== */
        .orders-section {
            background: var(--light-color);
        }

        .orders-tabs {
            display: flex;
            gap: 0.8rem;
            margin-bottom: 2rem;
            border-bottom: 2px solid #eee;
            padding-bottom: 1rem;
            flex-wrap: wrap;
            justify-content: center;
        }

        .tab-btn {
            padding: 0.7rem 1.2rem;
            background: none;
            border: none;
            border-radius: 6px;
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            color: #666;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .tab-btn.active {
            background: var(--primary-color);
            color: white;
        }

        .tab-btn:hover:not(.active) {
            background: #f0f0f0;
        }

        .order-card {
            background: white;
            border-radius: 10px;
            padding: 1.2rem;
            margin-bottom: 1.5rem;
            box-shadow: var(--shadow);
            transition: transform 0.3s;
        }

        .order-card:hover {
            transform: translateY(-2px);
        }

        .order-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid #eee;
            flex-wrap: wrap;
        }

        .order-number {
            font-weight: 600;
            color: var(--primary-color);
            font-size: 1rem;
        }

        .order-status {
            padding: 0.3rem 0.8rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 500;
        }

        .status-pending {
            background: #fff3cd;
            color: #856404;
        }

        .status-confirmed {
            background: #d1ecf1;
            color: #0c5460;
        }

        .status-completed {
            background: #d4edda;
            color: #155724;
        }

        .status-cancelled {
            background: #f8d7da;
            color: #721c24;
        }

        .order-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 0.8rem;
            margin-bottom: 1rem;
        }

        .detail-item {
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
        }

        .detail-item strong {
            display: inline-block;
            min-width: 80px;
            color: #666;
        }

        .order-items {
            margin-top: 1rem;
        }

        .order-items h4 {
            margin-bottom: 0.5rem;
            color: #333;
            font-size: 1rem;
        }

        .order-item {
            display: flex;
            justify-content: space-between;
            padding: 0.5rem 0;
            border-bottom: 1px dashed #eee;
            font-size: 0.9rem;
        }

        .order-item:last-child {
            border-bottom: none;
        }

        .order-total {
            text-align: right;
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 2px solid #eee;
            font-weight: bold;
            font-size: 1.1rem;
            color: var(--primary-color);
        }

        .no-orders {
            text-align: center;
            padding: 2rem;
            color: #666;
            background: white;
            border-radius: 10px;
            box-shadow: var(--shadow);
        }

        .no-orders i {
            font-size: 2.5rem;
            margin-bottom: 1rem;
            color: #ddd;
        }

        /* ==================== PROMO SECTION ==================== */
        .promo-section {
            background: white;
        }

        .promo-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1.5rem;
            margin-top: 3rem;
        }

        .promo-card {
            background: white;
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: var(--shadow);
            position: relative;
            transition: var(--transition);
        }

        .promo-card:hover {
            transform: translateY(-5px);
        }

        .promo-card img {
            width: 100%;
            height: 180px;
            object-fit: cover;
        }

        .promo-info {
            padding: 1.2rem;
        }

        /* ==================== TESTIMONIALS ==================== */
        .testimonials {
            background: var(--light-color);
        }

        .testimonial-slider {
            max-width: 800px;
            margin: 0 auto;
        }

        .testimonial-card {
            background: white;
            padding: 1.5rem;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            text-align: center;
            margin: 1rem;
        }

        .testimonial-card img {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            margin-bottom: 1rem;
            border: 4px solid var(--primary-color);
        }

        .testimonial-card h3 {
            margin-bottom: 0.5rem;
            color: var(--dark-color);
            font-size: 1.1rem;
        }

        .testimonial-card p {
            color: #666;
            font-style: italic;
            margin-bottom: 1rem;
            font-size: 0.9rem;
        }

        .rating {
            color: var(--accent-color);
            font-size: 1.1rem;
        }

        /* ==================== FOOTER ==================== */
        .footer {
            background: var(--dark-color);
            color: white;
            padding: 50px 0 20px;
        }

        .footer-content {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .footer-section h3 {
            font-size: 1.2rem;
            margin-bottom: 1.5rem;
            color: var(--accent-color);
        }

        .footer-links {
            list-style: none;
        }

        .footer-links li {
            margin-bottom: 0.8rem;
            font-size: 0.9rem;
        }

        .footer-links a {
            color: rgba(255, 255, 255, 0.8);
            text-decoration: none;
            transition: var(--transition);
        }

        .footer-links a:hover {
            color: var(--accent-color);
            padding-left: 5px;
        }

        .social-icons {
            display: flex;
            gap: 0.8rem;
            margin-top: 1rem;
        }

        .social-icons a {
            width: 35px;
            height: 35px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            transition: var(--transition);
            font-size: 0.9rem;
        }

        .social-icons a:hover {
            background: var(--primary-color);
            transform: translateY(-3px);
        }

        .footer-bottom {
            text-align: center;
            padding-top: 2rem;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.6);
            font-size: 0.85rem;
        }

        /* ==================== MODALS ==================== */
        .modal {
            display: none;
            position: fixed;
            z-index: 1001;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            align-items: center;
            justify-content: center;
            padding: 15px;
        }

        .modal-content {
            background-color: white;
            padding: 1.5rem;
            border-radius: var(--border-radius);
            width: 100%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
            animation: modalSlideIn 0.3s ease;
        }

        @keyframes modalSlideIn {
            from {
                transform: translateY(-20px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .close-modal {
            position: absolute;
            right: 1rem;
            top: 1rem;
            font-size: 1.2rem;
            cursor: pointer;
            color: #666;
            background: #f0f0f0;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
        }

        .close-modal:hover {
            background: #e0e0e0;
        }

        .form-group {
            margin-bottom: 1.2rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.4rem;
            font-weight: 500;
            font-size: 0.85rem;
            color: #555;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 0.7rem;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 0.9rem;
            transition: border 0.3s;
            font-family: 'Poppins', sans-serif;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(139, 69, 19, 0.1);
        }

        .modal h2 {
            font-size: 1.3rem;
            margin-bottom: 1.5rem;
            color: #333;
            padding-right: 30px;
        }

        .modal-submit-btn {
            width: 100%;
            padding: 0.9rem;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.3s;
            margin-top: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .modal-submit-btn:hover {
            background: var(--primary-dark);
        }

        .order-summary {
            background: #f9f9f9;
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
            font-size: 0.85rem;
        }

        /* ==================== QRIS STYLES ==================== */
        .qris-info {
            background: #f8f9fa;
            padding: 1.2rem;
            border-radius: 8px;
            margin: 1rem 0;
            border-left: 4px solid var(--primary-color);
            text-align: center;
        }

        .qris-info h4 {
            margin-top: 0;
            color: var(--primary-color);
            font-size: 1rem;
            margin-bottom: 1rem;
        }

        .qris-image {
            width: 200px;
            height: 200px;
            margin: 0 auto 1rem;
            padding: 10px;
            background: white;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px dashed #ddd;
        }

        .qris-image img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
            border-radius: 4px;
            border: 1px solid #e0e0e0;
        }

        .qris-details {
            background: white;
            padding: 0.8rem;
            border-radius: 6px;
            margin: 0.5rem 0;
            text-align: center;
            border: 1px solid #eee;
        }

        .qris-details p {
            margin: 0.3rem 0;
            font-size: 0.85rem;
        }

        .qris-details .amount {
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--primary-color);
            margin: 0.5rem 0;
            font-family: monospace;
            letter-spacing: 1px;
        }

        /* ==================== TABLE RESERVATION STYLES ==================== */
        .table-grid {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 0.8rem;
            margin: 1.5rem 0;
        }

        .table-item {
            background: white;
            border-radius: 8px;
            padding: 0.8rem;
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
            border: 2px solid #e0e0e0;
            position: relative;
        }

        .table-item:hover:not(.reserved):not(.occupied):not(.maintenance) {
            border-color: var(--primary-color);
            transform: translateY(-2px);
        }

        .table-item.reserved,
        .table-item.occupied,
        .table-item.maintenance {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .table-item.reserved {
            background: #f8d7da;
            color: #721c24;
        }

        .table-item.occupied {
            background: #fff3cd;
            color: #856404;
        }

        .table-item.maintenance {
            background: #f8f9fa;
            color: #6c757d;
        }

        .table-item.selected {
            border-color: var(--success-color);
            background: #d4edda;
            color: #155724;
            opacity: 1;
        }

        .table-number {
            font-size: 1.3rem;
            font-weight: bold;
            margin-bottom: 0.3rem;
        }

        .table-status {
            font-size: 0.7rem;
            font-weight: 500;
        }

        .table-details {
            margin-top: 0.5rem;
            font-size: 0.75rem;
            color: #666;
        }

        .time-slot-grid {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 0.6rem;
            margin: 1rem 0;
        }

        .time-slot {
            background: white;
            border-radius: 6px;
            padding: 0.6rem;
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
            border: 2px solid #e0e0e0;
            font-size: 0.85rem;
        }

        .time-slot:hover:not(.booked) {
            border-color: var(--primary-color);
        }

        .time-slot.booked {
            background: #f8d7da;
            color: #721c24;
            cursor: not-allowed;
            opacity: 0.7;
        }

        .time-slot.selected {
            border-color: var(--success-color);
            background: #d4edda;
            color: #155724;
        }

        /* ==================== WHATSAPP PROOF STYLES ==================== */
        .whatsapp-proof-info {
            background: #e8f5e9;
            padding: 1.2rem;
            border-radius: 8px;
            margin: 1rem 0;
            border-left: 4px solid #25D366;
            text-align: center;
        }

        .whatsapp-proof-info h4 {
            margin-top: 0;
            color: #25D366;
            font-size: 1rem;
            margin-bottom: 1rem;
        }

        .whatsapp-instructions {
            background: white;
            padding: 1rem;
            border-radius: 6px;
            margin: 0.8rem 0;
            border: 1px solid #ddd;
            text-align: left;
        }

        .whatsapp-instructions ol {
            margin: 0;
            padding-left: 1.2rem;
        }

        .whatsapp-instructions li {
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
        }

        .whatsapp-proof-note {
            background: #fff3cd;
            padding: 0.8rem;
            border-radius: 6px;
            margin: 0.5rem 0;
            border-left: 4px solid #ffc107;
            text-align: left;
        }

        /* ==================== UTILITY CLASSES ==================== */
        .text-center {
            text-align: center;
        }

        .admin-login-btn {
            position: fixed;
            top: 20px;
            left: 20px;
            background: var(--danger-color);
            color: white;
            padding: 0.7rem 1.2rem;
            border-radius: 25px;
            text-decoration: none;
            font-size: 0.85rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            z-index: 1000;
            box-shadow: 0 4px 12px rgba(220, 53, 69, 0.3);
            transition: var(--transition);
        }

        .admin-login-btn:hover {
            background: #c82333;
            transform: translateY(-2px);
        }

        .whatsapp-float {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: #25D366;
            color: white;
            width: 55px;
            height: 55px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.6rem;
            box-shadow: 0 4px 15px rgba(37, 211, 102, 0.3);
            z-index: 1000;
            transition: var(--transition);
            text-decoration: none;
        }

        .whatsapp-float:hover {
            background: #1da851;
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(37, 211, 102, 0.4);
        }

        .cart-count, .orders-count {
            background: var(--accent-color);
            color: var(--dark-color);
            width: 22px;
            height: 22px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            font-weight: bold;
            margin-left: 0.3rem;
        }

        .notification-badge {
            position: absolute;
            top: -8px;
            right: -8px;
            background: var(--danger-color);
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            font-size: 0.7rem;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            padding: 0.9rem 1rem;
            border-radius: 8px;
            box-shadow: 0 6px 20px rgba(0,0,0,0.15);
            display: flex;
            align-items: center;
            gap: 0.8rem;
            z-index: 1002;
            transform: translateX(120%);
            transition: transform 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            max-width: 320px;
            font-size: 0.85rem;
        }

        .toast.show {
            transform: translateX(0);
        }

        .toast.success {
            border-left: 4px solid var(--success-color);
        }

        .toast.error {
            border-left: 4px solid var(--danger-color);
        }

        .toast.info {
            border-left: 4px solid var(--info-color);
        }

        .toast i {
            font-size: 1.1rem;
        }

        .toast.success i {
            color: var(--success-color);
        }

        .toast.error i {
            color: var(--danger-color);
        }

        .toast.info i {
            color: var(--info-color);
        }

        /* ==================== RESERVATION BUTTON STYLES ==================== */
        .reservation-btn {
            background: var(--success-color);
            color: white;
            border: none;
            padding: 0.6rem 1rem;
            border-radius: 6px;
            font-size: 0.85rem;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }

        .reservation-btn:hover {
            background: #218838;
            transform: translateY(-2px);
        }

        .reservation-btn:disabled {
            background: #6c757d;
            cursor: not-allowed;
            transform: none;
        }

        /* ==================== RESPONSIVE ==================== */
        @media (max-width: 1200px) {
            .container {
                max-width: 960px;
            }
            
            .menu-grid {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .promo-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .table-grid {
                grid-template-columns: repeat(5, 1fr);
            }
            
            .time-slot-grid {
                grid-template-columns: repeat(5, 1fr);
            }
        }

        @media (max-width: 992px) {
            .container {
                max-width: 720px;
            }
            
            .menu-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .promo-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .footer-content {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .hero h1 {
                font-size: 2.5rem;
            }
            
            .floating-coffee {
                display: none;
            }
            
            .table-grid {
                grid-template-columns: repeat(4, 1fr);
            }
            
            .time-slot-grid {
                grid-template-columns: repeat(4, 1fr);
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 0 10px;
            }
            
            .header {
                padding: 0.8rem 0;
            }
            
            .nav-links {
                position: fixed;
                top: 70px;
                left: -100%;
                width: 100%;
                background: white;
                flex-direction: column;
                align-items: center;
                padding: 1.5rem 0;
                transition: var(--transition);
                box-shadow: 0 5px 15px rgba(0,0,0,0.1);
                height: calc(100vh - 70px);
                overflow-y: auto;
            }
            
            .nav-links.active {
                left: 0;
            }
            
            .hamburger {
                display: block;
            }
            
            .hero {
                padding: 130px 0 60px;
            }
            
            .hero h1 {
                font-size: 2.2rem;
            }
            
            .hero p {
                font-size: 1rem;
            }
            
            .section-title {
                font-size: 1.8rem;
            }
            
            .menu-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 1.2rem;
            }
            
            .promo-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 1.2rem;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .orders-tabs {
                gap: 0.5rem;
            }
            
            .tab-btn {
                padding: 0.6rem 1rem;
                font-size: 0.85rem;
            }
            
            .order-details {
                grid-template-columns: 1fr;
            }
            
            .modal-content {
                padding: 1.2rem;
                margin: 1rem;
                max-width: 95%;
            }
            
            .table-grid {
                grid-template-columns: repeat(4, 1fr);
            }
            
            .time-slot-grid {
                grid-template-columns: repeat(4, 1fr);
            }
            
            .admin-login-btn {
                top: 15px;
                left: 15px;
                padding: 0.6rem 1rem;
                font-size: 0.8rem;
            }
            
            .whatsapp-float {
                width: 50px;
                height: 50px;
                font-size: 1.4rem;
                bottom: 20px;
                right: 20px;
            }
            
            .floating-coffee {
                display: none;
            }
            
            .qris-image {
                width: 180px;
                height: 180px;
            }
        }

        @media (max-width: 576px) {
            .menu-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 1rem;
            }
            
            .promo-grid {
                grid-template-columns: 1fr;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 1rem;
            }
            
            .hero h1 {
                font-size: 1.8rem;
            }
            
            .section-title {
                font-size: 1.6rem;
            }
            
            .footer-content {
                grid-template-columns: 1fr;
                gap: 1.5rem;
            }
            
            .hero-buttons {
                flex-direction: column;
                gap: 0.8rem;
            }
            
            .hero-buttons .btn-primary,
            .hero-buttons .btn-secondary {
                width: 100%;
                justify-content: center;
            }
            
            .cart-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 0.8rem;
            }
            
            .quantity-control {
                width: 100%;
                justify-content: space-between;
            }
            
            .table-grid {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .time-slot-grid {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .modal-content {
                padding: 1rem;
            }
            
            .qris-image {
                width: 160px;
                height: 160px;
            }
        }

        @media (max-width: 480px) {
            .menu-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 0.8rem;
            }
            
            .menu-card img {
                height: 160px;
            }
            
            .menu-info {
                padding: 1rem;
            }
            
            .table-grid {
                grid-template-columns: repeat(3, 1fr);
                gap: 0.5rem;
            }
            
            .time-slot-grid {
                grid-template-columns: repeat(3, 1fr);
                gap: 0.5rem;
            }
            
            .admin-login-btn {
                font-size: 0.75rem;
                padding: 0.5rem 0.8rem;
            }
            
            .btn-primary, .btn-secondary {
                padding: 0.8rem 1.5rem;
            }
            
            .qris-image {
                width: 150px;
                height: 150px;
            }
        }

        @media (max-width: 360px) {
            .menu-grid {
                grid-template-columns: 1fr;
            }
            
            .table-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .time-slot-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .logo span {
                font-size: 1.1rem;
            }
            
            .qris-image {
                width: 140px;
                height: 140px;
            }
        }
    </style>
</head>
<body>
    <!-- Admin Login Button -->
    <a href="#admin-login" class="admin-login-btn">
        <i class="fas fa-user-cog"></i> Admin
    </a>

    <!-- Header -->
    <header class="header" id="header">
        <div class="container">
            <nav class="navbar">
                <a href="#" class="logo">
                    <div class="logo-icon">
                        <img src="gambar/logo.jpeg" alt="MAN CAFE Logo" 
                             style="width: 100%; height: 100%; object-fit: contain;">
                    </div>
                    <span>MAN CAFE</span>
                </a>
                <ul class="nav-links" id="navLinks">
                    <li><a href="#home" class="active">Beranda</a></li>
                    <li><a href="#menu">Menu</a></li>
                    <li><a href="#testimonials">Testimoni</a></li>
                    <li>
                        <a href="#cart" class="btn-cart">
                            <i class="fas fa-shopping-cart"></i> Keranjang
                            <span class="cart-count">0</span>
                        </a>
                    </li>
                    <li>
                        <a href="#my-orders" class="btn-orders">
                            <i class="fas fa-clipboard-list"></i> Pesanan
                            <span class="orders-count">0</span>
                        </a>
                    </li>
                </ul>
                <button class="hamburger" id="hamburger">
                    <i class="fas fa-bars"></i>
                </button>
            </nav>
        </div>
    </header>

    <!-- Hero Section -->
    <section class="hero" id="home">
        <div class="container">
            <div class="floating-coffee">
                <i class="fas fa-coffee"></i>
            </div>
            <div class="hero-content">
                <h1>Rasakan Kenikmatan Menu Premium</h1>
                <p>Temukan pengalaman nongki terbaik dengan suasana cozy, makanan lezat, dan pelayanan ramah di MAN CAFE</p>
                <div class="hero-buttons">
                    <a href="#menu" class="btn-primary">
                        <i class="fas fa-shopping-cart"></i> Pesan Sekarang
                    </a>
                    <a href="#menu" class="btn-secondary">
                        <i class="fas fa-utensils"></i> Lihat Menu
                    </a>
                </div>
            </div>
        </div>
    </section>

    <!-- Stats Section -->
    <section class="stats-section">
        <div class="container">
            <div class="stats-grid">
                <div class="stat-item">
                    <h3>100+</h3>
                    <p>Pelanggan Setia</p>
                </div>
                <div class="stat-item">
                    <h3>20+</h3>
                    <p>Menu Variatif</p>
                </div>
                <div class="stat-item">
                    <h3>10</h3>
                    <p>Meja Nyaman</p>
                </div>
                <div class="stat-item">
                    <h3>5★</h3>
                    <p>Rating Terbaik</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Featured Menu Section -->
    <section class="menu-section" id="menu">
        <div class="container">
            <h2 class="section-title">Menu Unggulan Kami</h2>
            <p class="text-center" style="max-width: 600px; margin: 0 auto 3rem; color: #666;">
                Nikmati berbagai pilihan menu terbaik kami yang dibuat dengan bahan-bahan berkualitas tinggi
            </p>
            <div class="menu-grid" id="featured-menu">
                <!-- Menu items will be loaded here -->
            </div>
            <div class="text-center" style="margin-top: 3rem;">
                <a href="#all-menu" class="btn-primary">Lihat Semua Menu</a>
            </div>
        </div>
    </section>

    <!-- All Menu Section -->
    <section class="menu-section" id="all-menu" style="background: #f9f9f9;">
        <div class="container">
            <h2 class="section-title">Semua Menu</h2>
            <p class="text-center" style="max-width: 600px; margin: 0 auto 3rem; color: #666;">
                Pilih dari berbagai menu makanan dan minuman yang tersedia
            </p>
            <div class="menu-grid" id="all-menu-items">
                <!-- All menu items will be loaded here -->
            </div>
        </div>
    </section>

    <!-- Cart Section -->
    <section class="cart-section" id="cart">
        <div class="container">
            <h2 class="section-title">Keranjang Pesanan Anda</h2>
            <div class="cart-items" id="cart-items">
                <p class="text-center" id="empty-cart-message" style="color: #666; padding: 2rem;">Keranjang Anda masih kosong</p>
                <div id="cart-items-container"></div>
                <div class="cart-total" id="cart-total" style="display: none;">
                    Total: Rp <span id="total-amount">0</span>
                </div>
                <div class="text-center" id="checkout-buttons" style="display: none; margin-top: 2rem; gap: 1rem; flex-wrap: wrap; justify-content: center;">
                    <button class="btn-primary" onclick="openCheckoutModal()" style="padding: 1rem 2rem;">
                        <i class="fas fa-check"></i> Checkout
                    </button>
                    <button class="btn-secondary" onclick="clearCart()" style="padding: 1rem 2rem; background: #dc3545; color: white; border: none;">
                        <i class="fas fa-trash"></i> Kosongkan
                    </button>
                </div>
            </div>
        </div>
    </section>

    <!-- Orders Section -->
    <section class="orders-section" id="my-orders">
        <div class="container">
            <h2 class="section-title">Pesanan Saya</h2>
            <div class="orders-tabs">
                <button class="tab-btn active" onclick="showOrders('all', this)">
                    <i class="fas fa-list"></i> Semua
                </button>
                <button class="tab-btn" onclick="showOrders('pending', this)">
                    <i class="fas fa-clock"></i> Menunggu
                </button>
                <button class="tab-btn" onclick="showOrders('confirmed', this)">
                    <i class="fas fa-check-circle"></i> Dikonfirmasi
                </button>
                <button class="tab-btn" onclick="showOrders('reservations', this)">
                    <i class="fas fa-calendar-alt"></i> Reservasi
                </button>
            </div>
            
            <div id="orders-container">
                <!-- Orders will be loaded here -->
            </div>
        </div>
    </section>

    <!-- Promo Section -->
    <section class="promo-section">
        <div class="container">
            <h2 class="section-title">Promo Spesial Hari Ini</h2>
            <p class="text-center" style="max-width: 600px; margin: 0 auto 3rem; color: #666;">
                Jangan lewatkan promo menarik yang kami sediakan khusus untuk Anda
            </p>
            <div class="promo-grid" id="promo-menu">
                <!-- Promo items will be loaded here -->
            </div>
        </div>
    </section>



    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>MAN CAFE</h3>
                    <p>Tempat nongki asik dengan suasana cozy dan menu spesial. Nikmati menu berkualitas dengan pelayanan terbaik.</p>
                    <div class="social-icons">
                        <a href="#"><i class="fab fa-instagram"></i></a>
                        <a href="#"><i class="fab fa-facebook"></i></a>
                        <a href="#"><i class="fab fa-tiktok"></i></a>
                    </div>
                </div>
                <div class="footer-section">
                    <h3>Jam Operasional</h3>
                    <ul class="footer-links">
                        <li><strong>Senin - Jumat:</strong> 16:00 - 22:00</li>
                        <li><strong>Sabtu:</strong> 16:00 - 00:00</li>
                        <li><strong>Minggu:</strong> 16:00 - 23:00</li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h3>Kontak</h3>
                    <ul class="footer-links">
                        <li><i class="fas fa-map-marker-alt"></i> Jl. Kayangan Gg. Flamboyan</li>
                        <li><i class="fas fa-phone"></i> (+62) 83832184173</li>
                        <li><i class="fas fa-envelope"></i> info@mancafe.com</li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h3>Menu Cepat</h3>
                    <ul class="footer-links">
                        <li><a href="#home">Beranda</a></li>
                        <li><a href="#menu">Menu</a></li>
                        <li><a href="#testimonials">Testimoni</a></li>
                        <li><a href="#my-orders">Pesanan Saya</a></li>
                        <li><a href="#cart">Keranjang</a></li>
                    </ul>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 MAN CAFE. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <!-- WhatsApp Float Button -->
    <a href="https://wa.me/6283832184173" class="whatsapp-float" target="_blank">
        <i class="fab fa-whatsapp"></i>
    </a>

    <!-- Modals -->
    <div id="checkoutModal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal('checkoutModal')">&times;</span>
            <h2>Checkout Pesanan</h2>
            <div id="order-summary-compact" class="order-summary">
                <!-- Order summary will be loaded here -->
            </div>
            <form id="checkoutForm">
                <div class="form-group">
                    <label for="customerName">Nama Pemesan *</label>
                    <input type="text" id="customerName" required placeholder="Masukkan nama lengkap">
                </div>
                <div class="form-group">
                    <label for="customerPhone">Nomor Telepon *</label>
                    <input type="tel" id="customerPhone" required placeholder="0812-3456-7890">
                </div>
                <div class="form-group">
                    <label for="orderType">Tipe Pesanan *</label>
                    <select id="orderType" required onchange="toggleReservationInfo()">
                        <option value="">Pilih...</option>
                        <option value="dine_in">Makan di Tempat</option>
                        <option value="takeaway">Bawa Pulang</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="paymentMethod">Metode Pembayaran</label>
                    <div style="background: #e9ecef; padding: 0.8rem; border-radius: 6px; margin-top: 0.4rem; font-weight: bold; color: var(--primary-color);">
                        <i class="fas fa-qrcode"></i> QRIS (Satu-satunya Metode)
                    </div>
                </div>
                <div id="qrisPaymentInfo">
                    <div class="qris-info">
                        <h4><i class="fas fa-qrcode"></i> Bayar dengan QRIS</h4>
                        <div class="qris-image">
                            <!-- GAMBAR QRIS ANDA -->
                            <img src="gambar/QRIS.jpeg" 
                                 alt="QRIS MAN CAFE"
                                 onerror="showQrisPlaceholder(this)">
                        </div>
                        <div class="qris-details">
                            <p><strong>MAN CAFE</strong></p>
                            <p>Jl. Kayangan Gg. Flamboyan</p>
                            <div class="amount" id="qris-amount">Rp 0</div>
                            <p><small>Scan QRIS dengan aplikasi banking/e-wallet favorit Anda</small></p>
                        </div>
                        <p style="font-size: 0.8rem; color: #666; margin-top: 0.8rem;">
                            <i class="fas fa-info-circle"></i> 
                            QRIS mendukung semua bank dan e-wallet (GoPay, OVO, Dana, LinkAja, dll)
                        </p>
                    </div>
                </div>
                <div id="reservationInfo" style="display: none;">
                    <div style="background: #f0f9ff; padding: 0.8rem; border-radius: 6px; margin: 1rem 0; border-left: 4px solid #3b82f6;">
                        <p style="margin: 0; font-size: 0.85rem; color: #1e40af;">
                            <i class="fas fa-info-circle"></i> <strong>Info Reservasi Meja:</strong><br>
                            Setelah pesanan dikonfirmasi oleh admin, Anda dapat melakukan reservasi meja di halaman "Pesanan Saya" pada tab "Dikonfirmasi".
                        </p>
                    </div>
                </div>
                <button type="submit" class="modal-submit-btn" id="submitOrderBtn">
                    <i class="fas fa-qrcode"></i> Konfirmasi Pesanan & Lihat QRIS
                </button>
            </form>
        </div>
    </div>

    <!-- Transfer Success Modal -->
    <div id="transferSuccessModal" class="modal">
        <div class="modal-content" style="max-width: 550px;">
            <span class="close-modal" onclick="closeModal('transferSuccessModal')">&times;</span>
            <div style="text-align: center;">
                <div style="width: 80px; height: 80px; background: #28a745; color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 2.5rem; margin: 0 auto 1.5rem;">
                    <i class="fas fa-check"></i>
                </div>
                <h2>Pesanan Berhasil!</h2>
                <p style="color: #666; margin-bottom: 1.5rem;">Pesanan Anda telah diterima dan menunggu konfirmasi admin.</p>
                
                <div class="qris-info" style="margin: 1.5rem 0;">
                    <h4><i class="fas fa-qrcode"></i> Pembayaran QRIS</h4>
                    <div class="qris-image">
                        <!-- GAMBAR QRIS YANG SAMA -->
                        <img src="gambar/QRIS.jpeg" 
                             alt="QRIS MAN CAFE"
                             onerror="showQrisPlaceholder(this)"
                             style="max-width: 100%; max-height: 100%;">
                    </div>
                    <div class="qris-details">
                        <p><strong>MAN CAFE</strong></p>
                        <div class="amount" id="success-qris-amount">Rp 0</div>
                        <p><small>Scan QRIS di atas untuk pembayaran</small></p>
                    </div>
                    <div style="background: #e7f4e4; padding: 0.8rem; border-radius: 6px; margin-top: 1rem; text-align: left;">
                        <p style="margin: 0; font-size: 0.85rem; color: #155724;">
                            <i class="fas fa-lightbulb"></i> <strong>Cara Bayar:</strong><br>
                            1. Buka aplikasi bank/e-wallet<br>
                            2. Pilih "Scan QRIS"<br>
                            3. Arahkan kamera ke QR code<br>
                            4. Konfirmasi pembayaran
                        </p>
                    </div>
                </div>
                
                <!-- Bagian WhatsApp untuk upload bukti transfer -->
                <div class="whatsapp-proof-info">
                    <h4><i class="fab fa-whatsapp"></i> Upload Bukti Transfer via WhatsApp</h4>
                    
                    <div class="whatsapp-instructions">
                        <ol>
                            <li>Lakukan transfer sesuai jumlah di atas</li>
                            <li>Ambil screenshot bukti transfer</li>
                            <li>Kirim screenshot ke WhatsApp kami:</li>
                        </ol>
                        <div style="text-align: center; margin-top: 1rem;">
                            <a href="https://wa.me/6283832184173?text=Halo%20MAN%20CAFE%2C%20saya%20sudah%20transfer%20untuk%20pesanan%20" 
                               id="whatsapp-link"
                               target="_blank" 
                               class="btn-primary" 
                               style="background: #25D366; color: white; padding: 0.8rem 1.5rem;">
                                <i class="fab fa-whatsapp"></i> Kirim Bukti via WhatsApp
                            </a>
                        </div>
                    </div>
                    
                    <div class="whatsapp-proof-note">
                        <p style="margin: 0; font-size: 0.85rem;">
                            <i class="fas fa-info-circle"></i> <strong>Catatan:</strong><br>
                            1. Sebutkan nama dan nomor pesanan saat mengirim bukti<br>
                            2. Admin akan memverifikasi bukti transfer Anda<br>
                            3. Status pembayaran akan diperbarui setelah diverifikasi
                        </p>
                    </div>
                </div>
                
                <div style="background: #f0f9ff; padding: 1rem; border-radius: 8px; margin: 1rem 0; border-left: 4px solid #3b82f6;">
                    <h4 style="margin-top: 0; color: #1e40af;"><i class="fas fa-calendar-alt"></i> Info Reservasi Meja</h4>
                    <p style="margin: 0.5rem 0; font-size: 0.9rem;">
                        Jika Anda memilih "Makan di Tempat", setelah pesanan dikonfirmasi admin, Anda dapat melakukan reservasi meja di halaman <strong>"Pesanan Saya"</strong>.
                    </p>
                </div>
                
                <div style="display: flex; gap: 1rem; margin-top: 1.5rem;">
                    <button class="btn-primary" onclick="window.location.hash='#my-orders'; closeModal('transferSuccessModal')" style="flex: 1; padding: 1rem;">
                        <i class="fas fa-clipboard-list"></i> Lihat Pesanan
                    </button>
                    <button class="btn-secondary" onclick="closeModal('transferSuccessModal')" style="flex: 1; padding: 1rem; background: #6c757d; color: white; border: none;">
                        <i class="fas fa-shopping-cart"></i> Belanja Lagi
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Reservasi Meja Modal -->
    <div id="reservationModal" class="modal">
        <div class="modal-content" style="max-width: 700px;">
            <span class="close-modal" onclick="closeModal('reservationModal')">&times;</span>
            <h2>Reservasi Meja</h2>
            <div id="reservation-content">
                <!-- Reservation content will be loaded here -->
            </div>
        </div>
    </div>

    <script>
        // ============================
        // SISTEM PELANGGAN DENGAN SUPABASE - DIPERBAIKI
        // ============================
        
        class CustomerSystem {
            constructor() {
                this.cart = JSON.parse(localStorage.getItem('customer_cart')) || [];
                this.customerPhone = localStorage.getItem('customer_phone') || '';
                this.isOnline = true;
                this.autoRefreshInterval = null;
                this.realtimeSubscription = null;
                this.currentFilter = 'all';
                this.selectedOrderForReservation = null;
            }

            async init() {
                console.log('🚀 Initializing Customer System...');
                
                try {
                    this.isOnline = await this.checkSupabaseConnection();
                    console.log(this.isOnline ? '✅ Connected to Supabase' : '⚠️ Running in offline mode');
                    
                    await this.loadMenus();
                    await this.loadCustomerOrders();
                    
                    if (this.isOnline) {
                        this.setupRealtimeUpdates();
                    }
                    
                    this.startAutoRefresh();
                    
                    console.log('✅ Customer System initialized');
                    
                } catch (error) {
                    console.error('❌ Error in init:', error);
                    await this.loadMenus();
                    await this.loadCustomerOrders();
                }
            }

            async checkSupabaseConnection() {
                try {
                    const { data, error } = await supabaseClient
                        .from('menu_items')
                        .select('count', { count: 'exact', head: true })
                        .limit(1);
                    
                    if (error) {
                        console.log('Supabase connection error:', error);
                        return false;
                    }
                    return true;
                } catch (error) {
                    console.log('Supabase connection error:', error);
                    return false;
                }
            }

            // ==================== REALTIME UPDATES ====================
            setupRealtimeUpdates() {
                try {
                    this.realtimeSubscription = supabaseClient
                        .channel('customer-orders')
                        .on('postgres_changes', 
                            { 
                                event: '*', 
                                schema: 'public', 
                                table: 'orders',
                                filter: this.customerPhone ? 
                                    `customer_phone=eq.${this.customerPhone}` : undefined
                            }, 
                            async (payload) => {
                                console.log('🔄 Realtime update received:', payload);
                                await this.loadCustomerOrders();
                                updateOrdersDisplay();
                                updateOrdersCount();
                                
                                if (payload.eventType === 'UPDATE') {
                                    const order = window.customerOrders?.find(o => 
                                        o.id === payload.new.id || 
                                        o.orderNumber === payload.new.order_number
                                    );
                                    
                                    if (order) {
                                        if (order.status === 'confirmed') {
                                            showToast(
                                                `🎉 Pesanan #${order.orderNumber} telah dikonfirmasi!<br>
                                                Sekarang Anda dapat reservasi meja di tab "Dikonfirmasi".`,
                                                'success'
                                            );
                                        } else if (order.status === 'completed') {
                                            showToast(`Pesanan #${order.orderNumber} telah selesai!`, 'success');
                                        }
                                    }
                                }
                            }
                        )
                        .on('postgres_changes', 
                            { 
                                event: '*', 
                                schema: 'public', 
                                table: 'payment_proofs'
                            }, 
                            async (payload) => {
                                console.log('🔄 Realtime payment_proofs update:', payload);
                                await this.loadCustomerOrders();
                                updateOrdersDisplay();
                                updateOrdersCount();
                                
                                if (payload.eventType === 'INSERT') {
                                    showToast('Status pembayaran diperbarui!', 'info');
                                }
                            }
                        )
                        .subscribe((status) => {
                            console.log('📡 Realtime subscription status:', status);
                        });
                        
                } catch (error) {
                    console.error('❌ Error setting up realtime:', error);
                }
            }

            // ==================== MENU FUNCTIONS ====================
            async loadMenus() {
                try {
                    console.log('📥 Loading menus...');
                    
                    let menus = [];
                    
                    if (this.isOnline) {
                        const { data, error } = await supabaseClient
                            .from('menu_items')
                            .select('*')
                            .eq('is_active', true)
                            .order('category')
                            .order('name');
                        
                        if (error) {
                            console.error('❌ Error loading menus from Supabase:', error);
                            menus = this.getDefaultMenus();
                        } else if (data && data.length > 0) {
                            menus = data.map(menu => this.formatMenuFromSupabase(menu));
                            console.log(`✅ Loaded ${menus.length} menus from Supabase`);
                        } else {
                            menus = this.getDefaultMenus();
                        }
                    } else {
                        menus = JSON.parse(localStorage.getItem('cafe_menus') || '[]');
                        if (menus.length === 0) {
                            menus = this.getDefaultMenus();
                        }
                    }
                    
                    localStorage.setItem('cafe_menus', JSON.stringify(menus));
                    window.currentMenus = menus;
                    
                    renderMenus(menus);
                    
                    return menus;
                    
                } catch (error) {
                    console.error('❌ Error loading menus:', error);
                    const defaultMenus = this.getDefaultMenus();
                    localStorage.setItem('cafe_menus', JSON.stringify(defaultMenus));
                    window.currentMenus = defaultMenus;
                    renderMenus(defaultMenus);
                    return defaultMenus;
                }
            }

            formatMenuFromSupabase(menu) {
                return {
                    id: menu.id,
                    name: menu.name || 'Menu',
                    description: menu.description || '',
                    price: menu.price || 0,
                    image: menu.image_url || menu.image || '',
                    image_url: menu.image_url || menu.image || '',
                    category: menu.category || 'minuman',
                    isPromo: menu.is_promo || false,
                    originalPrice: menu.original_price || null,
                    isActive: menu.is_active !== false,
                    stock: menu.stock || 0,
                    isDailyStock: menu.is_daily_stock || false,
                    dailyStock: menu.daily_stock || 0,
                    currentDailyStock: menu.current_daily_stock || 0
                };
            }

            getDefaultMenus() {
                return [
                    { 
                        id: 1, 
                        name: "Espresso Premium", 
                        description: "Kopi espresso dengan cita rasa kuat dan aroma harum",
                        price: 35000, 
                        image: "https://images.unsplash.com/photo-1514432324607-a09d9b4aefdd?ixlib=rb-1.2.1&auto=format&fit=crop&w=400&h=300&q=80",
                        category: "minuman",
                        isPromo: false,
                        stock: 10,
                        isDailyStock: false,
                        isActive: true
                    },
                    { 
                        id: 2, 
                        name: "Cappuccino Special", 
                        description: "Espresso dengan susu steamed dan busa susu lembut",
                        price: 42000, 
                        image: "https://images.unsplash.com/photo-1567306226416-28f0efdc88ce?ixlib=rb-1.2.1&auto=format&fit=crop&w=400&h=300&q=80",
                        category: "minuman",
                        isPromo: false,
                        stock: 15,
                        isDailyStock: false,
                        isActive: true
                    },
                    { 
                        id: 3, 
                        name: "Latte Art", 
                        description: "Kopi latte dengan seni gambar di atasnya",
                        price: 45000, 
                        image: "https://images.unsplash.com/photo-1570196911496-66bd58a5b7b4?ixlib=rb-1.2.1&auto=format&fit=crop&w=400&h=300&q=80",
                        category: "minuman",
                        isPromo: true,
                        originalPrice: 50000,
                        stock: 8,
                        isDailyStock: false,
                        isActive: true
                    },
                    { 
                        id: 4, 
                        name: "Croissant", 
                        description: "Roti croissant renyah dengan isian coklat",
                        price: 28000, 
                        image: "https://images.unsplash.com/photo-1555507036-ab794f27d2e9?ixlib=rb-1.2.1&auto=format&fit=crop&w=400&h=300&q=80",
                        category: "makanan",
                        isPromo: false,
                        stock: 20,
                        isDailyStock: true,
                        currentDailyStock: 15,
                        isActive: true
                    }
                ];
            }

            // ==================== ORDER FUNCTIONS ====================
            async createOrder(orderData) {
                try {
                    console.log('📝 Creating order:', orderData);
                    
                    let supabaseOrderId = null;
                    const orderNumber = 'ORD-' + Date.now().toString().slice(-8);
                    
                    if (this.isOnline) {
                        const { data, error } = await supabaseClient
                            .from('orders')
                            .insert([{
                                order_number: orderNumber,
                                customer_name: orderData.customer.name,
                                customer_phone: orderData.customer.phone,
                                customer_address: '-',
                                order_type: orderData.orderType,
                                total_amount: orderData.total,
                                status: 'pending',
                                payment_method: 'qris',
                                payment_status: 'waiting_payment',
                                admin_seen: false,
                                created_at: new Date().toISOString()
                            }])
                            .select()
                            .single();
                        
                        if (error) throw error;
                        
                        supabaseOrderId = data.id;
                        
                        const orderItems = orderData.items.map(item => ({
                            order_id: data.id,
                            menu_item_id: item.id,
                            menu_item_name: item.name,
                            quantity: item.quantity,
                            price: item.price,
                            total_price: item.price * item.quantity
                        }));
                        
                        await supabaseClient
                            .from('order_items')
                            .insert(orderItems);
                        
                        console.log('🔄 Updating stock for order items...');
                        await this.updateStockAfterCheckout(orderData.items);
                        
                        await supabaseClient
                            .from('admin_notifications')
                            .insert([{
                                type: 'new_order',
                                title: 'Pesanan Baru!',
                                message: `Pesanan baru #${orderNumber} dari ${orderData.customer.name}`,
                                data: {
                                    order_id: data.id,
                                    order_number: orderNumber,
                                    total: orderData.total,
                                    customer_name: orderData.customer.name,
                                    order_type: orderData.orderType
                                },
                                is_read: false,
                                created_at: new Date().toISOString()
                            }]);
                        
                        console.log('✅ Order saved to Supabase');
                    }
                    
                    const order = {
                        id: supabaseOrderId || Date.now(),
                        orderNumber: orderNumber,
                        customer: orderData.customer,
                        orderType: orderData.orderType,
                        items: orderData.items,
                        total: orderData.total,
                        status: 'pending',
                        paymentMethod: 'qris',
                        paymentStatus: 'waiting_payment',
                        createdAt: new Date().toISOString(),
                        supabase_id: supabaseOrderId,
                        reservation: null,
                        paymentProof: null
                    };
                    
                    this.customerPhone = orderData.customer.phone;
                    localStorage.setItem('customer_phone', this.customerPhone);
                    
                    const customerOrders = JSON.parse(localStorage.getItem('customer_orders') || '[]');
                    customerOrders.unshift(order);
                    localStorage.setItem('customer_orders', JSON.stringify(customerOrders));
                    
                    window.customerOrders = customerOrders;
                    
                    console.log('✅ Order created:', orderNumber);
                    return order;
                    
                } catch (error) {
                    console.error('❌ Error creating order:', error);
                    
                    const orderNumber = 'ORD-OFFLINE-' + Date.now().toString().slice(-8);
                    const order = {
                        id: Date.now(),
                        orderNumber: orderNumber,
                        customer: orderData.customer,
                        orderType: orderData.orderType,
                        items: orderData.items,
                        total: orderData.total,
                        status: 'pending',
                        paymentMethod: 'qris',
                        paymentStatus: 'waiting_payment',
                        createdAt: new Date().toISOString(),
                        supabase_id: null,
                        reservation: null,
                        paymentProof: null
                    };
                    
                    this.updateLocalStock(orderData.items);
                    
                    const customerOrders = JSON.parse(localStorage.getItem('customer_orders') || '[]');
                    customerOrders.unshift(order);
                    localStorage.setItem('customer_orders', JSON.stringify(customerOrders));
                    
                    window.customerOrders = customerOrders;
                    
                    console.log('✅ Order saved locally (offline):', orderNumber);
                    return order;
                }
            }

            async updateStockAfterCheckout(items) {
                try {
                    console.log('📦 Updating stock for items:', items);
                    
                    for (const item of items) {
                        const { data: menu, error: menuError } = await supabaseClient
                            .from('menu_items')
                            .select('*')
                            .eq('id', item.id)
                            .single();
                        
                        if (menuError) {
                            console.error(`❌ Error finding menu ${item.id}:`, menuError);
                            continue;
                        }
                        
                        let newStock = menu.stock - item.quantity;
                        
                        if (menu.is_daily_stock && menu.current_daily_stock !== null) {
                            const newDailyStock = Math.max(0, menu.current_daily_stock - item.quantity);
                            
                            const { error: updateError } = await supabaseClient
                                .from('menu_items')
                                .update({ 
                                    stock: newStock,
                                    current_daily_stock: newDailyStock
                                })
                                .eq('id', item.id);
                            
                            if (updateError) {
                                console.error(`❌ Error updating stock for menu ${item.id}:`, updateError);
                            } else {
                                console.log(`✅ Updated stock for menu ${menu.name}: 
                                    stock from ${menu.stock} to ${newStock},
                                    daily stock from ${menu.current_daily_stock} to ${newDailyStock}`);
                            }
                        } else {
                            const { error: updateError } = await supabaseClient
                                .from('menu_items')
                                .update({ stock: newStock })
                                .eq('id', item.id);
                            
                            if (updateError) {
                                console.error(`❌ Error updating stock for menu ${item.id}:`, updateError);
                            } else {
                                console.log(`✅ Updated stock for menu ${menu.name}: from ${menu.stock} to ${newStock}`);
                            }
                        }
                        
                        this.updateLocalMenuStock(item.id, item.quantity);
                    }
                    
                    await this.loadMenus();
                    
                } catch (error) {
                    console.error('❌ Error in updateStockAfterCheckout:', error);
                }
            }

            updateLocalStock(items) {
                console.log('🔄 Updating local stock for items:', items);
                
                const menus = JSON.parse(localStorage.getItem('cafe_menus') || '[]');
                
                for (const item of items) {
                    const menuIndex = menus.findIndex(m => m.id == item.id);
                    if (menuIndex !== -1) {
                        let newStock = menus[menuIndex].stock - item.quantity;
                        if (newStock < 0) newStock = 0;
                        
                        if (menus[menuIndex].isDailyStock && menus[menuIndex].currentDailyStock !== null) {
                            let newDailyStock = menus[menuIndex].currentDailyStock - item.quantity;
                            if (newDailyStock < 0) newDailyStock = 0;
                            menus[menuIndex].currentDailyStock = newDailyStock;
                        }
                        
                        menus[menuIndex].stock = newStock;
                        
                        console.log(`📝 Updated local stock for ${menus[menuIndex].name}: from ${menus[menuIndex].stock + item.quantity} to ${newStock}`);
                    }
                }
                
                localStorage.setItem('cafe_menus', JSON.stringify(menus));
                window.currentMenus = menus;
                renderMenus(menus);
            }

            updateLocalMenuStock(menuId, quantity) {
                const menus = JSON.parse(localStorage.getItem('cafe_menus') || '[]');
                const menuIndex = menus.findIndex(m => m.id == menuId);
                
                if (menuIndex !== -1) {
                    menus[menuIndex].stock = Math.max(0, menus[menuIndex].stock - quantity);
                    
                    if (menus[menuIndex].isDailyStock && menus[menuIndex].currentDailyStock !== null) {
                        menus[menuIndex].currentDailyStock = Math.max(0, menus[menuIndex].currentDailyStock - quantity);
                    }
                    
                    localStorage.setItem('cafe_menus', JSON.stringify(menus));
                    window.currentMenus = menus;
                }
            }

            async loadCustomerOrders() {
                try {
                    console.log('📥 Loading customer orders...');
                    
                    if (!this.customerPhone) {
                        const orders = JSON.parse(localStorage.getItem('customer_orders') || '[]');
                        window.customerOrders = orders;
                        console.log(`📦 Loaded ${orders.length} orders from localStorage`);
                        return orders;
                    }
                    
                    if (!this.isOnline) {
                        const orders = JSON.parse(localStorage.getItem('customer_orders') || '[]');
                        window.customerOrders = orders;
                        return orders;
                    }
                    
                    const { data: orders, error: ordersError } = await supabaseClient
                        .from('orders')
                        .select('*')
                        .eq('customer_phone', this.customerPhone)
                        .order('created_at', { ascending: false });
                    
                    if (ordersError) {
                        console.error('Error loading orders:', ordersError);
                        const orders = JSON.parse(localStorage.getItem('customer_orders') || '[]');
                        window.customerOrders = orders;
                        return orders;
                    }
                    
                    if (orders && orders.length > 0) {
                        const ordersWithDetails = await Promise.all(
                            orders.map(async (order) => {
                                try {
                                    const { data: items, error: itemsError } = await supabaseClient
                                        .from('order_items')
                                        .select('*')
                                        .eq('order_id', order.id);
                                    
                                    const { data: reservation, error: reservationError } = await supabaseClient
                                        .from('reservations')
                                        .select('*')
                                        .eq('order_id', order.id)
                                        .single();
                                    
                                    const { data: paymentProof, error: proofError } = await supabaseClient
                                        .from('payment_proofs')
                                        .select('*')
                                        .eq('order_id', order.id)
                                        .order('created_at', { ascending: false })
                                        .limit(1)
                                        .maybeSingle();
                                    
                                    const formattedOrder = await this.formatOrderFromSupabase(
                                        order, 
                                        items || [], 
                                        reservation,
                                        paymentProof
                                    );
                                    
                                    return formattedOrder;
                                } catch (error) {
                                    console.error(`Error loading details for order ${order.id}:`, error);
                                    return this.formatOrderFromSupabase(order, [], null, null);
                                }
                            })
                        );
                        
                        localStorage.setItem('customer_orders', JSON.stringify(ordersWithDetails));
                        window.customerOrders = ordersWithDetails;
                        console.log(`✅ Loaded ${ordersWithDetails.length} orders with details`);
                        return ordersWithDetails;
                    } else {
                        const orders = JSON.parse(localStorage.getItem('customer_orders') || '[]');
                        window.customerOrders = orders;
                        return orders;
                    }
                    
                } catch (error) {
                    console.error('Error loading customer orders:', error);
                    const orders = JSON.parse(localStorage.getItem('customer_orders') || '[]');
                    window.customerOrders = orders;
                    return orders;
                }
            }

            async formatOrderFromSupabase(order, items = [], reservation = null, paymentProof = null) {
                try {
                    return {
                        id: order.id,
                        orderNumber: order.order_number,
                        customer: {
                            name: order.customer_name,
                            phone: order.customer_phone,
                            address: order.customer_address
                        },
                        orderType: order.order_type,
                        items: items.map(item => ({
                            id: item.menu_item_id,
                            name: item.menu_item_name,
                            price: item.price,
                            quantity: item.quantity
                        })),
                        total: order.total_amount,
                        status: order.status,
                        paymentMethod: order.payment_method || 'qris',
                        paymentStatus: paymentProof ? paymentProof.status : order.payment_status,
                        createdAt: order.created_at,
                        supabase_id: order.id,
                        reservation: reservation ? {
                            id: reservation.id,
                            tableNumber: reservation.table_number,
                            date: reservation.reservation_date,
                            time: reservation.reservation_time,
                            status: reservation.status
                        } : null,
                        paymentProof: paymentProof ? {
                            id: paymentProof.id,
                            whatsapp_message: paymentProof.whatsapp_message,
                            whatsapp_image_url: paymentProof.whatsapp_image_url,
                            status: paymentProof.status,
                            verified_at: paymentProof.verified_at,
                            created_at: paymentProof.created_at
                        } : null
                    };
                } catch (error) {
                    console.error('Error formatting order:', error);
                    return {
                        id: order.id,
                        orderNumber: order.order_number,
                        customer: {
                            name: order.customer_name,
                            phone: order.customer_phone,
                            address: order.customer_address
                        },
                        orderType: order.order_type,
                        items: items.map(item => ({
                            id: item.menu_item_id,
                            name: item.menu_item_name,
                            price: item.price,
                            quantity: item.quantity
                        })),
                        total: order.total_amount,
                        status: order.status,
                        paymentMethod: order.payment_method || 'qris',
                        paymentStatus: order.payment_status || 'waiting_payment',
                        createdAt: order.created_at,
                        supabase_id: order.id,
                        reservation: reservation,
                        paymentProof: null
                    };
                }
            }

            // ==================== TABLE RESERVATION FUNCTIONS ====================
            async loadAvailableTables(date = null) {
                try {
                    const tables = JSON.parse(localStorage.getItem('cafe_tables') || '[]');
                    
                    if (tables.length === 0) {
                        return this.getDefaultTables();
                    }
                    
                    const targetDate = date || new Date().toISOString().split('T')[0];
                    
                    if (this.isOnline) {
                        try {
                            const { data: reservations, error } = await supabaseClient
                                .from('reservations')
                                .select('*')
                                .eq('reservation_date', targetDate)
                                .in('status', ['confirmed', 'pending']);
                            
                            if (error) {
                                console.error('Error loading reservations:', error);
                                return tables.map(table => ({
                                    ...table,
                                    status: table.status || 'available'
                                }));
                            }
                            
                            if (reservations && reservations.length > 0) {
                                reservations.forEach(reservation => {
                                    const tableIndex = tables.findIndex(t => t.number == reservation.table_number);
                                    if (tableIndex !== -1) {
                                        tables[tableIndex].status = 'reserved';
                                        tables[tableIndex].reservedBy = reservation.customer_name;
                                        tables[tableIndex].reservationTime = reservation.reservation_time;
                                        tables[tableIndex].reservationId = reservation.id;
                                    }
                                });
                            }
                        } catch (error) {
                            console.error('Error loading reservations from Supabase:', error);
                        }
                    }
                    
                    return tables;
                    
                } catch (error) {
                    console.error('Error loading tables:', error);
                    return this.getDefaultTables();
                }
            }

            getDefaultTables() {
                const storedTables = JSON.parse(localStorage.getItem('cafe_tables') || '[]');
                if (storedTables.length > 0) {
                    return storedTables;
                }
                
                const tables = [];
                for (let i = 1; i <= 24; i++) {
                    tables.push({
                        id: i,
                        number: i.toString(),
                        capacity: i <= 8 ? 2 : (i <= 16 ? 4 : 6),
                        status: 'available',
                        location: i <= 12 ? 'indoor' : 'outdoor',
                        description: i <= 8 ? 'Meja kecil' : i <= 16 ? 'Meja sedang' : 'Meja besar',
                        reservedBy: null,
                        reservationTime: null,
                        reservationId: null
                    });
                }
                
                localStorage.setItem('cafe_tables', JSON.stringify(tables));
                return tables;
            }

            async createReservation(orderNumber, tableNumber, reservationDate, reservationTime, customerName, customerPhone) {
                try {
                    console.log('📝 Creating reservation:', { 
                        orderNumber, tableNumber, reservationDate, reservationTime, customerName, customerPhone 
                    });
                    
                    let supabaseReservationId = null;
                    let orderData = null;
                    
                    if (this.isOnline) {
                        const { data: order, error: orderError } = await supabaseClient
                            .from('orders')
                            .select('*')
                            .eq('order_number', orderNumber)
                            .single();
                        
                        if (orderError) {
                            console.error('Order not found in Supabase:', orderError);
                            orderData = { id: Date.now(), order_number: orderNumber };
                        } else {
                            orderData = order;
                        }
                        
                        const { data: existingReservation, error: checkError } = await supabaseClient
                            .from('reservations')
                            .select('*')
                            .eq('table_number', tableNumber)
                            .eq('reservation_date', reservationDate)
                            .eq('reservation_time', reservationTime)
                            .in('status', ['confirmed', 'pending'])
                            .maybeSingle();
                        
                        if (existingReservation) {
                            throw new Error(`Meja ${tableNumber} sudah dipesan untuk ${reservationDate} ${reservationTime}`);
                        }
                        
                        const { data, error: insertError } = await supabaseClient
                            .from('reservations')
                            .insert([{
                                order_id: orderData.id,
                                order_number: orderNumber,
                                table_number: tableNumber,
                                customer_name: customerName,
                                customer_phone: customerPhone,
                                reservation_date: reservationDate,
                                reservation_time: reservationTime,
                                status: 'pending',
                                created_at: new Date().toISOString()
                            }])
                            .select()
                            .single();
                        
                        if (insertError) throw insertError;
                        
                        supabaseReservationId = data.id;
                        console.log('✅ Reservation saved to Supabase');
                        
                        const tables = JSON.parse(localStorage.getItem('cafe_tables') || '[]');
                        const tableIndex = tables.findIndex(t => t.number == tableNumber);
                        if (tableIndex !== -1) {
                            tables[tableIndex].status = 'reserved';
                            localStorage.setItem('cafe_tables', JSON.stringify(tables));
                        }
                        
                        await supabaseClient
                            .from('admin_notifications')
                            .insert([{
                                type: 'new_reservation',
                                title: 'Reservasi Meja Baru!',
                                message: `Meja ${tableNumber} dipesan oleh ${customerName} untuk ${reservationDate} ${reservationTime}`,
                                data: {
                                    reservation_id: data.id,
                                    table_number: tableNumber,
                                    customer_name: customerName,
                                    reservation_date: reservationDate,
                                    reservation_time: reservationTime,
                                    order_number: orderNumber
                                },
                                is_read: false,
                                created_at: new Date().toISOString()
                            }]);
                    }
                    
                    const orders = JSON.parse(localStorage.getItem('customer_orders') || '[]');
                    const orderIndex = orders.findIndex(o => o.orderNumber === orderNumber);
                    
                    if (orderIndex !== -1) {
                        orders[orderIndex].reservation = {
                            id: supabaseReservationId || Date.now(),
                            tableNumber: tableNumber,
                            date: reservationDate,
                            time: reservationTime,
                            status: 'pending'
                        };
                        
                        localStorage.setItem('customer_orders', JSON.stringify(orders));
                        window.customerOrders = orders;
                    }
                    
                    console.log('✅ Reservation created successfully');
                    return true;
                    
                } catch (error) {
                    console.error('❌ Error creating reservation:', error);
                    throw error;
                }
            }

            // ==================== CART FUNCTIONS ====================
            addToCart(menuId) {
                const menu = window.currentMenus.find(item => item.id == menuId);
                if (!menu) return false;
                
                if (!menu.isActive) {
                    showToast('Menu tidak tersedia', 'error');
                    return false;
                }
                
                let availableStock = menu.stock;
                if (menu.isDailyStock) {
                    availableStock = menu.currentDailyStock || 0;
                }
                
                if (availableStock <= 0) {
                    showToast('Stok menu habis', 'error');
                    return false;
                }
                
                const existingItem = this.cart.find(item => item.id == menuId);
                
                if (existingItem) {
                    const newQuantity = existingItem.quantity + 1;
                    if (newQuantity > availableStock) {
                        showToast(`Stok tersedia: ${availableStock}`, 'error');
                        return false;
                    }
                    existingItem.quantity = newQuantity;
                } else {
                    if (1 > availableStock) {
                        showToast(`Stok tersedia: ${availableStock}`, 'error');
                        return false;
                    }
                    this.cart.push({
                        id: menu.id,
                        name: menu.name,
                        price: menu.price,
                        quantity: 1,
                        image: menu.image || menu.image_url
                    });
                }
                
                this.saveCart();
                return true;
            }

            removeFromCart(itemId) {
                this.cart = this.cart.filter(item => item.id != itemId);
                this.saveCart();
            }

            updateCartQuantity(itemId, quantity) {
                if (quantity < 1) {
                    this.removeFromCart(itemId);
                    return;
                }
                
                const menu = window.currentMenus.find(item => item.id == itemId);
                if (menu) {
                    let availableStock = menu.stock;
                    if (menu.isDailyStock) {
                        availableStock = menu.currentDailyStock || 0;
                    }
                    
                    if (quantity > availableStock) {
                        showToast(`Stok tersedia: ${availableStock}`, 'error');
                        return;
                    }
                }
                
                const item = this.cart.find(item => item.id == itemId);
                if (item) {
                    item.quantity = quantity;
                    this.saveCart();
                }
            }

            clearCart() {
                this.cart = [];
                this.saveCart();
            }

            saveCart() {
                localStorage.setItem('customer_cart', JSON.stringify(this.cart));
            }

            getCartTotal() {
                return this.cart.reduce((total, item) => total + (item.price * item.quantity), 0);
            }

            // ==================== UTILITY FUNCTIONS ====================
            startAutoRefresh() {
                if (this.autoRefreshInterval) {
                    clearInterval(this.autoRefreshInterval);
                }
                
                this.autoRefreshInterval = setInterval(async () => {
                    if (this.isOnline) {
                        console.log('🔄 Auto-refreshing data...');
                        await this.loadMenus();
                        await this.loadCustomerOrders();
                        updateOrdersDisplay();
                        updateOrdersCount();
                    }
                }, 30000);
            }
        }

        // ============================
        // GLOBAL VARIABLES
        // ============================
        let customerSystem = null;
        let currentMenus = [];
        let currentFilter = 'all';

        // ============================
        // UTILITY FUNCTIONS
        // ============================
        function showQrisPlaceholder(imgElement) {
            console.log('QRIS image not found, showing placeholder');
            const parent = imgElement.parentElement;
            parent.innerHTML = `
                <div style="text-align: center; width: 100%;">
                    <i class="fas fa-qrcode" style="font-size: 4rem; color: #666; margin-bottom: 0.5rem;"></i>
                    <p style="font-size: 0.9rem; color: #666; margin: 0.5rem 0;">
                        QRIS MAN CAFE
                    </p>
                    <p style="font-size: 0.8rem; color: #999;">
                        Mohon konfirmasi pembayaran ke kasir
                    </p>
                </div>
            `;
        }

        // ============================
        // UI FUNCTIONS
        // ============================
        function renderMenus(menus) {
            currentMenus = menus;
            
            const featuredGrid = document.getElementById('featured-menu');
            if (featuredGrid) {
                const regularMenus = menus.filter(menu => !menu.isPromo);
                featuredGrid.innerHTML = regularMenus.slice(0, 4).map(menu => createMenuCard(menu)).join('');
            }
            
            const allMenuGrid = document.getElementById('all-menu-items');
            if (allMenuGrid) {
                allMenuGrid.innerHTML = menus.map(menu => createMenuCard(menu, true)).join('');
            }
            
            const promoGrid = document.getElementById('promo-menu');
            if (promoGrid) {
                const promoMenus = menus.filter(menu => menu.isPromo);
                if (promoMenus.length > 0) {
                    promoGrid.innerHTML = promoMenus.map(menu => `
                        <div class="promo-card">
                            <span class="promo-badge"><i class="fas fa-tag"></i> Promo</span>
                            <img src="${menu.image_url || menu.image || 'https://via.placeholder.com/400x300?text=Menu+Promo'}" 
                                 alt="${menu.name}"
                                 onerror="this.src='https://via.placeholder.com/400x300?text=Menu+Promo'}">
                            <div class="promo-info">
                                <h3>${menu.name}</h3>
                                <p class="description">${menu.description || 'Tidak ada deskripsi'}</p>
                                <p class="price">
                                    ${menu.originalPrice ? 
                                        `<span class="original-price">Rp ${menu.originalPrice.toLocaleString()}</span>` : 
                                        ''
                                    }
                                    <span class="discount-price">Rp ${menu.price.toLocaleString()}</span>
                                </p>
                                <button class="btn-order" onclick="addToCartFromMenu(${menu.id})">
                                    <i class="fas fa-bolt"></i> Tambah ke Keranjang
                                </button>
                            </div>
                        </div>
                    `).join('');
                } else {
                    promoGrid.innerHTML = `
                        <div style="grid-column: 1/-1; text-align: center; padding: 2rem; color: #666;">
                            <i class="fas fa-tag" style="font-size: 3rem; margin-bottom: 1rem; opacity: 0.3;"></i>
                            <p>Tidak ada promo saat ini</p>
                        </div>
                    `;
                }
            }
        }

        function createMenuCard(item, showCategory = false) {
            const safeItem = {
                id: item.id || Date.now(),
                name: item.name || 'Menu',
                description: item.description || 'Tidak ada deskripsi',
                price: item.price || 0,
                originalPrice: item.originalPrice,
                image: item.image_url || item.image || 'https://via.placeholder.com/400x300?text=Menu',
                category: item.category || 'minuman',
                isPromo: item.isPromo || false,
                stock: item.stock || 0,
                isDailyStock: item.isDailyStock || false,
                currentDailyStock: item.currentDailyStock || 0,
                isActive: item.isActive !== false
            };

            let availableStock = safeItem.stock;
            if (safeItem.isDailyStock) {
                availableStock = safeItem.currentDailyStock || 0;
            }

            const isOutOfStock = availableStock <= 0 || !safeItem.isActive;

            return `
                <div class="menu-card ${isOutOfStock ? 'out-of-stock' : ''}" style="position: relative;">
                    ${safeItem.isPromo ? '<span class="promo-badge"><i class="fas fa-tag"></i> Promo</span>' : ''}
                    ${showCategory ? `<span class="category-badge">${getCategoryText(safeItem.category)}</span>` : ''}
                    
                    <div class="stock-badge ${isOutOfStock ? 'stock-empty' : (availableStock <= 5 ? 'stock-low' : '')}">
                        <i class="fas fa-box${availableStock <= 0 ? '-open' : ''}"></i>
                        ${safeItem.isDailyStock ? 'Stok Harian: ' : 'Stok: '}
                        ${isOutOfStock ? 'HABIS' : availableStock}
                    </div>
                    
                    <img src="${safeItem.image}" 
                         alt="${safeItem.name}"
                         onerror="this.src='https://via.placeholder.com/400x300?text=${encodeURIComponent(safeItem.name)}'">
                    <div class="menu-info">
                        <h3>${safeItem.name}</h3>
                        <p class="description">${safeItem.description}</p>
                        ${safeItem.originalPrice ? 
                            `<p class="price">
                                <span class="original-price">Rp ${safeItem.originalPrice.toLocaleString()}</span>
                                <span class="discount-price">Rp ${safeItem.price.toLocaleString()}</span>
                            </p>` :
                            `<p class="price">Rp ${safeItem.price.toLocaleString()}</p>`
                        }
                        <button class="btn-order" onclick="addToCartFromMenu(${safeItem.id})" 
                                ${isOutOfStock ? 'disabled style="background: #cccccc; cursor: not-allowed;"' : ''}>
                            <i class="fas fa-shopping-cart"></i> 
                            ${isOutOfStock ? 'Stok Habis' : 'Tambah ke Keranjang'}
                        </button>
                    </div>
                </div>
            `;
        }

        function getCategoryText(category) {
            const categoryMap = {
                'minuman': 'Minuman',
                'makanan': 'Makanan',
                'snack': 'Snack',
                'dessert': 'Dessert'
            };
            return categoryMap[category] || category;
        }

        // ==================== CART FUNCTIONS ====================
        function addToCartFromMenu(menuId) {
            if (!customerSystem) return;
            
            if (customerSystem.addToCart(menuId)) {
                updateCartDisplay();
                updateCartCount();
                showToast('Item ditambahkan ke keranjang', 'success');
            }
        }

        function updateCartDisplay() {
            if (!customerSystem) return;
            
            const container = document.getElementById('cart-items-container');
            const emptyMessage = document.getElementById('empty-cart-message');
            const totalDiv = document.getElementById('cart-total');
            const checkoutButtons = document.getElementById('checkout-buttons');
            
            if (customerSystem.cart.length === 0) {
                container.innerHTML = '';
                emptyMessage.style.display = 'block';
                totalDiv.style.display = 'none';
                checkoutButtons.style.display = 'none';
                return;
            }
            
            emptyMessage.style.display = 'none';
            container.innerHTML = '';
            
            customerSystem.cart.forEach(item => {
                const itemTotal = item.price * item.quantity;
                container.innerHTML += `
                    <div class="cart-item">
                        <div style="flex: 1;">
                            <h4 style="margin: 0 0 0.3rem 0; font-size: 0.95rem;">${item.name}</h4>
                            <p style="margin: 0; font-size: 0.85rem; color: #666;">Rp ${item.price.toLocaleString()}</p>
                        </div>
                        <div style="display: flex; align-items: center; gap: 1rem;">
                            <div class="quantity-control">
                                <button class="quantity-btn" onclick="updateCartItemQuantity(${item.id}, ${item.quantity - 1})">-</button>
                                <span style="min-width: 20px; text-align: center;">${item.quantity}</span>
                                <button class="quantity-btn" onclick="updateCartItemQuantity(${item.id}, ${item.quantity + 1})">+</button>
                            </div>
                            <p style="font-weight: bold; font-size: 0.95rem;">Rp ${itemTotal.toLocaleString()}</p>
                            <button onclick="removeCartItem(${item.id})" style="color: #dc3545; background: none; border: none; cursor: pointer; padding: 0.3rem;">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                `;
            });
            
            document.getElementById('total-amount').textContent = customerSystem.getCartTotal().toLocaleString();
            totalDiv.style.display = 'block';
            checkoutButtons.style.display = 'flex';
        }

        function updateCartItemQuantity(itemId, quantity) {
            if (!customerSystem) return;
            customerSystem.updateCartQuantity(itemId, quantity);
            updateCartDisplay();
            updateCartCount();
        }

        function removeCartItem(itemId) {
            if (!customerSystem) return;
            customerSystem.removeFromCart(itemId);
            updateCartDisplay();
            updateCartCount();
            showToast('Item dihapus dari keranjang', 'info');
        }

        function updateCartCount() {
            if (!customerSystem) return;
            const count = customerSystem.cart.reduce((total, item) => total + item.quantity, 0);
            document.querySelector('.cart-count').textContent = count;
        }

        function clearCart() {
            if (!customerSystem) return;
            
            if (customerSystem.cart.length === 0) {
                showToast('Keranjang sudah kosong', 'info');
                return;
            }
            
            if (confirm('Yakin ingin mengosongkan keranjang?')) {
                customerSystem.clearCart();
                updateCartDisplay();
                updateCartCount();
                showToast('Keranjang dikosongkan', 'info');
            }
        }

        // ==================== ORDER FUNCTIONS ====================
        function showOrders(filter, eventElement = null) {
            currentFilter = filter;
            const container = document.getElementById('orders-container');
            const orders = window.customerOrders || [];
            
            let filteredOrders = orders;
            
            if (filter === 'pending') {
                filteredOrders = orders.filter(order => order.status === 'pending');
            } else if (filter === 'confirmed') {
                filteredOrders = orders.filter(order => order.status === 'confirmed');
            } else if (filter === 'reservations') {
                filteredOrders = orders.filter(order => 
                    order.orderType === 'dine_in' &&
                    order.reservation
                );
            }
            
            displayOrders(filteredOrders, container, filter);
            
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            if (eventElement) {
                eventElement.classList.add('active');
            } else {
                const targetBtn = document.querySelector(`.tab-btn[onclick*="${filter}"]`);
                if (targetBtn) {
                    targetBtn.classList.add('active');
                }
            }
        }

        function displayOrders(ordersList, container, filter) {
            if (ordersList.length === 0) {
                let message = 'Belum ada pesanan yang Anda buat';
                if (filter === 'pending') message = 'Tidak ada pesanan yang menunggu konfirmasi';
                if (filter === 'confirmed') message = 'Tidak ada pesanan yang sudah dikonfirmasi';
                if (filter === 'reservations') message = 'Tidak ada reservasi meja';
                
                container.innerHTML = `
                    <div class="no-orders">
                        <i class="fas fa-clipboard-list"></i>
                        <h3>Tidak ada pesanan</h3>
                        <p>${message}</p>
                        ${filter === 'confirmed' ? 
                            '<p><small>Pesanan yang sudah dikonfirmasi admin akan muncul di sini</small></p>' : 
                            ''
                        }
                    </div>
                `;
                return;
            }
            
            container.innerHTML = ordersList.map(order => {
                const statusText = {
                    'pending': 'Menunggu Konfirmasi',
                    'confirmed': 'Dikonfirmasi',
                    'completed': 'Selesai',
                    'cancelled': 'Dibatalkan'
                };
                
                const paymentStatusText = {
                    'waiting_payment': 'Menunggu Pembayaran',
                    'waiting_verification': 'Menunggu Verifikasi',
                    'verified': 'Terverifikasi',
                    'paid': 'Lunas',
                    'failed': 'Gagal'
                };
                
                const statusClass = {
                    'pending': 'status-pending',
                    'confirmed': 'status-confirmed',
                    'completed': 'status-completed',
                    'cancelled': 'status-cancelled'
                };
                
                const canReserve = order.status === 'confirmed' && 
                                 order.orderType === 'dine_in' && 
                                 !order.reservation;
                
                const hasReservation = order.reservation !== null;
                
                const canUploadProof = order.paymentStatus === 'waiting_payment' && 
                                      order.status === 'pending';
                
                const hasPaymentProof = order.paymentProof !== null;
                
                return `
                    <div class="order-card">
                        <div class="order-header">
                            <div class="order-number">${order.orderNumber}</div>
                            <span class="order-status ${statusClass[order.status]}">
                                ${statusText[order.status] || order.status}
                            </span>
                        </div>
                        <div class="order-details">
                            <div class="detail-item">
                                <strong>Nama:</strong> ${order.customer.name}
                            </div>
                            <div class="detail-item">
                                <strong>Tanggal:</strong> ${new Date(order.createdAt).toLocaleDateString('id-ID', {
                                    day: '2-digit',
                                    month: '2-digit',
                                    year: 'numeric',
                                    hour: '2-digit',
                                    minute: '2-digit'
                                })}
                            </div>
                            <div class="detail-item">
                                <strong>Total:</strong> Rp ${order.total.toLocaleString()}
                            </div>
                            <div class="detail-item">
                                <strong>Tipe:</strong> ${order.orderType === 'dine_in' ? 'Makan di Tempat' : 'Bawa Pulang'}
                            </div>
                            <div class="detail-item">
                                <strong>Status Pembayaran:</strong> 
                                <span class="${order.paymentStatus === 'verified' || order.paymentStatus === 'paid' ? 'status-confirmed' : 
                                              order.paymentStatus === 'waiting_verification' ? 'status-pending' : 
                                              'status-pending'}" 
                                      style="padding: 2px 8px; border-radius: 12px; font-size: 0.8rem;">
                                    ${paymentStatusText[order.paymentStatus] || 'Menunggu'}
                                </span>
                            </div>
                            <div class="detail-item">
                                <strong>Metode:</strong> QRIS
                            </div>
                        </div>
                        ${hasPaymentProof ? `
                            <div style="background: ${order.paymentProof.status === 'verified' ? '#e7f4e4' : 
                                                      order.paymentProof.status === 'waiting_verification' ? '#fff3cd' : 
                                                      '#f8d7da'}; 
                                         padding: 0.8rem; border-radius: 6px; margin: 0.8rem 0; 
                                         border-left: 4px solid ${order.paymentProof.status === 'verified' ? '#28a745' : 
                                                                 order.paymentProof.status === 'waiting_verification' ? '#ffc107' : 
                                                                 '#dc3545'};">
                                <p style="margin: 0; font-size: 0.9rem; 
                                          color: ${order.paymentProof.status === 'verified' ? '#155724' : 
                                                  order.paymentProof.status === 'waiting_verification' ? '#856404' : 
                                                  '#721c24'};">
                                    <i class="fas ${order.paymentProof.status === 'verified' ? 'fa-check-circle' : 
                                                     order.paymentProof.status === 'waiting_verification' ? 'fa-clock' : 
                                                     'fa-exclamation-circle'}"></i> 
                                    <strong>Bukti transfer dikirim via WhatsApp</strong><br>
                                    <small>
                                        Status: ${order.paymentProof.status === 'verified' ? 'Terverifikasi' : 
                                                 order.paymentProof.status === 'waiting_verification' ? 'Menunggu verifikasi admin' : 
                                                 'Ditolak'} <br>
                                        ${order.paymentProof.verified_at ? 
                                            `Diverifikasi: ${new Date(order.paymentProof.verified_at).toLocaleDateString('id-ID')}` : 
                                            order.paymentProof.status === 'waiting_verification' ? 
                                            'Admin akan memverifikasi bukti transfer Anda' : ''}
                                    </small>
                                </p>
                            </div>
                        ` : ''}
                        ${hasReservation ? `
                            <div class="order-details">
                                <div class="detail-item">
                                    <strong><i class="fas fa-chair"></i> Meja:</strong> No. ${order.reservation.tableNumber}
                                </div>
                                <div class="detail-item">
                                    <strong><i class="fas fa-calendar"></i> Tanggal:</strong> ${new Date(order.reservation.date).toLocaleDateString('id-ID')}
                                </div>
                                <div class="detail-item">
                                    <strong><i class="fas fa-clock"></i> Waktu:</strong> ${order.reservation.time}
                                </div>
                                <div class="detail-item">
                                    <strong>Status:</strong> 
                                    <span class="${order.reservation.status === 'confirmed' ? 'status-confirmed' : 'status-pending'}" 
                                          style="padding: 2px 8px; border-radius: 12px; font-size: 0.8rem;">
                                        ${order.reservation.status === 'confirmed' ? 'Terkonfirmasi' : 'Menunggu Konfirmasi'}
                                    </span>
                                </div>
                            </div>
                        ` : ''}
                        <div class="order-items">
                            <h4>Items Pesanan:</h4>
                            ${order.items.map(item => `
                                <div class="order-item">
                                    <span>${item.name} (${item.quantity}x)</span>
                                    <span>Rp ${(item.price * item.quantity).toLocaleString()}</span>
                                </div>
                            `).join('')}
                            <div class="order-total">
                                Total: Rp ${order.total.toLocaleString()}
                            </div>
                        </div>
                        <div style="display: flex; gap: 0.8rem; margin-top: 1rem; flex-wrap: wrap;">
                            ${!hasPaymentProof && canUploadProof ? `
                                <button class="btn-primary" onclick="openWhatsAppForPayment('${order.orderNumber}', ${order.total})" style="padding: 0.6rem 1.2rem; background: #25D366;">
                                    <i class="fab fa-whatsapp"></i> Kirim Bukti via WhatsApp
                                </button>
                            ` : ''}
                            ${canReserve ? `
                                <button class="btn-primary" onclick="openReservationModal('${order.orderNumber}')" style="padding: 0.6rem 1.2rem;">
                                    <i class="fas fa-calendar-plus"></i> Reservasi Meja
                                </button>
                            ` : ''}
                        </div>
                        ${!hasPaymentProof && canUploadProof ? `
                            <p style="font-size: 0.8rem; color: #666; margin-top: 0.5rem;">
                                <i class="fas fa-info-circle"></i> Kirim bukti transfer QRIS via WhatsApp untuk mempercepat proses verifikasi pesanan Anda.
                            </p>
                        ` : ''}
                    </div>
                `;
            }).join('');
        }

        function updateOrdersDisplay() {
            if (window.location.hash === '#my-orders' && currentFilter) {
                showOrders(currentFilter);
            }
        }

        function updateOrdersCount() {
            if (!window.customerOrders) return;
            
            const pendingOrders = window.customerOrders.filter(order => order.status === 'pending').length;
            const ordersCountElement = document.querySelector('.orders-count');
            ordersCountElement.textContent = pendingOrders;
            
            if (pendingOrders > 0) {
                if (!ordersCountElement.querySelector('.notification-badge')) {
                    const badge = document.createElement('span');
                    badge.className = 'notification-badge';
                    badge.textContent = pendingOrders;
                    ordersCountElement.appendChild(badge);
                } else {
                    ordersCountElement.querySelector('.notification-badge').textContent = pendingOrders;
                }
            } else {
                const badge = ordersCountElement.querySelector('.notification-badge');
                if (badge) badge.remove();
            }
        }

        // ==================== CHECKOUT FUNCTIONS ====================
        function toggleReservationInfo() {
            const orderType = document.getElementById('orderType').value;
            const reservationInfo = document.getElementById('reservationInfo');
            
            if (orderType === 'dine_in') {
                reservationInfo.style.display = 'block';
            } else {
                reservationInfo.style.display = 'none';
            }
        }

        function openCheckoutModal() {
            if (!customerSystem || customerSystem.cart.length === 0) {
                showToast('Keranjang masih kosong', 'error');
                return;
            }
            
            const hasEnoughStock = validateStockBeforeCheckout();
            if (!hasEnoughStock) {
                showToast('Stok tidak mencukupi untuk beberapa item. Silakan perbarui keranjang.', 'error');
                return;
            }
            
            const modal = document.getElementById('checkoutModal');
            const summary = document.getElementById('order-summary-compact');
            const qrisAmount = document.getElementById('qris-amount');
            
            let summaryHTML = '<h4 style="margin-top: 0; margin-bottom: 0.5rem;">Pesanan Anda:</h4>';
            let total = 0;
            
            customerSystem.cart.forEach(item => {
                const itemTotal = item.price * item.quantity;
                total += itemTotal;
                summaryHTML += `<div style="font-size: 0.85rem; margin-bottom: 0.3rem;">
                    ${item.name} (${item.quantity}x) <span style="float: right;">Rp ${itemTotal.toLocaleString()}</span>
                </div>`;
            });
            
            summaryHTML += `<div style="border-top: 1px solid #ddd; margin-top: 0.5rem; padding-top: 0.5rem; font-weight: bold;">
                Total <span style="float: right;">Rp ${total.toLocaleString()}</span>
            </div>`;
            summary.innerHTML = summaryHTML;
            
            if (qrisAmount) {
                qrisAmount.textContent = `Rp ${total.toLocaleString()}`;
            }
            
            document.getElementById('checkoutForm').reset();
            document.getElementById('reservationInfo').style.display = 'none';
            
            setupCheckoutFormListener();
            
            modal.style.display = 'flex';
        }

        function validateStockBeforeCheckout() {
            if (!customerSystem || !window.currentMenus) return false;
            
            let validationPassed = true;
            let errorMessages = [];
            
            for (const cartItem of customerSystem.cart) {
                const menuItem = window.currentMenus.find(m => m.id == cartItem.id);
                if (!menuItem) {
                    console.error(`Menu item ${cartItem.id} not found`);
                    errorMessages.push(`Menu tidak ditemukan`);
                    validationPassed = false;
                    continue;
                }
                
                if (!menuItem.isActive) {
                    errorMessages.push(`Menu "${menuItem.name}" tidak tersedia`);
                    validationPassed = false;
                    continue;
                }
                
                let availableStock = menuItem.stock;
                if (menuItem.isDailyStock && menuItem.currentDailyStock !== null) {
                    availableStock = menuItem.currentDailyStock || 0;
                }
                
                if (availableStock <= 0) {
                    errorMessages.push(`Menu "${menuItem.name}" stok habis`);
                    validationPassed = false;
                } else if (cartItem.quantity > availableStock) {
                    errorMessages.push(`Menu "${menuItem.name}" stok tidak cukup (tersedia: ${availableStock})`);
                    validationPassed = false;
                }
            }
            
            if (!validationPassed) {
                showToast(errorMessages.join('<br>'), 'error');
            }
            
            return validationPassed;
        }

        function setupCheckoutFormListener() {
            const checkoutForm = document.getElementById('checkoutForm');
            if (!checkoutForm) return;
            
            const newForm = checkoutForm.cloneNode(true);
            checkoutForm.parentNode.replaceChild(newForm, checkoutForm);
            
            document.getElementById('checkoutForm').addEventListener('submit', async function(e) {
                e.preventDefault();
                await processCheckout();
            });
        }

        async function processCheckout() {
            if (!customerSystem) return;
            
            const submitBtn = document.getElementById('submitOrderBtn');
            const originalText = submitBtn.innerHTML;
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Memproses...';
            
            try {
                const customerName = document.getElementById('customerName').value;
                const customerPhone = document.getElementById('customerPhone').value;
                const orderType = document.getElementById('orderType').value;
                
                if (!customerName || !customerPhone || !orderType || orderType === '') {
                    showToast('Harap isi semua field yang wajib', 'error');
                    submitBtn.disabled = false;
                    submitBtn.innerHTML = originalText;
                    return;
                }
                
                if (customerSystem.cart.length === 0) {
                    showToast("Keranjang masih kosong", "error");
                    submitBtn.disabled = false;
                    submitBtn.innerHTML = originalText;
                    return;
                }
                
                const hasEnoughStock = validateStockBeforeCheckout();
                if (!hasEnoughStock) {
                    showToast('Stok tidak mencukupi untuk beberapa item. Silakan perbarui keranjang.', 'error');
                    submitBtn.disabled = false;
                    submitBtn.innerHTML = originalText;
                    return;
                }
                
                const orderData = {
                    customer: {
                        name: customerName,
                        phone: customerPhone,
                        address: '-'
                    },
                    orderType: orderType,
                    items: customerSystem.cart.map(item => ({
                        id: item.id,
                        name: item.name,
                        price: item.price,
                        quantity: item.quantity
                    })),
                    total: customerSystem.getCartTotal()
                };
                
                const order = await customerSystem.createOrder(orderData);
                
                customerSystem.clearCart();
                updateCartDisplay();
                updateCartCount();
                
                closeModal('checkoutModal');
                
                showTransferSuccessModal(order);
                
                await customerSystem.loadCustomerOrders();
                updateOrdersDisplay();
                updateOrdersCount();
                
                console.log('✅ Checkout successful:', order.orderNumber);
                
            } catch (error) {
                console.error('❌ Checkout error:', error);
                showToast("Gagal memproses pesanan: " + error.message, "error");
            } finally {
                submitBtn.disabled = false;
                submitBtn.innerHTML = originalText;
            }
        }

        function showTransferSuccessModal(order) {
            const modal = document.getElementById('transferSuccessModal');
            const successQrisAmount = document.getElementById('success-qris-amount');
            const whatsappLink = document.getElementById('whatsapp-link');
            
            if (successQrisAmount) {
                successQrisAmount.textContent = `Rp ${order.total.toLocaleString()}`;
            }
            
            if (whatsappLink) {
                const whatsappMessage = `Halo MAN CAFE, saya sudah transfer untuk pesanan ${order.orderNumber} sebesar Rp ${order.total.toLocaleString()}. Nama: ${order.customer.name}, No. HP: ${order.customer.phone}`;
                whatsappLink.href = `https://wa.me/6283832184173?text=${encodeURIComponent(whatsappMessage)}`;
            }
            
            const qrisImage = modal.querySelector('.qris-image img');
            if (qrisImage) {
                qrisImage.src = qrisImage.src;
            }
            
            const reservationInfo = modal.querySelector('.f0f9ff');
            if (reservationInfo && order.orderType === 'dine_in') {
                reservationInfo.querySelector('p').innerHTML = `
                    Jika Anda memilih "Makan di Tempat", setelah pesanan dikonfirmasi admin, Anda dapat melakukan reservasi meja di halaman <strong>"Pesanan Saya"</strong>.
                `;
            }
            
            modal.style.display = 'flex';
        }

        // ==================== FUNGSI WHATSAPP UNTUK BUKTI TRANSFER ====================
        function openWhatsAppForPayment(orderNumber, totalAmount) {
            const whatsappMessage = `Halo MAN CAFE, saya sudah transfer untuk pesanan ${orderNumber} sebesar Rp ${totalAmount.toLocaleString()}. Berikut bukti transfer saya:`;
            const whatsappUrl = `https://wa.me/6283832184173?text=${encodeURIComponent(whatsappMessage)}`;
            window.open(whatsappUrl, '_blank');
            
            showToast('Buka WhatsApp dan kirim bukti transfer', 'info');
            
            // Update status payment proof di database jika online
            if (customerSystem && customerSystem.isOnline) {
                setTimeout(async () => {
                    try {
                        const { data: order } = await supabaseClient
                            .from('orders')
                            .select('id')
                            .eq('order_number', orderNumber)
                            .single();
                        
                        if (order) {
                            await supabaseClient
                                .from('payment_proofs')
                                .insert([{
                                    order_id: order.id,
                                    whatsapp_message: whatsappMessage,
                                    status: 'waiting_verification',
                                    created_at: new Date().toISOString()
                                }]);
                            
                            await supabaseClient
                                .from('orders')
                                .update({ payment_status: 'waiting_verification' })
                                .eq('id', order.id);
                            
                            await customerSystem.loadCustomerOrders();
                            updateOrdersDisplay();
                            showToast('Status pembayaran diperbarui. Admin akan memverifikasi bukti transfer Anda.', 'success');
                        }
                    } catch (error) {
                        console.error('Error updating payment proof status:', error);
                    }
                }, 1000);
            }
        }

        // ==================== RESERVATION FUNCTIONS ====================
        async function openReservationModal(orderNumber) {
            console.log('openReservationModal called with:', orderNumber);
            
            if (!customerSystem) {
                showToast('Sistem tidak siap', 'error');
                return;
            }
            
            try {
                let order = null;
                
                order = window.customerOrders?.find(o => o.orderNumber === orderNumber);
                
                if (!order && !orderNumber.startsWith('ORD-')) {
                    order = window.customerOrders?.find(o => o.orderNumber === `ORD-${orderNumber}`);
                }
                
                if (!order) {
                    order = window.customerOrders?.find(o => 
                        o.supabase_id && o.supabase_id.toString() === orderNumber
                    );
                }
                
                console.log('Found order:', order);
                
                if (!order) {
                    showToast(`Order ${orderNumber} tidak ditemukan`, 'error');
                    return;
                }
                
                if (order.status !== 'confirmed') {
                    showToast('Hanya pesanan yang sudah dikonfirmasi yang dapat reservasi meja', 'error');
                    return;
                }
                
                if (order.reservation) {
                    showToast('Order ini sudah memiliki reservasi meja', 'info');
                    return;
                }
                
                customerSystem.selectedOrderForReservation = order;
                
                const tomorrow = new Date();
                tomorrow.setDate(tomorrow.getDate() + 1);
                const defaultDate = tomorrow.toISOString().split('T')[0];
                
                const modal = document.getElementById('reservationModal');
                const content = document.getElementById('reservation-content');
                
                const timeSlots = [];
                for (let hour = 11; hour <= 22; hour++) {
                    timeSlots.push(`${hour.toString().padStart(2, '0')}:00`);
                    if (hour < 22) timeSlots.push(`${hour.toString().padStart(2, '0')}:30`);
                }
                
                content.innerHTML = `
                    <div style="background: #e7f4e4; padding: 1rem; border-radius: 8px; margin-bottom: 1.5rem; border-left: 4px solid var(--success-color);">
                        <p style="margin: 0; color: #155724;">
                            <i class="fas fa-info-circle"></i> Anda akan melakukan reservasi untuk pesanan: <strong>${orderNumber}</strong>
                            <br><small>Nama: ${order.customer.name} | Total: Rp ${order.total.toLocaleString()}</small>
                        </p>
                    </div>
                    
                    <div class="form-group">
                        <label for="reservationDate">Tanggal Reservasi *</label>
                        <input type="date" id="reservationDate" required 
                               min="${new Date().toISOString().split('T')[0]}" 
                               value="${defaultDate}"
                               onchange="loadTablesForDate(this.value)">
                    </div>
                    
                    <div class="form-group">
                        <label>Pilih Waktu *</label>
                        <p style="font-size: 0.9rem; color: #666; margin-bottom: 0.5rem;">
                            <i class="fas fa-clock"></i> Pilih waktu kunjungan Anda (11:00 - 22:00)
                        </p>
                        <div class="time-slot-grid" id="time-slots">
                            ${timeSlots.map(time => `
                                <div class="time-slot" onclick="selectTimeSlot(this, '${time}')">
                                    ${time}
                                </div>
                            `).join('')}
                        </div>
                        <input type="hidden" id="selectedTime" required>
                    </div>
                    
                    <div class="form-group">
                        <label>Pilih Meja *</label>
                        <p style="font-size: 0.9rem; color: #666; margin-bottom: 0.5rem;">
                            <i class="fas fa-info-circle"></i> 
                            <span style="color: var(--success-color);">Hijau</span>: Tersedia • 
                            <span style="color: #856404;">Kuning</span>: Terisi • 
                            <span style="color: #721c24;">Merah</span>: Dipesan • 
                            <span style="color: #6c757d;">Abu-abu</span>: Perbaikan
                        </p>
                        <div class="table-grid" id="table-selection">
                            <!-- Tables will be loaded here -->
                        </div>
                        <input type="hidden" id="selectedTable" required>
                    </div>
                    
                    <div id="reservation-summary" style="background: #f8f9fa; padding: 1rem; border-radius: 8px; margin: 1rem 0; display: none;">
                        <h4 style="margin-top: 0;"><i class="fas fa-calendar-check"></i> Ringkasan Reservasi:</h4>
                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 0.5rem; margin-top: 0.5rem;">
                            <div>
                                <strong>Meja:</strong><br>
                                <span id="summary-table" style="font-size: 1.2rem; font-weight: bold; color: var(--primary-color);">-</span>
                            </div>
                            <div>
                                <strong>Tanggal:</strong><br>
                                <span id="summary-date">-</span>
                            </div>
                            <div>
                                <strong>Waktu:</strong><br>
                                <span id="summary-time">-</span>
                            </div>
                            <div>
                                <strong>Status:</strong><br>
                                <span style="color: var(--warning-color); font-weight: bold;">Menunggu Konfirmasi</span>
                            </div>
                        </div>
                    </div>
                    
                    <button type="button" class="modal-submit-btn" id="submitReservationBtn" onclick="submitReservation()" disabled>
                        <i class="fas fa-calendar-check"></i> Konfirmasi Reservasi
                    </button>
                    
                    <p style="font-size: 0.8rem; color: #666; text-align: center; margin-top: 1rem;">
                        <i class="fas fa-exclamation-triangle"></i> Pastikan Anda datang tepat waktu sesuai reservasi. Reservasi akan dikonfirmasi oleh admin.
                    </p>
                `;
                
                modal.style.display = 'flex';
                
                await loadTablesForDate(defaultDate);
                
            } catch (error) {
                console.error('Error in openReservationModal:', error);
                showToast('Gagal memuat halaman reservasi: ' + error.message, 'error');
            }
        }

        function selectTimeSlot(element, time) {
            console.log('selectTimeSlot called with:', element, time);
            
            try {
                document.querySelectorAll('.time-slot').forEach(slot => {
                    slot.classList.remove('selected');
                });
                
                element.classList.add('selected');
                
                const selectedTimeInput = document.getElementById('selectedTime');
                if (selectedTimeInput) {
                    selectedTimeInput.value = time;
                } else {
                    const input = document.createElement('input');
                    input.type = 'hidden';
                    input.id = 'selectedTime';
                    input.value = time;
                    element.closest('.modal-content').appendChild(input);
                }
                
                updateReservationSummary();
                
            } catch (error) {
                console.error('Error in selectTimeSlot:', error);
                showToast('Gagal memilih waktu', 'error');
            }
        }

        function selectTable(element, tableNumber) {
            console.log('selectTable called with:', element, tableNumber);
            
            try {
                document.querySelectorAll('.table-item').forEach(item => {
                    item.classList.remove('selected');
                });
                
                element.classList.add('selected');
                
                const selectedTableInput = document.getElementById('selectedTable');
                if (selectedTableInput) {
                    selectedTableInput.value = tableNumber;
                } else {
                    const input = document.createElement('input');
                    input.type = 'hidden';
                    input.id = 'selectedTable';
                    input.value = tableNumber;
                    element.closest('.modal-content').appendChild(input);
                }
                
                updateReservationSummary();
                
            } catch (error) {
                console.error('Error in selectTable:', error);
                showToast('Gag memilih meja', 'error');
            }
        }

        async function loadTablesForDate(date) {
            console.log('loadTablesForDate called with:', date);
            
            if (!customerSystem) {
                showToast('Sistem tidak siap', 'error');
                return;
            }
            
            try {
                const tables = await customerSystem.loadAvailableTables(date);
                const tableSelection = document.getElementById('table-selection');
                const selectedTime = document.getElementById('selectedTime')?.value;
                
                if (document.getElementById('selectedTable')) {
                    document.getElementById('selectedTable').value = '';
                }
                if (document.getElementById('selectedTime')) {
                    document.getElementById('selectedTime').value = selectedTime || '';
                }
                if (document.getElementById('submitReservationBtn')) {
                    document.getElementById('submitReservationBtn').disabled = true;
                }
                if (document.getElementById('reservation-summary')) {
                    document.getElementById('reservation-summary').style.display = 'none';
                }
                
                tableSelection.innerHTML = tables.map(table => {
                    let statusClass = '';
                    let statusText = '';
                    
                    switch(table.status) {
                        case 'available':
                            statusClass = '';
                            statusText = '<i class="fas fa-check"></i> Tersedia';
                            break;
                        case 'occupied':
                            statusClass = 'occupied';
                            statusText = '<i class="fas fa-user-clock"></i> Terisi';
                            break;
                        case 'reserved':
                            statusClass = 'reserved';
                            statusText = '<i class="fas fa-calendar-check"></i> Dipesan';
                            break;
                        case 'maintenance':
                            statusClass = 'maintenance';
                            statusText = '<i class="fas fa-tools"></i> Perbaikan';
                            break;
                        default:
                            statusClass = '';
                            statusText = '<i class="fas fa-check"></i> Tersedia';
                    }
                    
                    const isClickable = table.status === 'available';
                    
                    return `
                        <div class="table-item ${statusClass}" 
                             ${isClickable ? `onclick="selectTable(this, '${table.number}')"` : ''}>
                            <div class="table-number">${table.number}</div>
                            <div class="table-status">
                                ${statusText}
                            </div>
                            <div class="table-details">
                                <i class="fas fa-user"></i> ${table.capacity} orang<br>
                                <i class="fas fa-map-marker-alt"></i> ${getTableLocationText(table.location)}
                            </div>
                            ${table.status === 'reserved' ? 
                                `<small style="color: #dc3545; display: block; margin-top: 0.3rem; font-size: 0.7rem;">
                                    <i class="fas fa-clock"></i> ${table.reservationTime || ''}
                                </small>` : ''
                            }
                        </div>
                    `;
                }).join('');
                
                document.querySelectorAll('.time-slot').forEach(slot => {
                    slot.classList.remove('selected');
                });
                
            } catch (error) {
                console.error('Error in loadTablesForDate:', error);
                showToast('Gagal memuat daftar meja: ' + error.message, 'error');
            }
        }

        function getTableLocationText(location) {
            const locations = {
                'indoor': 'Indoor',
                'outdoor': 'Outdoor',
                'smoking_area': 'Smoking Area',
                'vip': 'VIP Room'
            };
            return locations[location] || location;
        }

        function updateReservationSummary() {
            const table = document.getElementById('selectedTable')?.value;
            const date = document.getElementById('reservationDate')?.value;
            const time = document.getElementById('selectedTime')?.value;
            
            console.log('updateReservationSummary called with:', { table, date, time });
            
            if (table && date && time) {
                document.getElementById('summary-table').textContent = `Meja ${table}`;
                document.getElementById('summary-date').textContent = new Date(date).toLocaleDateString('id-ID', {
                    weekday: 'long',
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                });
                document.getElementById('summary-time').textContent = time;
                document.getElementById('reservation-summary').style.display = 'block';
                document.getElementById('submitReservationBtn').disabled = false;
            }
        }

        async function submitReservation() {
            console.log('submitReservation called');
            
            if (!customerSystem) {
                showToast('Sistem tidak siap', 'error');
                return;
            }
            
            const submitBtn = document.getElementById('submitReservationBtn');
            if (!submitBtn) {
                showToast('Tombol tidak ditemukan', 'error');
                return;
            }
            
            const originalText = submitBtn.innerHTML;
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Memproses...';
            
            try {
                console.log('Submitting reservation with values:');
                console.log('Table:', document.getElementById('selectedTable')?.value);
                console.log('Date:', document.getElementById('reservationDate')?.value);
                console.log('Time:', document.getElementById('selectedTime')?.value);
                console.log('Order:', customerSystem.selectedOrderForReservation);
                
                const tableNumber = document.getElementById('selectedTable')?.value;
                const reservationDate = document.getElementById('reservationDate')?.value;
                const reservationTime = document.getElementById('selectedTime')?.value;
                const order = customerSystem.selectedOrderForReservation;
                
                if (!tableNumber) {
                    throw new Error('Meja belum dipilih');
                }
                
                if (!reservationDate) {
                    throw new Error('Tanggal belum dipilih');
                }
                
                if (!reservationTime) {
                    throw new Error('Waktu belum dipilih');
                }
                
                if (!order) {
                    throw new Error('Data pesanan tidak ditemukan. Silakan refresh halaman.');
                }
                
                if (!order.orderNumber) {
                    throw new Error('Nomor pesanan tidak valid');
                }
                
                if (!order.customer?.name || !order.customer?.phone) {
                    throw new Error('Data pelanggan tidak lengkap');
                }
                
                const confirmationMessage = 
                    `Konfirmasi reservasi:\n\n` +
                    `Meja: ${tableNumber}\n` +
                    `Tanggal: ${new Date(reservationDate).toLocaleDateString('id-ID')}\n` +
                    `Waktu: ${reservationTime}\n` +
                    `Pesanan: ${order.orderNumber}\n\n` +
                    `Apakah data sudah benar?`;
                
                if (!confirm(confirmationMessage)) {
                    submitBtn.disabled = false;
                    submitBtn.innerHTML = originalText;
                    return;
                }
                
                console.log(`Submitting reservation for order ${order.orderNumber}...`);
                
                const success = await customerSystem.createReservation(
                    order.orderNumber,
                    tableNumber,
                    reservationDate,
                    reservationTime,
                    order.customer.name,
                    order.customer.phone
                );
                
                if (success) {
                    showToast('Reservasi berhasil dibuat! Menunggu konfirmasi admin.', 'success');
                    closeModal('reservationModal');
                    
                    customerSystem.selectedOrderForReservation = null;
                    
                    await customerSystem.loadCustomerOrders();
                    updateOrdersDisplay();
                    updateOrdersCount();
                    
                    setTimeout(() => {
                        showOrders('reservations');
                        window.location.hash = '#my-orders';
                    }, 500);
                    
                } else {
                    throw new Error('Gagal membuat reservasi');
                }
                
            } catch (error) {
                console.error('Error in submitReservation:', error);
                showToast(`Gagal membuat reservasi: ${error.message}`, 'error');
                submitBtn.disabled = false;
                submitBtn.innerHTML = originalText;
            }
        }

        // ==================== UTILITY FUNCTIONS ====================
        function showToast(message, type = 'success') {
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.innerHTML = `
                <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'}"></i>
                <span>${message}</span>
            `;
            document.body.appendChild(toast);
            
            setTimeout(() => toast.classList.add('show'), 100);
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        // ==================== NAVIGATION FUNCTIONS ====================
        function setupNavigation() {
            const hamburger = document.getElementById('hamburger');
            const navLinks = document.getElementById('navLinks');
            
            if (hamburger && navLinks) {
                hamburger.addEventListener('click', function() {
                    navLinks.classList.toggle('active');
                });
            }
            
            document.querySelectorAll('a[href^="#"]').forEach(anchor => {
                anchor.addEventListener('click', function(e) {
                    const href = this.getAttribute('href');
                    
                    if (href === '#') {
                        e.preventDefault();
                        return;
                    }
                    
                    const target = document.querySelector(href);
                    if (target) {
                        e.preventDefault();
                        
                        target.scrollIntoView({
                            behavior: 'smooth',
                            block: 'start'
                        });
                        
                        document.querySelectorAll('.nav-links a').forEach(link => {
                            link.classList.remove('active');
                        });
                        this.classList.add('active');
                        
                        if (navLinks) {
                            navLinks.classList.remove('active');
                        }
                    }
                });
            });
            
            window.addEventListener('scroll', function() {
                const header = document.getElementById('header');
                if (window.scrollY > 50) {
                    header.classList.add('scrolled');
                } else {
                    header.classList.remove('scrolled');
                }
                
                const sections = document.querySelectorAll('section[id]');
                const navLinks = document.querySelectorAll('.nav-links a');
                
                let current = '';
                sections.forEach(section => {
                    const sectionTop = section.offsetTop;
                    const sectionHeight = section.clientHeight;
                    if (scrollY >= (sectionTop - 100)) {
                        current = section.getAttribute('id');
                    }
                });
                
                navLinks.forEach(link => {
                    link.classList.remove('active');
                    if (link.getAttribute('href') === `#${current}`) {
                        link.classList.add('active');
                    }
                });
            });
            
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    closeModal('checkoutModal');
                    closeModal('transferSuccessModal');
                    closeModal('reservationModal');
                }
            });
            
            document.addEventListener('click', function(e) {
                if (e.target.classList.contains('modal')) {
                    e.target.style.display = 'none';
                }
            });
            
            window.addEventListener('load', function() {
                if (window.location.hash) {
                    setTimeout(() => {
                        const target = document.querySelector(window.location.hash);
                        if (target) {
                            target.scrollIntoView({ behavior: 'smooth' });
                        }
                    }, 100);
                }
            });
        }

        // ==================== INITIALIZATION ====================
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('🚀 Starting MAN CAFE Customer System...');
            
            try {
                customerSystem = new CustomerSystem();
                await customerSystem.init();
                
                updateCartDisplay();
                updateCartCount();
                updateOrdersCount();
                
                if (window.customerOrders) {
                    showOrders('all');
                }
                
                setupNavigation();
                
                setTimeout(() => {
                    const pendingOrders = window.customerOrders?.filter(order => order.status === 'pending') || [];
                    if (pendingOrders.length > 0) {
                        showToast(`Anda memiliki ${pendingOrders.length} pesanan menunggu konfirmasi`, 'info');
                    }
                    
                    const waitingPaymentOrders = window.customerOrders?.filter(order => 
                        order.paymentStatus === 'waiting_payment'
                    ) || [];
                    
                    if (waitingPaymentOrders.length > 0) {
                        setTimeout(() => {
                            showToast(`Anda memiliki ${waitingPaymentOrders.length} pesanan menunggu pembayaran. Kirim bukti transfer via WhatsApp.`, 'info');
                        }, 2000);
                    }
                    
                    const confirmedDineInOrders = window.customerOrders?.filter(order => 
                        order.status === 'confirmed' && 
                        order.orderType === 'dine_in' &&
                        !order.reservation
                    ) || [];
                    
                    if (confirmedDineInOrders.length > 0) {
                        setTimeout(() => {
                            showToast(`Anda dapat reservasi meja untuk ${confirmedDineInOrders.length} pesanan`, 'info');
                        }, 4000);
                    }
                }, 2000);
                
                console.log('✅ MAN CAFE ready!');
                
            } catch (error) {
                console.error('❌ Error initializing system:', error);
                customerSystem = new CustomerSystem();
                customerSystem.cart = JSON.parse(localStorage.getItem('customer_cart') || '[]');
                window.currentMenus = JSON.parse(localStorage.getItem('cafe_menus') || '[]');
                window.customerOrders = JSON.parse(localStorage.getItem('customer_orders') || '[]');
                
                updateCartDisplay();
                updateCartCount();
                updateOrdersCount();
                renderMenus(window.currentMenus);
                showOrders('all');
                setupNavigation();
            }
        });
    </script>
</body>
</html>