<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MAN CAFE - Tempat Nongki Asik</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <!-- TAMBAHKAN SUPABASE JS -->
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <script>
        // CONFIGURASI SUPABASE - GANTI DENGAN MILIK ANDA
        const SUPABASE_URL = 'https://cuwtyfggfgykgjhrvdgi.supabase.co';
        const SUPABASE_ANON_KEY = 'sb_publishable_4e-uWWuKR2r7_jNaWHh03A_2UVQbPAx';
        
        // Inisialisasi Supabase client
        const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY, {
            auth: {
                autoRefreshToken: true,
                persistSession: true,
                detectSessionInUrl: false
            },
            db: {
                schema: 'public'
            }
        });
        
        // Export untuk digunakan di file lain
        window.supabaseClient = supabaseClient;
        console.log('‚úÖ Supabase client initialized');
    </script>
    <style>
        :root {
            --primary-color: #8B4513;
            --primary-light: #A0522D;
            --primary-dark: #5D2906;
            --secondary-color: #D2691E;
            --accent-color: #FFD700;
            --dark-color: #2C3E50;
            --light-color: #F8F9FA;
            --success-color: #28a745;
            --warning-color: #ffc107;
            --danger-color: #dc3545;
            --info-color: #17a2b8;
            --border-radius: 12px;
            --shadow: 0 6px 20px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            line-height: 1.6;
            color: #333;
            background: #fff;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Header Styles */
        .header {
            background: white;
            padding: 1rem 0;
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 1000;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            transition: var(--transition);
        }

        .header.scrolled {
            padding: 0.5rem 0;
        }

        .navbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 1rem;
            text-decoration: none;
            color: var(--primary-color);
            font-weight: 700;
            font-size: 1.5rem;
        }

        .logo img {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            object-fit: cover;
        }

        .nav-links {
            display: flex;
            list-style: none;
            gap: 2rem;
            align-items: center;
        }

        .nav-links a {
            text-decoration: none;
            color: var(--dark-color);
            font-weight: 500;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            transition: var(--transition);
        }

        .nav-links a:hover,
        .nav-links a.active {
            color: var(--primary-color);
            background: rgba(139, 69, 19, 0.1);
        }

        .hamburger {
            display: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--dark-color);
        }

        /* Hero Section */
        .hero {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 150px 0 100px;
            position: relative;
            overflow: hidden;
        }

        .hero-content {
            max-width: 600px;
            z-index: 1;
            position: relative;
        }

        .hero h1 {
            font-size: 3rem;
            margin-bottom: 1.5rem;
            line-height: 1.2;
        }

        .hero p {
            font-size: 1.2rem;
            margin-bottom: 2rem;
            opacity: 0.9;
        }

        .hero-buttons {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }

        /* Button Styles */
        .btn-primary, .btn-secondary {
            padding: 1rem 2rem;
            border-radius: 50px;
            font-weight: 600;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            transition: var(--transition);
            border: none;
            cursor: pointer;
            font-size: 1rem;
        }

        .btn-primary {
            background: var(--accent-color);
            color: var(--dark-color);
        }

        .btn-primary:hover {
            background: #FFC107;
            transform: translateY(-3px);
        }

        .btn-secondary {
            background: transparent;
            color: white;
            border: 2px solid white;
        }

        .btn-secondary:hover {
            background: white;
            color: var(--primary-color);
            transform: translateY(-3px);
        }

        /* Section Styles */
        .section-title {
            text-align: center;
            font-size: 2.5rem;
            color: var(--dark-color);
            margin-bottom: 3rem;
            position: relative;
        }

        .section-title::after {
            content: '';
            position: absolute;
            bottom: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 100px;
            height: 4px;
            background: var(--primary-color);
            border-radius: 2px;
        }

        /* Menu Section */
        .menu-section {
            padding: 80px 0;
        }

        .menu-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 2rem;
            margin-top: 3rem;
        }

        .menu-card {
            background: white;
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: var(--shadow);
            transition: var(--transition);
        }

        .menu-card:hover {
            transform: translateY(-10px);
        }

        .menu-card img {
            width: 100%;
            height: 200px;
            object-fit: cover;
        }

        .menu-info {
            padding: 1.5rem;
        }

        .menu-info h3 {
            font-size: 1.3rem;
            margin-bottom: 0.5rem;
            color: var(--dark-color);
        }

        .description {
            color: #666;
            font-size: 0.9rem;
            margin-bottom: 1rem;
            min-height: 40px;
        }

        .price {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--primary-color);
            margin-bottom: 1rem;
        }

        .original-price {
            text-decoration: line-through;
            color: #999;
            font-size: 1rem;
            margin-right: 0.5rem;
        }

        .discount-price {
            color: var(--danger-color);
        }

        .btn-order {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 0.8rem 1.5rem;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: var(--transition);
            width: 100%;
            justify-content: center;
        }

        .btn-order:hover {
            background: var(--primary-dark);
        }

        /* Promo Badge */
        .promo-badge {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: var(--danger-color);
            color: white;
            padding: 0.3rem 0.8rem;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        /* Footer */
        .footer {
            background: var(--dark-color);
            color: white;
            padding: 60px 0 20px;
        }

        .footer-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .footer-section h3 {
            font-size: 1.3rem;
            margin-bottom: 1.5rem;
            color: var(--accent-color);
        }

        .footer-links {
            list-style: none;
        }

        .footer-links li {
            margin-bottom: 0.8rem;
        }

        .footer-links a {
            color: rgba(255, 255, 255, 0.8);
            text-decoration: none;
            transition: var(--transition);
        }

        .footer-links a:hover {
            color: var(--accent-color);
            padding-left: 5px;
        }

        .social-icons {
            display: flex;
            gap: 1rem;
            margin-top: 1rem;
        }

        .social-icons a {
            width: 40px;
            height: 40px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            transition: var(--transition);
        }

        .social-icons a:hover {
            background: var(--primary-color);
            transform: translateY(-3px);
        }

        .footer-bottom {
            text-align: center;
            padding-top: 2rem;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.6);
            font-size: 0.9rem;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .nav-links {
                position: fixed;
                top: 70px;
                left: -100%;
                width: 100%;
                background: white;
                flex-direction: column;
                align-items: center;
                padding: 2rem 0;
                transition: var(--transition);
                box-shadow: 0 5px 10px rgba(0,0,0,0.1);
            }

            .nav-links.active {
                left: 0;
            }

            .hamburger {
                display: block;
            }

            .hero h1 {
                font-size: 2.2rem;
            }

            .hero-buttons {
                flex-direction: column;
            }

            .section-title {
                font-size: 2rem;
            }
        }

        /* Styles tambahan dari kode sebelumnya */
        .floating-coffee {
            position: absolute;
            right: 10%;
            top: 50%;
            animation: float 6s ease-in-out infinite;
        }
        
        .floating-coffee i {
            font-size: 4rem;
            color: rgba(255, 255, 255, 0.2);
        }
        
        .stats-section {
            background: white;
            padding: 80px 0;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 2rem;
            text-align: center;
        }
        
        .stat-item h3 {
            font-size: 3rem;
            color: var(--primary-color);
            margin-bottom: 0.5rem;
        }
        
        .testimonials {
            padding: 100px 0;
            background: #f9f9f9;
        }
        
        .testimonial-slider {
            max-width: 800px;
            margin: 0 auto;
        }
        
        .testimonial-card {
            background: white;
            padding: 2rem;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            text-align: center;
            margin: 1rem;
        }
        
        .testimonial-card img {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            margin-bottom: 1rem;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1001;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background-color: white;
            padding: 1.5rem;
            border-radius: 12px;
            width: 90%;
            max-width: 500px;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            animation: modalSlideIn 0.3s ease;
        }

        @keyframes modalSlideIn {
            from {
                transform: translateY(-20px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .close-modal {
            position: absolute;
            right: 1rem;
            top: 1rem;
            font-size: 1.2rem;
            cursor: pointer;
            color: #666;
            background: #f0f0f0;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
        }

        .close-modal:hover {
            background: #e0e0e0;
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.4rem;
            font-weight: 500;
            font-size: 0.9rem;
            color: #555;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 0.6rem;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 0.9rem;
            transition: border 0.3s;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(102, 77, 57, 0.1);
        }

        .modal h2 {
            font-size: 1.3rem;
            margin-bottom: 1.2rem;
            color: #333;
            padding-right: 30px;
        }

        .cart-section {
            padding: 80px 0;
            background: #f8f9fa;
        }

        .cart-items {
            background: white;
            border-radius: 10px;
            padding: 1.5rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .cart-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.8rem 0;
            border-bottom: 1px solid #eee;
        }

        .cart-item:last-child {
            border-bottom: none;
        }

        .cart-total {
            text-align: right;
            margin-top: 1.5rem;
            font-size: 1.3rem;
            font-weight: bold;
        }

        .orders-section {
            padding: 80px 0;
            background: #f8f9fa;
        }

        .orders-tabs {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            border-bottom: 2px solid #eee;
            padding-bottom: 1rem;
        }

        .tab-btn {
            padding: 0.8rem 1.5rem;
            background: none;
            border: none;
            border-radius: 6px;
            font-size: 0.95rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            color: #666;
        }

        .tab-btn.active {
            background: var(--primary-color);
            color: white;
        }

        .tab-btn:hover:not(.active) {
            background: #f0f0f0;
        }

        .order-card {
            background: white;
            border-radius: 10px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            transition: transform 0.3s;
        }

        .order-card:hover {
            transform: translateY(-2px);
        }

        .order-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid #eee;
        }

        .order-number {
            font-weight: 600;
            color: var(--primary-color);
            font-size: 1.1rem;
        }

        .order-status {
            padding: 0.3rem 0.8rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .status-pending {
            background: #fff3cd;
            color: #856404;
        }

        .status-confirmed {
            background: #d1ecf1;
            color: #0c5460;
        }

        .status-completed {
            background: #d4edda;
            color: #155724;
        }

        .status-cancelled {
            background: #f8d7da;
            color: #721c24;
        }

        .order-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .detail-item {
            margin-bottom: 0.5rem;
        }

        .detail-item strong {
            display: inline-block;
            min-width: 100px;
            color: #666;
        }

        .order-items {
            margin-top: 1rem;
        }

        .order-items h4 {
            margin-bottom: 0.5rem;
            color: #333;
        }

        .order-item {
            display: flex;
            justify-content: space-between;
            padding: 0.5rem 0;
            border-bottom: 1px dashed #eee;
        }

        .order-item:last-child {
            border-bottom: none;
        }

        .order-total {
            text-align: right;
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 2px solid #eee;
            font-weight: bold;
            font-size: 1.2rem;
        }

        .no-orders {
            text-align: center;
            padding: 3rem;
            color: #666;
        }

        .no-orders i {
            font-size: 3rem;
            margin-bottom: 1rem;
            color: #ddd;
        }

        .order-actions {
            display: flex;
            gap: 0.8rem;
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid #eee;
        }

        .action-btn {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 4px;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .action-cancel {
            background: #f8d7da;
            color: #721c24;
        }

        .action-cancel:hover {
            background: #f1b0b7;
        }

        .action-details {
            background: #d1ecf1;
            color: #0c5460;
        }

        .action-details:hover {
            background: #a6d9e3;
        }

        .action-reservation {
            background: #28a745;
            color: white;
        }

        .action-reservation:hover {
            background: #218838;
        }

        .action-whatsapp {
            background: #25D366;
            color: white;
        }

        .action-whatsapp:hover {
            background: #1da851;
        }

        .order-detail-modal .modal-content {
            max-width: 500px;
        }

        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            padding: 0.8rem 1rem;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            display: flex;
            align-items: center;
            gap: 0.8rem;
            z-index: 1002;
            transform: translateX(120%);
            transition: transform 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            max-width: 300px;
            font-size: 0.9rem;
        }

        .toast.show {
            transform: translateX(0);
        }

        .toast.success {
            border-left: 4px solid #28a745;
        }

        .toast.error {
            border-left: 4px solid #dc3545;
        }

        .toast.info {
            border-left: 4px solid #17a2b8;
        }

        .toast i {
            font-size: 1rem;
        }

        .toast.success i {
            color: #28a745;
        }

        .toast.error i {
            color: #dc3545;
        }

        .toast.info i {
            color: #17a2b8;
        }

        .modal-submit-btn {
            width: 100%;
            padding: 0.7rem;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            transition: background 0.3s;
            margin-top: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .modal-submit-btn:hover {
            background: var(--primary-dark);
        }

        .notification-badge {
            position: absolute;
            top: -8px;
            right: -8px;
            background: #dc3545;
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            font-size: 0.7rem;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        .quantity-control {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .quantity-btn {
            width: 28px;
            height: 28px;
            border: none;
            background: #f0f0f0;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9rem;
            transition: background 0.3s;
        }

        .quantity-btn:hover {
            background: #e0e0e0;
        }

        .order-summary {
            background: #f9f9f9;
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
            font-size: 0.9rem;
        }

        .bank-info {
            background: #f8f9fa;
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
            border-left: 4px solid #28a745;
        }

        .bank-info h4 {
            margin-top: 0;
            color: #28a745;
        }

        .account-number {
            font-family: monospace;
            font-size: 1.2rem;
            letter-spacing: 2px;
            background: white;
            padding: 0.8rem;
            border-radius: 6px;
            text-align: center;
            margin: 0.5rem 0;
            border: 2px dashed #ddd;
        }

        .admin-login-btn {
            position: fixed;
            top: 20px;
            left: 20px;
            background: #dc3545;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            text-decoration: none;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            z-index: 1000;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }

        .whatsapp-float {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: #25D366;
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            box-shadow: 0 4px 15px rgba(37, 211, 102, 0.3);
            z-index: 1000;
            transition: var(--transition);
            text-decoration: none;
        }

        .whatsapp-float:hover {
            background: #1da851;
            transform: scale(1.1);
        }

        .promo-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            margin-top: 3rem;
        }

        .promo-card {
            background: white;
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: var(--shadow);
            position: relative;
        }

        .promo-card img {
            width: 100%;
            height: 200px;
            object-fit: cover;
        }

        .promo-info {
            padding: 1.5rem;
        }

        .btn-cart, .btn-orders {
            position: relative;
            background: var(--primary-color);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .cart-count, .orders-count {
            background: var(--accent-color);
            color: var(--dark-color);
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            font-weight: bold;
        }
        
        /* Debug Panel */
        .debug-panel {
            position: fixed;
            bottom: 100px;
            right: 20px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.2);
            padding: 15px;
            z-index: 9999;
            max-width: 300px;
            display: none;
        }
        
        .debug-toggle {
            position: fixed;
            bottom: 100px;
            right: 20px;
            background: #2196F3;
            color: white;
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            font-size: 20px;
            cursor: pointer;
            z-index: 10000;
            box-shadow: 0 4px 10px rgba(33, 150, 243, 0.3);
        }
        
        .debug-btn {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            font-size: 12px;
            display: inline-flex;
            align-items: center;
            gap: 5px;
        }
        
        .debug-btn.red {
            background: #f44336;
        }
        
        .debug-btn.blue {
            background: #2196F3;
        }
    </style>
</head>
<body>
    <!-- Admin Login Button -->
    <a href="dashboard_admin.html" class="admin-login-btn">
        <i class="fas fa-user-cog"></i> Admin Login
    </a>

    <!-- Header -->
    <header class="header" id="header">
        <div class="container">
            <nav class="navbar">
                <a href="#" class="logo">
                    <div style="width: 50px; height: 50px; background: var(--primary-color); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white;">
                        <i class="fas fa-coffee"></i>
                    </div>
                    <span>MAN CAFE</span>
                </a>
                <ul class="nav-links" id="navLinks">
                    <li><a href="#home" class="active">Beranda</a></li>
                    <li><a href="#menu">Menu</a></li>
                    <li><a href="#about">Tentang</a></li>
                    <li><a href="#testimonials">Testimoni</a></li>
                    <li><a href="#cart" class="btn-cart">
                        <i class="fas fa-shopping-cart"></i> 
                        <span class="cart-count">0</span>
                    </a></li>
                    <li>
                        <a href="#my-orders" class="btn-orders">
                            <i class="fas fa-clipboard-list"></i>
                            <span class="orders-count">0</span>
                        </a>
                    </li>
                </ul>
                <div class="hamburger" id="hamburger">
                    <i class="fas fa-bars"></i>
                </div>
            </nav>
        </div>
    </header>

    <!-- Hero Section -->
    <section class="hero" id="home">
        <div class="container">
            <div class="floating-coffee">
                <i class="fas fa-coffee"></i>
            </div>
            <div class="hero-content">
                <h1>Rasakan Kenikmatan Menu Premium</h1>
                <p>Temukan pengalaman nongki terbaik dengan suasana cozy, makanan lezat, dan pelayanan ramah di MAN CAFE</p>
                <div class="hero-buttons">
                    <a href="#menu" class="btn-primary">
                        <i class="fas fa-shopping-cart"></i> Pesan Sekarang
                    </a>
                    <a href="#menu" class="btn-secondary">
                        <i class="fas fa-utensils"></i> Lihat Menu
                    </a>
                </div>
            </div>
        </div>
    </section>

    <!-- Stats Section -->
    <section class="stats-section">
        <div class="container">
            <div class="stats-grid">
                <div class="stat-item">
                    <h3>500+</h3>
                    <p>Pelanggan Setia</p>
                </div>
                <div class="stat-item">
                    <h3>50+</h3>
                    <p>Menu Variatif</p>
                </div>
                <div class="stat-item">
                    <h3>24</h3>
                    <p>Meja Nyaman</p>
                </div>
                <div class="stat-item">
                    <h3>5‚òÖ</h3>
                    <p>Rating Terbaik</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Featured Menu Section -->
    <section class="menu-section featured-menu" id="menu">
        <div class="container">
            <h2 class="section-title">Menu Unggulan Kami</h2>
            <p class="text-center" style="max-width: 600px; margin: 0 auto 3rem;">Nikmati berbagai pilihan menu terbaik kami yang dibuat dengan bahan-bahan berkualitas tinggi</p>
            <div class="menu-grid" id="featured-menu">
                <!-- Menu items will be loaded here -->
            </div>
            <div class="text-center" style="margin-top: 3rem;">
                <a href="#all-menu" class="btn-primary">Lihat Semua Menu</a>
            </div>
        </div>
    </section>

    <!-- All Menu Section -->
    <section class="menu-section all-menu" id="all-menu">
        <div class="container">
            <h2 class="section-title">Semua Menu</h2>
            <p class="text-center" style="max-width: 600px; margin: 0 auto 3rem;">Pilih dari berbagai menu makanan dan minuman yang tersedia</p>
            <div class="menu-grid" id="all-menu-items">
                <!-- All menu items will be loaded here -->
            </div>
        </div>
    </section>

    <!-- Cart Section -->
    <section class="cart-section" id="cart">
        <div class="container">
            <h2 class="section-title">Keranjang Pesanan Anda</h2>
            <div class="cart-items" id="cart-items">
                <p class="text-center" id="empty-cart-message">Keranjang Anda masih kosong</p>
                <div id="cart-items-container"></div>
                <div class="cart-total" id="cart-total" style="display: none;">
                    Total: Rp <span id="total-amount">0</span>
                </div>
                <div class="text-center" id="checkout-buttons" style="display: none; margin-top: 1.5rem; gap: 1rem; flex-wrap: wrap;">
                    <button class="btn-primary" onclick="openCheckoutModal()" style="padding: 0.7rem 1.5rem;">
                        <i class="fas fa-check"></i> Checkout
                    </button>
                    <button class="btn-secondary" onclick="clearCart()" style="padding: 0.7rem 1.5rem;">
                        <i class="fas fa-trash"></i> Kosongkan
                    </button>
                </div>
            </div>
        </div>
    </section>

    <!-- Orders Section -->
    <section class="orders-section" id="my-orders">
        <div class="container">
            <h2 class="section-title">Pesanan Saya</h2>
            <div class="orders-tabs">
                <button class="tab-btn active" onclick="showOrders('all')">
                    <i class="fas fa-list"></i> Semua
                </button>
                <button class="tab-btn" onclick="showOrders('pending')">
                    <i class="fas fa-clock"></i> Menunggu
                </button>
                <button class="tab-btn" onclick="showOrders('confirmed')">
                    <i class="fas fa-check-circle"></i> Dikonfirmasi
                </button>
                <button class="tab-btn" onclick="showOrders('reservations')">
                    <i class="fas fa-calendar-alt"></i> Reservasi
                </button>
            </div>
            
            <div id="orders-container">
                <!-- Orders will be loaded here -->
            </div>
        </div>
    </section>

    <!-- Promo Section -->
    <section class="promo-section">
        <div class="container">
            <h2 class="section-title">Promo Spesial Hari Ini</h2>
            <p class="text-center" style="max-width: 600px; margin: 0 auto 3rem;">Jangan lewatkan promo menarik yang kami sediakan khusus untuk Anda</p>
            <div class="promo-grid" id="promo-menu">
                <!-- Promo items will be loaded here -->
            </div>
        </div>
    </section>

    <!-- Testimonials Section -->
    <section class="testimonials" id="testimonials">
        <div class="container">
            <h2 class="section-title">Apa Kata Pelanggan</h2>
            <div class="testimonial-slider">
                <div class="testimonial-card">
                    <img src="https://randomuser.me/api/portraits/women/32.jpg" alt="Customer">
                    <h3>Sarah Johnson</h3>
                    <p>"Menu-menu di sini luar biasa! Suasana yang cozy dan musik yang pas membuat saya betah berlama-lama. juga ada studio foto yang bisa kita nikmati"</p>
                    <div class="rating">
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>MAN CAFE</h3>
                    <p>Tempat nongki asik dengan suasana cozy dan menu spesial. Nikmati menu berkualitas dengan pelayanan terbaik.</p>
                    <div class="social-icons">
                        <a href="#"><i class="fab fa-instagram"></i></a>
                        <a href="#"><i class="fab fa-facebook"></i></a>
                        <a href="#"><i class="fab fa-tiktok"></i></a>
                    </div>
                </div>
                <div class="footer-section">
                    <h3>Jam Operasional</h3>
                    <ul class="footer-links">
                        <li><strong>Senin - Jumat:</strong> 11:00 - 22:00</li>
                        <li><strong>Sabtu:</strong> 11:00 - 00:00</li>
                        <li><strong>Minggu:</strong> 11:00 - 23:00</li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h3>Kontak</h3>
                    <ul class="footer-links">
                        <li><i class="fas fa-map-marker-alt"></i> Jl. Bahagia No. 123, Kota Senang</li>
                        <li><i class="fas fa-phone"></i> (021) 1234-5678</li>
                        <li><i class="fas fa-envelope"></i> info@mancafe.com</li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h3>Menu Cepat</h3>
                    <ul class="footer-links">
                        <li><a href="#home">Beranda</a></li>
                        <li><a href="#menu">Menu</a></li>
                        <li><a href="#my-orders">Pesanan Saya</a></li>
                        <li><a href="#cart">Keranjang</a></li>
                    </ul>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 MAN CAFE. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <!-- WhatsApp Float Button -->
    <a href="https://wa.me/6283832184173" class="whatsapp-float" target="_blank">
        <i class="fab fa-whatsapp"></i>
    </a>
    
    <!-- Debug Button -->
    <button class="debug-toggle" onclick="toggleDebugPanel()">
        <i class="fas fa-bug"></i>
    </button>
    
    <!-- Debug Panel -->
    <div class="debug-panel" id="debugPanel">
        <h4 style="margin: 0 0 10px 0; color: #333;">Debug Tools</h4>
        <button class="debug-btn" onclick="testSupabaseConnection()">
            <i class="fas fa-plug"></i> Test Connection
        </button>
        <button class="debug-btn blue" onclick="createTestOrder()">
            <i class="fas fa-plus"></i> Test Order
        </button>
        <button class="debug-btn" onclick="checkLocalStorage()">
            <i class="fas fa-database"></i> Check Data
        </button>
        <button class="debug-btn red" onclick="clearAllData()">
            <i class="fas fa-trash"></i> Clear Data
        </button>
        <button class="debug-btn blue" onclick="checkTables()">
            <i class="fas fa-table"></i> Check Tables
        </button>
        <hr style="margin: 10px 0;">
        <div id="debugOutput" style="font-size: 11px; max-height: 200px; overflow-y: auto; background: #f5f5f5; padding: 8px; border-radius: 4px;"></div>
    </div>

    <!-- Modals -->
    <div id="reservationModal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal('reservationModal')">&times;</span>
            <h2>Reservasi Meja</h2>
            <p style="margin-bottom: 1rem; color: #666; font-size: 0.9rem;">
                Reservasi hanya dapat dilakukan setelah Anda memiliki pesanan yang dikonfirmasi.
            </p>
            <form id="reservationForm">
                <input type="hidden" id="reservationOrderId">
                <div class="form-group">
                    <label for="name">Nama Lengkap *</label>
                    <input type="text" id="name" required placeholder="Masukkan nama Anda">
                </div>
                <div class="form-group">
                    <label for="phone">Nomor Telepon *</label>
                    <input type="tel" id="phone" required placeholder="0812-3456-7890">
                </div>
                <div class="form-group">
                    <label for="date">Tanggal *</label>
                    <input type="date" id="date" required min="<?php echo date('Y-m-d'); ?>">
                </div>
                <div class="form-group">
                    <label for="time">Waktu *</label>
                    <input type="time" id="time" required min="11:00" max="22:00">
                </div>
                <div class="form-group">
                    <label for="guests">Jumlah Orang *</label>
                    <select id="guests" required>
                        <option value="">Pilih...</option>
                        <option value="1">1 Orang</option>
                        <option value="2">2 Orang</option>
                        <option value="3">3 Orang</option>
                        <option value="4">4 Orang</option>
                        <option value="5">5+ Orang</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="notes">Catatan Tambahan (opsional)</label>
                    <textarea id="notes" rows="3" placeholder="Misal: meja dekat jendela, meja romantis, dll."></textarea>
                </div>
                <div class="form-group">
                    <label>Pesanan Anda:</label>
                    <div id="reservationOrderInfo" style="background: #f8f9fa; padding: 1rem; border-radius: 6px; margin-top: 0.5rem;">
                        <p id="reservationOrderText" style="margin: 0; color: #666;">Memuat informasi pesanan...</p>
                    </div>
                </div>
                <button type="submit" class="modal-submit-btn">
                    <i class="fas fa-check"></i> Reservasi Sekarang
                </button>
            </form>
        </div>
    </div>

    <div id="checkoutModal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal('checkoutModal')">&times;</span>
            <h2>Checkout Pesanan</h2>
            <div id="order-summary-compact" class="order-summary">
                <!-- Order summary will be loaded here -->
            </div>
            <form id="checkoutForm">
                <div class="form-group">
                    <label for="customerName">Nama Pemesan *</label>
                    <input type="text" id="customerName" required placeholder="Masukkan nama lengkap">
                </div>
                <div class="form-group">
                    <label for="customerPhone">Nomor Telepon *</label>
                    <input type="tel" id="customerPhone" required placeholder="0812-3456-7890">
                </div>
                <div class="form-group">
                    <label for="orderType">Tipe Pesanan *</label>
                    <select id="orderType" required onchange="toggleAddressField()">
                        <option value="">Pilih...</option>
                        <option value="dine_in">Makan di Tempat</option>
                        <option value="takeaway">Bawa Pulang</option>
                    </select>
                </div>
                <div class="form-group" id="addressField" style="display: none;">
                    <label for="customerAddress">Alamat Pengiriman</label>
                    <textarea id="customerAddress" rows="2" placeholder="Masukkan alamat lengkap untuk pengiriman"></textarea>
                </div>
                <div class="form-group">
                    <label for="paymentMethod">Metode Pembayaran</label>
                    <div style="background: #e9ecef; padding: 0.8rem; border-radius: 6px; margin-top: 0.4rem; font-weight: bold; color: #28a745;">
                        <i class="fas fa-university"></i> Transfer Bank (Satu-satunya Metode)
                    </div>
                </div>
                <div id="bankPaymentInfo">
                    <div class="bank-info">
                        <h4><i class="fas fa-university"></i> Transfer ke Rekening MAN CAFE</h4>
                        <p><strong>Bank BCA:</strong></p>
                        <div class="account-number" id="accountNumber">123 456 7890</div>
                        <p>a.n. <strong>MAN CAFE</strong></p>
                        <p><small>Lakukan transfer sesuai total pesanan Anda. <br>Upload bukti transfer di halaman pesanan setelah checkout.</small></p>
                    </div>
                </div>
                <div class="form-group">
                    <div style="background: #f0f9ff; padding: 0.8rem; border-radius: 6px; margin: 0.5rem 0; border-left: 4px solid #3b82f6;">
                        <p style="margin: 0; font-size: 0.85rem; color: #1e40af;">
                            <i class="fas fa-info-circle"></i> Setelah pesanan dikonfirmasi oleh admin, Anda dapat melakukan reservasi meja di halaman "Pesanan Saya".
                        </p>
                    </div>
                </div>
                <button type="submit" class="modal-submit-btn" id="submitOrderBtn">
                    <i class="fas fa-university"></i> Konfirmasi Pesanan & Lihat Instruksi Transfer
                </button>
            </form>
        </div>
    </div>

    <div id="orderDetailModal" class="modal order-detail-modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal('orderDetailModal')">&times;</span>
            <div id="order-detail-content">
                <!-- Order details will be loaded here -->
            </div>
        </div>
    </div>

    <script>
        // ============================
        // DEBUG FUNCTIONS
        // ============================
        function toggleDebugPanel() {
            const panel = document.getElementById('debugPanel');
            panel.style.display = panel.style.display === 'block' ? 'none' : 'block';
        }
        
        function debugLog(message) {
            const output = document.getElementById('debugOutput');
            const timestamp = new Date().toLocaleTimeString();
            output.innerHTML = `<div><strong>[${timestamp}]</strong> ${message}</div>` + output.innerHTML;
            console.log(message);
        }
        
        async function testSupabaseConnection() {
            debugLog('üîç Testing Supabase connection...');
            
            try {
                const { data, error } = await supabaseClient
                    .from('menu_items')
                    .select('id')
                    .limit(1);
                
                if (error) {
                    debugLog(`‚ùå Connection failed: ${error.message}`);
                    showToast('Koneksi gagal: ' + error.message, 'error');
                } else {
                    debugLog('‚úÖ Connection successful!');
                    showToast('‚úÖ Koneksi Supabase berhasil!', 'success');
                    
                    // Check tables
                    checkTables();
                }
            } catch (error) {
                debugLog(`‚ùå Error: ${error.message}`);
                showToast('Error: ' + error.message, 'error');
            }
        }
        
        async function checkTables() {
            debugLog('üìä Checking tables...');
            
            const tables = ['menu_items', 'orders', 'order_items', 'reservations', 'admin_notifications'];
            
            for (const table of tables) {
                try {
                    const { data, error } = await supabaseClient
                        .from(table)
                        .select('count', { count: 'exact', head: true });
                    
                    if (error) {
                        debugLog(`‚ùå Table ${table}: ${error.message}`);
                    } else {
                        debugLog(`‚úÖ Table ${table}: ${data} rows`);
                    }
                } catch (error) {
                    debugLog(`‚ùå Error checking ${table}: ${error.message}`);
                }
            }
        }
        
        async function createTestOrder() {
            debugLog('üß™ Creating test order...');
            
            try {
                const testOrder = {
                    order_number: 'TEST-' + Date.now(),
                    customer_name: 'Test Customer',
                    customer_phone: '081111111111',
                    order_type: 'dine_in',
                    total_amount: 50000,
                    status: 'pending',
                    payment_method: 'transfer',
                    payment_status: 'pending'
                };
                
                const { data, error } = await supabaseClient
                    .from('orders')
                    .insert([testOrder])
                    .select();
                
                if (error) {
                    debugLog(`‚ùå Failed to create test order: ${error.message}`);
                    showToast('Gagal buat test order: ' + error.message, 'error');
                } else {
                    debugLog(`‚úÖ Test order created: ${JSON.stringify(data)}`);
                    showToast('‚úÖ Test order berhasil dibuat!', 'success');
                    
                    // Refresh orders
                    if (typeof showOrders === 'function') {
                        showOrders('all');
                    }
                }
            } catch (error) {
                debugLog(`‚ùå Error: ${error.message}`);
                showToast('Error: ' + error.message, 'error');
            }
        }
        
        function checkLocalStorage() {
            const orders = JSON.parse(localStorage.getItem('customer_orders') || '[]');
            const cart = JSON.parse(localStorage.getItem('customer_cart') || '[]');
            const menus = JSON.parse(localStorage.getItem('cafe_menus') || '[]');
            
            debugLog(`üì± LocalStorage Data:`);
            debugLog(`- Orders: ${orders.length} items`);
            debugLog(`- Cart: ${cart.length} items`);
            debugLog(`- Menus: ${menus.length} items`);
            
            if (orders.length > 0) {
                debugLog(`Sample order: ${orders[0].orderNumber} - ${orders[0].customer?.name}`);
            }
        }
        
        function clearAllData() {
            if (confirm('Hapus semua data lokal?')) {
                localStorage.clear();
                debugLog('üßπ All local data cleared');
                showToast('Data lokal dihapus', 'info');
                location.reload();
            }
        }

        // ============================
        // VARIABEL GLOBAL
        // ============================
        let customerSystem = null;
        let cart = [];
        let currentMenus = [];

        // ============================
        // SISTEM PELANGGAN DENGAN SUPABASE
        // ============================
        
        class CustomerSystem {
            constructor() {
                this.orders = JSON.parse(localStorage.getItem('customer_orders')) || [];
                this.reservations = JSON.parse(localStorage.getItem('customer_reservations')) || [];
                this.cart = JSON.parse(localStorage.getItem('customer_cart')) || [];
                this.isOnline = false;
                this.syncQueue = JSON.parse(localStorage.getItem('sync_queue')) || [];
                this.customerPhone = localStorage.getItem('customer_phone') || '';
            }

            async init() {
                console.log('üöÄ Initializing Customer System...');
                debugLog('Initializing system...');
                
                // Cek koneksi ke Supabase
                this.isOnline = await this.checkSupabaseConnection();
                
                if (!this.isOnline) {
                    console.warn('‚ö†Ô∏è Customer system running in offline mode');
                    debugLog('Running in offline mode');
                } else {
                    console.log('‚úÖ Connected to Supabase');
                    debugLog('Connected to Supabase');
                    
                    // Load menus dari Supabase
                    await this.loadMenusFromSupabase();
                    
                    // Load orders dan reservations dari Supabase
                    await this.syncDataFromSupabase();
                }
                
                // Proses queue sinkronisasi
                await this.processSyncQueue();
                
                console.log('‚úÖ Customer System initialized');
                debugLog('System initialized');
                
                return this;
            }

            async checkSupabaseConnection() {
                try {
                    const { data, error } = await supabaseClient
                        .from('menu_items')
                        .select('id')
                        .limit(1);
                    
                    if (error) {
                        debugLog(`Connection error: ${error.message}`);
                        return false;
                    }
                    return true;
                } catch (error) {
                    debugLog(`Connection error: ${error.message}`);
                    return false;
                }
            }

            save() {
                localStorage.setItem('customer_orders', JSON.stringify(this.orders));
                localStorage.setItem('customer_reservations', JSON.stringify(this.reservations));
                localStorage.setItem('customer_cart', JSON.stringify(this.cart));
                localStorage.setItem('sync_queue', JSON.stringify(this.syncQueue));
                if (this.customerPhone) {
                    localStorage.setItem('customer_phone', this.customerPhone);
                }
            }

            // ==================== ORDER FUNCTIONS ====================
           async addOrder(orderData) {
    debugLog(`Adding new order...`);
    debugLog(`Order data: ${JSON.stringify(orderData)}`);
    
    try {
        // Generate unique order ID
        const orderId = Date.now();
        const timestamp = new Date().getTime();
        const randomNum = Math.floor(Math.random() * 1000);
        const orderNumber = `ORD-${timestamp.toString().slice(-6)}-${randomNum.toString().padStart(3, '0')}`;
        
        // Simpan nomor telepon pelanggan
        if (orderData.customer && orderData.customer.phone) {
            this.customerPhone = orderData.customer.phone;
            localStorage.setItem('customer_phone', this.customerPhone);
        }
        
        // Pastikan items ada dan valid
        const orderItems = Array.isArray(orderData.items) ? orderData.items : [];
        if (orderItems.length === 0) {
            debugLog('Warning: No items in order data');
        }
        
        // Prepare order object
        const order = {
            id: orderId,
            orderNumber: orderNumber,
            customer: {
                name: orderData.customer?.name || 'Pelanggan',
                phone: orderData.customer?.phone || '',
                address: orderData.customer?.address || '-'
            },
            orderType: orderData.orderType || 'dine_in',
            items: orderItems.map(item => ({
                id: item.id || Date.now(),
                name: item.name || 'Item',
                price: item.price || 0,
                quantity: item.quantity || 1
            })),
            total: orderData.total || 0,
            status: 'pending',
            paymentMethod: 'transfer',
            paymentStatus: 'pending',
            createdAt: new Date().toISOString(),
            notes: orderData.notes || '',
            hasReservation: false,
            syncStatus: 'pending'
        };
        
        debugLog(`Order created: ${order.orderNumber}, Total: Rp ${order.total.toLocaleString()}`);
        debugLog(`Order items: ${JSON.stringify(order.items)}`);
        
        // Save to local
        this.orders.unshift(order);
        this.save();
        
        // Save to Supabase if online
        if (this.isOnline) {
            try {
                await this.saveOrderToSupabase(order);
                order.syncStatus = 'synced';
                this.save();
                debugLog(`‚úÖ Order synced to Supabase: ${order.orderNumber}`);
            } catch (error) {
                debugLog(`‚ùå Failed to sync to Supabase: ${error.message}`);
                this.addToSyncQueue('order', order);
            }
        } else {
            this.addToSyncQueue('order', order);
            debugLog(`üì± Order saved locally (offline): ${order.orderNumber}`);
        }
        
        // Send to admin system
        this.sendOrderToAdmin(order);
        
        // Update notifications
        updateOrdersCount();
        
        return order;
        
    } catch (error) {
        debugLog(`‚ùå Error adding order: ${error.message}`);
        throw error;
    }
}

            async saveOrderToSupabase(order) {
                try {
                    debugLog(`Saving order to Supabase: ${order.orderNumber}`);
                    
                    if (!window.supabaseClient) {
                        throw new Error('Supabase client tidak tersedia');
                    }

                    // 1. Save order to Supabase
                    const { data: savedOrder, error: orderError } = await supabaseClient
                        .from('orders')
                        .insert([{
                            local_id: order.id,
                            order_number: order.orderNumber,
                            customer_name: order.customer.name,
                            customer_phone: order.customer.phone,
                            customer_address: order.customer.address,
                            order_type: order.orderType,
                            total_amount: order.total,
                            status: 'pending',
                            payment_method: 'transfer',
                            payment_status: 'pending',
                            notes: order.notes || '',
                            admin_seen: false,
                            has_reservation: false
                        }])
                        .select()
                        .single();
                    
                    if (orderError) {
                        debugLog(`‚ùå Order insert error: ${orderError.message}`);
                        throw orderError;
                    }

                    debugLog(`‚úÖ Order saved to Supabase with ID: ${savedOrder.id}`);
                    
                    // 2. Save order items
                    if (order.items && order.items.length > 0) {
                        const orderItems = order.items.map(item => ({
                            order_id: savedOrder.id,
                            menu_item_name: item.name,
                            quantity: item.quantity,
                            price: item.price,
                            total_price: item.price * item.quantity
                        }));

                        const { error: itemsError } = await supabaseClient
                            .from('order_items')
                            .insert(orderItems);

                        if (itemsError) {
                            debugLog(`‚ùå Items insert error: ${itemsError.message}`);
                            throw itemsError;
                        }

                        debugLog(`‚úÖ Order items saved`);
                    }
                    
                    // 3. Create notification for admin
                    await supabaseClient
                        .from('admin_notifications')
                        .insert([{
                            type: 'new_order',
                            title: 'Pesanan Baru!',
                            message: `Pesanan baru #${order.orderNumber} dari ${order.customer.name}`,
                            data: {
                                order_id: savedOrder.id,
                                order_number: order.orderNumber,
                                total: order.total,
                                customer_name: order.customer.name
                            },
                            is_read: false
                        }]);

                    debugLog(`‚úÖ Notification created`);
                    
                    // 4. Update local order with supabase_id
                    order.supabase_id = savedOrder.id;
                    
                    return { success: true, supabase_id: savedOrder.id };

                } catch (error) {
                    debugLog(`‚ùå Error saving order to Supabase: ${error.message}`);
                    throw error;
                }
            }

            // ==================== SYNC FUNCTIONS ====================
            async syncDataFromSupabase() {
                try {
                    if (!window.supabaseClient || !this.customerPhone) return;
                    
                    debugLog(`Syncing data for phone: ${this.customerPhone}`);
                    
                    // Sync orders
                    await this.syncOrdersFromSupabase();
                    
                    // Sync reservations
                    await this.syncReservationsFromSupabase();
                    
                } catch (error) {
                    debugLog(`Error syncing data: ${error.message}`);
                }
            }

            async syncOrdersFromSupabase() {
                try {
                    const { data: orders, error } = await supabaseClient
                        .from('orders')
                        .select(`
                            *,
                            order_items(*)
                        `)
                        .eq('customer_phone', this.customerPhone)
                        .order('created_at', { ascending: false });
                    
                    if (error) {
                        debugLog(`Error syncing orders: ${error.message}`);
                        return;
                    }
                    
                    if (orders && orders.length > 0) {
                        const formattedOrders = orders.map(order => ({
                            id: order.local_id || order.id,
                            supabase_id: order.id,
                            orderNumber: order.order_number,
                            customer: {
                                name: order.customer_name,
                                phone: order.customer_phone,
                                address: order.customer_address
                            },
                            orderType: order.order_type,
                            items: order.order_items?.map(item => ({
                                name: item.menu_item_name,
                                price: item.price,
                                quantity: item.quantity
                            })) || [],
                            total: order.total_amount,
                            status: order.status,
                            paymentMethod: order.payment_method,
                            paymentStatus: order.payment_status,
                            createdAt: order.created_at,
                            notes: order.notes,
                            adminSeen: order.admin_seen,
                            hasReservation: order.has_reservation || false,
                            syncStatus: 'synced'
                        }));
                        
                        // Merge with local orders (keep local changes)
                        formattedOrders.forEach(supabaseOrder => {
                            const localIndex = this.orders.findIndex(o => 
                                o.id === supabaseOrder.id || o.orderNumber === supabaseOrder.orderNumber
                            );
                            if (localIndex !== -1) {
                                // Update local order with Supabase data
                                this.orders[localIndex] = {
                                    ...this.orders[localIndex],
                                    ...supabaseOrder,
                                    id: this.orders[localIndex].id // Preserve local ID
                                };
                            } else {
                                this.orders.push(supabaseOrder);
                            }
                        });
                        
                        this.save();
                        
                        debugLog(`‚úÖ Synced ${orders.length} orders from Supabase`);
                    }
                } catch (error) {
                    debugLog(`Error syncing orders from Supabase: ${error.message}`);
                }
            }

            async syncReservationsFromSupabase() {
                try {
                    const { data: reservations, error } = await supabaseClient
                        .from('reservations')
                        .select('*')
                        .eq('customer_phone', this.customerPhone)
                        .order('created_at', { ascending: false });
                    
                    if (error) {
                        debugLog(`Error syncing reservations: ${error.message}`);
                        return;
                    }
                    
                    if (reservations) {
                        const formattedReservations = reservations.map(res => ({
                            id: res.id,
                            orderId: res.order_id,
                            name: res.customer_name,
                            phone: res.customer_phone,
                            date: res.reservation_date,
                            time: res.reservation_time,
                            guests: res.number_of_guests,
                            notes: res.notes,
                            confirmed: res.confirmed || false,
                            createdAt: res.created_at
                        }));
                        
                        this.reservations = formattedReservations;
                        this.save();
                        
                        debugLog(`‚úÖ Synced ${formattedReservations.length} reservations from Supabase`);
                    }
                } catch (error) {
                    debugLog(`Error syncing reservations from Supabase: ${error.message}`);
                }
            }

            addToSyncQueue(type, data) {
                this.syncQueue.push({
                    id: Date.now(),
                    type: type,
                    data: data,
                    attempts: 0,
                    lastAttempt: null,
                    status: 'pending'
                });
                this.save();
                debugLog(`Added to sync queue: ${type}`);
            }

            async processSyncQueue() {
                if (this.syncQueue.length === 0 || !this.isOnline) return;
                
                debugLog(`Processing sync queue (${this.syncQueue.length} items)...`);
                
                for (let i = this.syncQueue.length - 1; i >= 0; i--) {
                    const item = this.syncQueue[i];
                    
                    if (item.attempts >= 3) {
                        debugLog(`Skipping ${item.type} after 3 failed attempts`);
                        this.syncQueue.splice(i, 1);
                        continue;
                    }
                    
                    try {
                        if (item.type === 'order') {
                            await this.saveOrderToSupabase(item.data);
                            item.status = 'synced';
                            this.syncQueue.splice(i, 1);
                            debugLog(`‚úÖ Synced ${item.type} successfully`);
                        }
                        
                    } catch (error) {
                        debugLog(`‚ùå Failed to sync ${item.type}: ${error.message}`);
                        item.attempts++;
                        item.lastAttempt = new Date().toISOString();
                    }
                }
                
                this.save();
            }

            // ==================== MENU FUNCTIONS ====================
            async loadMenusFromSupabase() {
                try {
                    console.log('üì• Loading menus from Supabase...');
                    
                    const { data: menus, error } = await supabaseClient
                        .from('menu_items')
                        .select('*')
                        .eq('is_active', true)
                        .order('category')
                        .order('name');
                    
                    if (error) {
                        console.error('‚ùå Error loading menus:', error);
                        return this.loadMenusFromLocalStorage();
                    }

                    if (menus && menus.length > 0) {
                        console.log(`‚úÖ Loaded ${menus.length} active menus from Supabase`);
                        
                        const formattedMenus = menus.map(menu => ({
                            id: menu.id,
                            local_id: menu.local_id || menu.id,
                            name: menu.name,
                            description: menu.description || '',
                            price: menu.price,
                            image: menu.image_url || menu.image || '',
                            image_url: menu.image_url || menu.image || '',
                            category: menu.category,
                            isPromo: menu.is_promo || false,
                            originalPrice: menu.original_price || null,
                            isActive: menu.is_active !== false
                        }));
                        
                        // Save to localStorage
                        localStorage.setItem('cafe_menus', JSON.stringify(formattedMenus));
                        
                        // Update current menus
                        currentMenus = formattedMenus;
                        
                        // Render menus
                        renderMenus(formattedMenus);
                        
                        return formattedMenus;
                    } else {
                        console.log('‚ÑπÔ∏è No active menus in Supabase, loading from localStorage');
                        return this.loadMenusFromLocalStorage();
                    }

                } catch (error) {
                    console.error('‚ùå Error in loadMenusFromSupabase:', error);
                    return this.loadMenusFromLocalStorage();
                }
            }

            loadMenusFromLocalStorage() {
                const savedMenus = JSON.parse(localStorage.getItem('cafe_menus') || '[]');
                
                if (savedMenus && savedMenus.length > 0) {
                    console.log(`üì± Loaded ${savedMenus.length} menus from localStorage`);
                    currentMenus = savedMenus;
                    renderMenus(savedMenus);
                    return savedMenus;
                } else {
                    console.log('‚ö†Ô∏è No menus found, using default menus');
                    const defaultMenus = getDefaultMenuData();
                    currentMenus = defaultMenus;
                    localStorage.setItem('cafe_menus', JSON.stringify(defaultMenus));
                    renderMenus(defaultMenus);
                    return defaultMenus;
                }
            }

            // ==================== RESERVATION FUNCTIONS ====================
            async addReservation(reservationData) {
                debugLog(`Adding new reservation...`);
                
                try {
                    const reservation = {
                        id: Date.now(),
                        ...reservationData,
                        createdAt: new Date().toISOString(),
                        confirmed: false
                    };
                    
                    // Simpan ke lokal
                    this.reservations.unshift(reservation);
                    this.save();
                    
                    // Simpan ke Supabase jika online
                    if (this.isOnline) {
                        await this.saveReservationToSupabase(reservation);
                    }
                    
                    // Update order untuk menandai sudah ada reservasi
                    const orderIndex = this.orders.findIndex(o => o.id == reservation.orderId);
                    if (orderIndex !== -1) {
                        this.orders[orderIndex].hasReservation = true;
                        this.save();
                    }
                    
                    // Kirim ke admin
                    this.sendReservationToAdmin(reservation);
                    
                    debugLog(`‚úÖ Reservation added: ${reservation.id}`);
                    return reservation;
                    
                } catch (error) {
                    debugLog(`‚ùå Error adding reservation: ${error.message}`);
                    throw error;
                }
            }

            async saveReservationToSupabase(reservation) {
                try {
                    // Find order in Supabase
                    const order = this.orders.find(o => o.id == reservation.orderId);
                    if (!order || !order.supabase_id) {
                        throw new Error('Order not found in Supabase');
                    }

                    const { data, error } = await supabaseClient
                        .from('reservations')
                        .insert([{
                            order_id: order.supabase_id,
                            customer_name: reservation.name,
                            customer_phone: reservation.phone,
                            reservation_date: reservation.date,
                            reservation_time: reservation.time,
                            number_of_guests: reservation.guests,
                            notes: reservation.notes || '',
                            confirmed: false,
                            admin_seen: false
                        }])
                        .select()
                        .single();
                    
                    if (error) throw error;
                    
                    // Update order in Supabase
                    await supabaseClient
                        .from('orders')
                        .update({ has_reservation: true })
                        .eq('id', order.supabase_id);
                    
                    return data;
                    
                } catch (error) {
                    debugLog(`‚ùå Error saving reservation to Supabase: ${error.message}`);
                    throw error;
                }
            }

            // ==================== FUNGSI LAMA (COMPATIBILITY) ====================
           sendOrderToAdmin(order) {
    try {
        debugLog(`Sending order to admin system: ${order.orderNumber}`);
        
        // Simpan ke pending_orders untuk admin
        let pendingOrders = JSON.parse(localStorage.getItem('pending_orders')) || [];
        
        // Format data untuk admin
        const adminOrder = {
            id: order.id || Date.now(),
            supabase_id: order.supabase_id || null,
            orderNumber: order.orderNumber,
            customer: {
                name: order.customer?.name || 'Pelanggan',
                phone: order.customer?.phone || '',
                address: order.customer?.address || '-'
            },
            items: order.items || [],
            total: order.total || 0,
            orderType: order.orderType || 'dine_in',
            status: order.status || 'pending',
            paymentMethod: order.paymentMethod || 'transfer',
            paymentStatus: order.paymentStatus || 'pending',
            notes: order.notes || '',
            adminStatus: 'new', // Status khusus untuk admin
            adminSeen: false, // Belum dilihat admin
            payment_proof_url: null,
            createdAt: order.createdAt || new Date().toISOString(),
            hasReservation: order.hasReservation || false
        };
        
        // Cek apakah order sudah ada
        const existingIndex = pendingOrders.findIndex(o => o.orderNumber === order.orderNumber);
        
        if (existingIndex !== -1) {
            pendingOrders[existingIndex] = adminOrder;
        } else {
            pendingOrders.push(adminOrder);
        }
        
        localStorage.setItem('pending_orders', JSON.stringify(pendingOrders));
        
        // Simpan ke all_orders untuk admin
        let allOrders = JSON.parse(localStorage.getItem('all_orders')) || [];
        
        const duplicateIndex = allOrders.findIndex(o => o.orderNumber === order.orderNumber);
        if (duplicateIndex !== -1) {
            allOrders[duplicateIndex] = adminOrder;
        } else {
            allOrders.unshift(adminOrder);
        }
        
        localStorage.setItem('all_orders', JSON.stringify(allOrders));
        
        debugLog(`‚úÖ Order sent to admin system: ${order.orderNumber}`);
        debugLog(`Total pending orders: ${pendingOrders.length}`);
        debugLog(`Total all orders: ${allOrders.length}`);
        
        // Update admin notifications count
        updateAdminNotifications();
        
        return true;
        
    } catch (error) {
        debugLog(`‚ùå Error sending order to admin: ${error.message}`);
        return false;
    }
}

            sendReservationToAdmin(reservation) {
                try {
                    debugLog(`Sending reservation to admin system: ${reservation.id}`);
                    
                    // Simpan ke pending_reservations untuk admin
                    let pendingReservations = JSON.parse(localStorage.getItem('pending_reservations')) || [];
                    
                    const adminReservation = {
                        ...reservation,
                        adminSeen: false
                    };
                    
                    pendingReservations.push(adminReservation);
                    localStorage.setItem('pending_reservations', JSON.stringify(pendingReservations));
                    
                    debugLog(`Reservation sent to admin system: ${reservation.id}`);
                    
                    // Update admin notifications count
                    updateAdminNotifications();
                    
                    return true;
                    
                } catch (error) {
                    debugLog(`Error sending reservation to admin: ${error.message}`);
                    return false;
                }
            }

            getOrders() {
                return [...this.orders];
            }

            getReservations() {
                return [...this.reservations];
            }

            hasConfirmedOrders() {
                return this.orders.some(order => 
                    order.status === 'confirmed' || order.status === 'completed'
                );
            }

            getConfirmedOrders() {
                return this.orders.filter(order => 
                    order.status === 'confirmed' && order.orderType === 'dine_in'
                );
            }
        }

        // ============================
        // FUNGSI UTAMA
        // ============================

        // Fungsi untuk load menu items
        async function loadMenuItems() {
            debugLog('Loading menu items...');
            
            try {
                // Coba load dari Supabase
                const supabaseMenus = await customerSystem.loadMenusFromSupabase();
                
                if (supabaseMenus && supabaseMenus.length > 0) {
                    currentMenus = supabaseMenus;
                    debugLog(`Using ${supabaseMenus.length} menus from Supabase`);
                    renderMenus(supabaseMenus);
                    return;
                }
                
                // Fallback ke localStorage
                const savedMenus = JSON.parse(localStorage.getItem('cafe_menus') || '[]');
                if (savedMenus && savedMenus.length > 0) {
                    currentMenus = savedMenus;
                    debugLog(`Using ${savedMenus.length} menus from localStorage`);
                    renderMenus(savedMenus);
                    return;
                }
                
                // Fallback ke default menu
                debugLog('Using default menus');
                const defaultMenus = getDefaultMenuData();
                currentMenus = defaultMenus;
                localStorage.setItem('cafe_menus', JSON.stringify(defaultMenus));
                renderMenus(defaultMenus);
                
            } catch (error) {
                debugLog(`Error loading menus: ${error.message}`);
                
                // Fallback ke default
                const defaultMenus = getDefaultMenuData();
                currentMenus = defaultMenus;
                renderMenus(defaultMenus);
            }
        }

        // Fungsi untuk render menus
        function renderMenus(menus) {
            debugLog(`Rendering ${menus.length} menus`);
            
            const regularMenus = menus.filter(menu => !menu.isPromo);
            const promoMenus = menus.filter(menu => menu.isPromo);
            
            // Render featured menu
            const featuredGrid = document.getElementById('featured-menu');
            if (featuredGrid) {
                featuredGrid.innerHTML = '';
                regularMenus.slice(0, 4).forEach(item => {
                    featuredGrid.innerHTML += createMenuCard(item);
                });
                
                if (regularMenus.length === 0) {
                    featuredGrid.innerHTML = `
                        <div style="grid-column: 1 / -1; text-align: center; padding: 3rem; color: #666;">
                            <i class="fas fa-utensils" style="font-size: 3rem; margin-bottom: 1rem;"></i>
                            <h3>Menu sedang disiapkan</h3>
                            <p>Admin sedang menyiapkan menu untuk Anda</p>
                        </div>
                    `;
                }
            }
            
            // Render all menu
            const allMenuGrid = document.getElementById('all-menu-items');
            if (allMenuGrid) {
                allMenuGrid.innerHTML = '';
                menus.forEach(item => {
                    allMenuGrid.innerHTML += createMenuCard(item, true);
                });
                
                if (menus.length === 0) {
                    allMenuGrid.innerHTML = `
                        <div style="grid-column: 1 / -1; text-align: center; padding: 3rem; color: #666;">
                            <i class="fas fa-utensils" style="font-size: 3rem; margin-bottom: 1rem;"></i>
                            <h3>Belum ada menu tersedia</h3>
                            <p>Silakan hubungi admin untuk informasi lebih lanjut</p>
                        </div>
                    `;
                }
            }
            
            // Render promo menu
            const promoGrid = document.getElementById('promo-menu');
            if (promoGrid) {
                promoGrid.innerHTML = '';
                promoMenus.forEach(item => {
                    promoGrid.innerHTML += `
                        <div class="promo-card">
                            <span class="promo-badge"><i class="fas fa-tag"></i> Promo</span>
                            <img src="${item.image_url || item.image || 'https://via.placeholder.com/400x300?text=Menu+Promo'}" 
                                 alt="${item.name}"
                                 onerror="this.src='https://via.placeholder.com/400x300?text=Menu+Promo'">
                            <div class="promo-info">
                                <h3>${item.name}</h3>
                                <p class="description">${item.description || 'Tidak ada deskripsi'}</p>
                                <p class="price">
                                    ${item.originalPrice ? 
                                        `<span class="original-price">Rp ${item.originalPrice.toLocaleString()}</span>` : 
                                        ''
                                    }
                                    <span class="discount-price">Rp ${item.price.toLocaleString()}</span>
                                </p>
                                <button class="btn-order" onclick="addToCartFromMenu(${item.id})">
                                    <i class="fas fa-bolt"></i> Tambah ke Keranjang
                                </button>
                            </div>
                        </div>
                    `;
                });
                
                if (promoMenus.length === 0) {
                    promoGrid.innerHTML = `
                        <div style="grid-column: 1 / -1; text-align: center; padding: 3rem; color: #666;">
                            <i class="fas fa-tag" style="font-size: 3rem; margin-bottom: 1rem;"></i>
                            <h3>Tidak ada promo saat ini</h3>
                            <p>Nantikan promo menarik dari kami</p>
                        </div>
                    `;
                }
            }
        }

        // Fungsi untuk create menu card
        function createMenuCard(item, showCategory = false) {
            const safeItem = {
                id: item.id || Date.now(),
                name: item.name || 'Menu',
                description: item.description || 'Tidak ada deskripsi',
                price: item.price || 0,
                originalPrice: item.originalPrice,
                image: item.image_url || item.image || 'https://via.placeholder.com/400x300?text=Menu',
                category: item.category || 'minuman',
                isPromo: item.isPromo || false
            };

            return `
                <div class="menu-card" style="position: relative;">
                    ${safeItem.isPromo ? '<span class="promo-badge"><i class="fas fa-tag"></i> Promo</span>' : ''}
                    ${showCategory ? `<span class="promo-badge" style="background: ${getCategoryColor(safeItem.category)}; left: 1rem; right: auto;">${getCategoryText(safeItem.category)}</span>` : ''}
                    <img src="${safeItem.image}" 
                         alt="${safeItem.name}"
                         onerror="this.src='https://via.placeholder.com/400x300?text=${encodeURIComponent(safeItem.name)}'">
                    <div class="menu-info">
                        <h3>${safeItem.name}</h3>
                        <p class="description">${safeItem.description}</p>
                        ${safeItem.originalPrice ? 
                            `<p class="price">
                                <span class="original-price">Rp ${safeItem.originalPrice.toLocaleString()}</span>
                                <span class="discount-price">Rp ${safeItem.price.toLocaleString()}</span>
                            </p>` :
                            `<p class="price">Rp ${safeItem.price.toLocaleString()}</p>`
                        }
                        <button class="btn-order" onclick="addToCartFromMenu(${safeItem.id})">
                            <i class="fas fa-shopping-cart"></i> Tambah ke Keranjang
                        </button>
                    </div>
                </div>
            `;
        }

        // Fungsi untuk get category text
        function getCategoryText(category) {
            const categoryMap = {
                'minuman': 'Minuman',
                'makanan': 'Makanan',
                'snack': 'Snack',
                'dessert': 'Dessert'
            };
            return categoryMap[category] || category;
        }

        // Fungsi untuk get category color
        function getCategoryColor(category) {
            const colorMap = {
                'minuman': '#2196F3',
                'makanan': '#4CAF50',
                'snack': '#FF9800',
                'dessert': '#9C27B0'
            };
            return colorMap[category] || '#666';
        }

        // Fungsi untuk get default menu data
        function getDefaultMenuData() {
            return [
                { 
                    id: 1, 
                    name: "Espresso Premium", 
                    description: "Kopi espresso dengan cita rasa kuat dan aroma harum",
                    price: 35000, 
                    image: "https://images.unsplash.com/photo-1514432324607-a09d9b4aefdd?ixlib=rb-1.2.1&auto=format&fit=crop&w=400&h=300&q=80",
                    category: "minuman",
                    isPromo: false
                },
                { 
                    id: 2, 
                    name: "Cappuccino Special", 
                    description: "Espresso dengan susu steamed dan busa susu lembut",
                    price: 42000, 
                    image: "https://images.unsplash.com/photo-1567306226416-28f0efdc88ce?ixlib=rb-1.2.1&auto=format&fit=crop&w=400&h=300&q=80",
                    category: "minuman",
                    isPromo: false
                },
                { 
                    id: 3, 
                    name: "Croissant Almond", 
                    description: "Croissant renyah dengan isian almond paste",
                    price: 28000, 
                    image: "https://images.unsplash.com/photo-1555507036-ab794f27d2e9?ixlib=rb-1.2.1&auto=format&fit=crop&w=400&h=300&q=80",
                    category: "makanan",
                    isPromo: false
                },
                { 
                    id: 4, 
                    name: "Red Velvet Cake", 
                    description: "Kue velvet merah dengan cream cheese frosting",
                    price: 38000, 
                    image: "https://images.unsplash.com/photo-1578985545062-69928b1d9587?ixlib=rb-1.2.1&auto=format&fit=crop&w=400&h=300&q=80",
                    category: "dessert",
                    isPromo: false
                },
                { 
                    id: 5, 
                    name: "Latte Promo", 
                    description: "Latte dengan susu oat milk pilihan",
                    price: 32000, 
                    originalPrice: 45000,
                    image: "https://images.unsplash.com/photo-1561047029-3000c68339ca?ixlib=rb-1.2.1&auto=format&fit=crop&w=400&h=300&q=80",
                    category: "minuman",
                    isPromo: true
                }
            ];
        }

        // ============================
        // FUNGSI CART
        // ============================
        function addToCartFromMenu(menuId) {
            const menu = currentMenus.find(item => item.id == menuId);
            
            if (!menu) {
                debugLog('Menu not found with ID: ' + menuId);
                showToast('Menu tidak ditemukan', 'error');
                return;
            }
            
            const itemToAdd = {
                id: menu.id,
                name: menu.name,
                description: menu.description,
                price: menu.price,
                quantity: 1,
                image: menu.image || menu.image_url,
                category: menu.category
            };
            
            const existingItemIndex = cart.findIndex(cartItem => cartItem.id === itemToAdd.id);
            if (existingItemIndex !== -1) {
                cart[existingItemIndex].quantity += 1;
            } else {
                cart.push(itemToAdd);
            }
            
            updateCartCount();
            updateCartDisplay();
            showToast(`${itemToAdd.name} ditambahkan ke keranjang`, 'success');
            
            if (customerSystem) {
                customerSystem.cart = cart;
                customerSystem.save();
            }
            debugLog(`Added ${itemToAdd.name} to cart`);
        }

        function updateCartCount() {
            const count = cart.reduce((total, item) => total + item.quantity, 0);
            const cartCountElement = document.querySelector('.cart-count');
            if (cartCountElement) {
                cartCountElement.textContent = count;
            }
            
            if (customerSystem) {
                customerSystem.cart = cart;
                customerSystem.save();
            }
        }

        function updateOrdersCount() {
            if (!customerSystem) return;
            
            const pendingOrders = customerSystem.orders.filter(order => order.status === 'pending').length;
            const pendingReservations = customerSystem.reservations.filter(res => !res.confirmed).length;
            const totalPending = pendingOrders + pendingReservations;
            
            const ordersCountElement = document.querySelector('.orders-count');
            if (ordersCountElement) {
                ordersCountElement.textContent = totalPending;
                
                if (totalPending > 0) {
                    if (!ordersCountElement.querySelector('.notification-badge')) {
                        const badge = document.createElement('span');
                        badge.className = 'notification-badge';
                        badge.textContent = totalPending;
                        ordersCountElement.appendChild(badge);
                    } else {
                        ordersCountElement.querySelector('.notification-badge').textContent = totalPending;
                    }
                } else {
                    const badge = ordersCountElement.querySelector('.notification-badge');
                    if (badge) badge.remove();
                }
            }
        }

        function updateCartDisplay() {
            const container = document.getElementById('cart-items-container');
            const emptyMessage = document.getElementById('empty-cart-message');
            const totalDiv = document.getElementById('cart-total');
            const checkoutButtons = document.getElementById('checkout-buttons');
            
            if (!container) return;
            
            if (cart.length === 0) {
                container.innerHTML = '';
                if (emptyMessage) emptyMessage.style.display = 'block';
                if (totalDiv) totalDiv.style.display = 'none';
                if (checkoutButtons) checkoutButtons.style.display = 'none';
                return;
            }
            
            if (emptyMessage) emptyMessage.style.display = 'none';
            container.innerHTML = '';
            
            let total = 0;
            
            cart.forEach(item => {
                const itemTotal = item.price * item.quantity;
                total += itemTotal;
                
                container.innerHTML += `
                    <div class="cart-item">
                        <div style="flex: 1;">
                            <h4 style="margin: 0 0 0.3rem 0; font-size: 0.95rem;">${item.name}</h4>
                            <p style="margin: 0; font-size: 0.85rem; color: #666;">Rp ${item.price.toLocaleString()}</p>
                        </div>
                        <div style="display: flex; align-items: center; gap: 1rem;">
                            <div class="quantity-control">
                                <button class="quantity-btn" onclick="updateCartQuantity(${item.id}, ${item.quantity - 1})">-</button>
                                <span style="min-width: 20px; text-align: center;">${item.quantity}</span>
                                <button class="quantity-btn" onclick="updateCartQuantity(${item.id}, ${item.quantity + 1})">+</button>
                            </div>
                            <p style="font-weight: bold; font-size: 0.95rem;">Rp ${itemTotal.toLocaleString()}</p>
                            <button onclick="removeFromCart(${item.id})" style="color: #dc3545; background: none; border: none; cursor: pointer; padding: 0.3rem;">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                `;
            });
            
            if (totalDiv) {
                document.getElementById('total-amount').textContent = total.toLocaleString();
                totalDiv.style.display = 'block';
            }
            
            if (checkoutButtons) {
                checkoutButtons.style.display = 'flex';
            }
        }

        function updateCartQuantity(itemId, newQuantity) {
            if (newQuantity < 1) {
                removeFromCart(itemId);
                return;
            }
            const item = cart.find(item => item.id === itemId);
            if (item) {
                item.quantity = newQuantity;
                updateCartCount();
                updateCartDisplay();
                if (customerSystem) {
                    customerSystem.cart = cart;
                    customerSystem.save();
                }
            }
        }

        function removeFromCart(itemId) {
            cart = cart.filter(item => item.id !== itemId);
            updateCartCount();
            updateCartDisplay();
            if (customerSystem) {
                customerSystem.cart = cart;
                customerSystem.save();
            }
            showToast('Item dihapus dari keranjang', 'info');
            debugLog(`Removed item ${itemId} from cart`);
        }

        function clearCart() {
            if (confirm('Yakin ingin mengosongkan keranjang?')) {
                cart = [];
                updateCartCount();
                updateCartDisplay();
                showToast('Keranjang dikosongkan', 'info');
                debugLog('Cart cleared');
            }
        }

        // ============================
        // CHECKOUT FUNCTIONS - DIPERBAIKI
        // ============================
        function openCheckoutModal() {
            if (cart.length === 0) {
                showToast("Keranjang masih kosong", "error");
                return;
            }
            
            const modal = document.getElementById('checkoutModal');
            const summary = document.getElementById('order-summary-compact');
            
            if (!modal || !summary) return;
            
            let summaryHTML = '<h4 style="margin-top: 0; margin-bottom: 0.5rem;">Pesanan Anda:</h4>';
            let total = 0;
            
            cart.forEach(item => {
                const itemTotal = item.price * item.quantity;
                total += itemTotal;
                summaryHTML += `<div style="font-size: 0.85rem; margin-bottom: 0.3rem;">
                    ${item.name} (${item.quantity}x) <span style="float: right;">Rp ${itemTotal.toLocaleString()}</span>
                </div>`;
            });
            
            summaryHTML += `<div style="border-top: 1px solid #ddd; margin-top: 0.5rem; padding-top: 0.5rem; font-weight: bold;">
                Total <span style="float: right;">Rp ${total.toLocaleString()}</span>
            </div>`;
            summary.innerHTML = summaryHTML;
            
            // Reset form
            const checkoutForm = document.getElementById('checkoutForm');
            if (checkoutForm) checkoutForm.reset();
            
            const customerPhoneField = document.getElementById('customerPhone');
            if (customerPhoneField && customerSystem && customerSystem.customerPhone) {
                customerPhoneField.value = customerSystem.customerPhone;
            }
            
            const addressField = document.getElementById('addressField');
            if (addressField) addressField.style.display = 'none';
            
            modal.style.display = 'flex';
            debugLog('Checkout modal opened');
        }

        function toggleAddressField() {
            const orderType = document.getElementById('orderType');
            const addressField = document.getElementById('addressField');
            if (orderType && addressField) {
                addressField.style.display = orderType.value === 'takeaway' ? 'block' : 'none';
            }
        }

        // ============================
        // CHECKOUT PROCESS
        // ============================
       async function processCheckout(e) {
    e.preventDefault();
    
    debugLog('Processing checkout...');
    
    const submitBtn = document.getElementById('submitOrderBtn');
    if (!submitBtn) return;
    
    const originalText = submitBtn.innerHTML;
    submitBtn.disabled = true;
    submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Memproses...';
    
    try {
        // Validate cart
        if (cart.length === 0) {
            showToast("Keranjang masih kosong", "error");
            submitBtn.disabled = false;
            submitBtn.innerHTML = originalText;
            return;
        }
        
        // Get form data
        const customerName = document.getElementById('customerName')?.value.trim();
        const customerPhone = document.getElementById('customerPhone')?.value.trim();
        const orderType = document.getElementById('orderType')?.value;
        let customerAddress = '';
        
        if (orderType === 'takeaway') {
            customerAddress = document.getElementById('customerAddress')?.value.trim() || '';
        }
        
        // Validate input - PERBAIKI VALIDASI NOMOR TELEPON
        if (!customerName || customerName.length < 3) {
            showToast('Nama harus diisi (minimal 3 karakter)', 'error');
            submitBtn.disabled = false;
            submitBtn.innerHTML = originalText;
            return;
        }
        
        // Validasi nomor telepon yang lebih fleksibel
        if (!customerPhone) {
            showToast('Nomor telepon harus diisi', 'error');
            submitBtn.disabled = false;
            submitBtn.innerHTML = originalText;
            return;
        }
        
        // Hapus semua karakter non-digit untuk validasi
        const cleanPhone = customerPhone.replace(/\D/g, '');
        if (cleanPhone.length < 10 || cleanPhone.length > 15) {
            showToast('Nomor telepon harus 10-15 digit angka', 'error');
            submitBtn.disabled = false;
            submitBtn.innerHTML = originalText;
            return;
        }
        
        if (!orderType) {
            showToast('Pilih tipe pesanan', 'error');
            submitBtn.disabled = false;
            submitBtn.innerHTML = originalText;
            return;
        }
        
        if (orderType === 'takeaway' && (!customerAddress || customerAddress.length < 10)) {
            showToast('Alamat harus diisi minimal 10 karakter untuk takeaway', 'error');
            submitBtn.disabled = false;
            submitBtn.innerHTML = originalText;
            return;
        }
        
        // Calculate total
        const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
        
        // Prepare order data - PASTIKAN items tidak undefined
        const orderData = {
            customer: {
                name: customerName,
                phone: cleanPhone, // Gunakan nomor yang sudah dibersihkan
                address: customerAddress || '-'
            },
            orderType: orderType,
            items: cart.map(item => ({
                id: item.id || Date.now(),
                name: item.name || 'Item',
                price: item.price || 0,
                quantity: item.quantity || 1
            })),
            total: total,
            notes: ''
        };
        
        debugLog(`Checkout data prepared: ${JSON.stringify(orderData)}`);
        
        if (!customerSystem) {
            throw new Error('Sistem pelanggan belum diinisialisasi');
        }
        
        // Add order using customer system
        const order = await customerSystem.addOrder(orderData);
        
        if (!order) {
            throw new Error('Gagal membuat pesanan');
        }
        
        debugLog(`Order created successfully: ${order.orderNumber}`);
        
        // Close modal
        closeModal('checkoutModal');
        
        // Clear cart
        cart = [];
        updateCartCount();
        updateCartDisplay();
        
        // Show success message
        showToast(`‚úÖ Pesanan berhasil! No. Order: ${order.orderNumber}`, "success");
        
        // Show transfer instructions
        setTimeout(() => {
            showTransferInstructions(order.orderNumber, total);
        }, 1000);
        
        // Refresh orders display
        if (typeof showOrders === 'function') {
            showOrders('all');
        }
        
        // Scroll to orders section
        const ordersSection = document.getElementById('my-orders');
        if (ordersSection) {
            ordersSection.scrollIntoView({ behavior: 'smooth' });
        }
        
        debugLog(`Checkout completed successfully for order: ${order.orderNumber}`);
        
    } catch (error) {
        debugLog(`Checkout error: ${error.message}`);
        debugLog(`Cart: ${JSON.stringify(cart)}`);
        showToast("‚ùå Gagal memproses pesanan: " + error.message, "error");
    } finally {
        submitBtn.disabled = false;
        submitBtn.innerHTML = originalText;
    }
}


        // Fungsi untuk menampilkan instruksi transfer
        function showTransferInstructions(orderNumber, total) {
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.style.display = 'flex';
            modal.innerHTML = `
                <div class="modal-content" style="max-width: 500px;">
                    <span class="close-modal" onclick="this.parentElement.parentElement.style.display='none'">&times;</span>
                    <h2><i class="fas fa-university" style="color: #28a745;"></i> Instruksi Transfer</h2>
                    <div class="bank-info" style="margin: 1rem 0;">
                        <h4>Transfer ke Rekening MAN CAFE</h4>
                        <p><strong>Bank BCA:</strong></p>
                        <div class="account-number" style="font-size: 1.4rem; font-weight: bold; letter-spacing: 3px; padding: 1rem; background: #f8f9fa; border: 2px dashed #28a745;">
                            123 456 7890
                        </div>
                        <p>a.n. <strong>MAN CAFE</strong></p>
                        <p><strong>Jumlah Transfer:</strong> Rp ${total.toLocaleString()}</p>
                        <p><strong>No. Order:</strong> <span style="background: #f0f9ff; padding: 0.3rem 0.8rem; border-radius: 4px; font-weight: bold; color: #1e40af;">${orderNumber}</span></p>
                        <div style="background: #fff3cd; padding: 0.8rem; border-radius: 6px; margin: 1rem 0; border-left: 4px solid #ffc107;">
                            <p style="margin: 0; font-size: 0.85rem; color: #856404;">
                                <i class="fas fa-exclamation-circle"></i> 
                                <strong>Penting:</strong> Harap transfer sesuai jumlah di atas. Setelah transfer, Anda dapat upload bukti transfer di halaman "Pesanan Saya".
                            </p>
                        </div>
                        <p><small>Status Sync: ${customerSystem && customerSystem.isOnline ? '‚úÖ Online' : 'üì¥ Offline (akan sync otomatis saat online)'}</small></p>
                    </div>
                    <div style="display: flex; gap: 1rem; margin-top: 1rem;">
                        <button class="modal-submit-btn" onclick="window.location.hash='#my-orders'; this.parentElement.parentElement.style.display='none'" style="flex: 1;">
                            <i class="fas fa-clipboard-list"></i> Lihat Pesanan Saya
                        </button>
                        <button class="modal-submit-btn" onclick="this.parentElement.parentElement.style.display='none'" style="flex: 1; background: #6c757d;">
                            <i class="fas fa-times"></i> Tutup
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
            
            // Auto close after 30 seconds
            setTimeout(() => {
                if (modal.parentElement) {
                    modal.style.display = 'none';
                }
            }, 30000);
        }

        // ============================
        // ORDERS FUNCTIONS
        // ============================
        function showOrders(filter) {
            if (!customerSystem) return;
            
            const container = document.getElementById('orders-container');
            if (!container) return;
            
            // Update active tab
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            const clickedBtn = event?.target.closest('.tab-btn');
            if (clickedBtn) {
                clickedBtn.classList.add('active');
            }
            
            if (filter === 'reservations') {
                displayReservations(container);
                return;
            }
            
            const orders = customerSystem.getOrders();
            let filteredOrders = orders;
            
            if (filter === 'pending') {
                filteredOrders = orders.filter(order => order.status === 'pending');
            } else if (filter === 'confirmed') {
                filteredOrders = orders.filter(order => 
                    order.status === 'confirmed' || order.status === 'completed'
                );
            }
            
            displayOrders(filteredOrders, container);
            
            debugLog(`Showing ${filteredOrders.length} ${filter} orders`);
        }

        function displayOrders(ordersList, container) {
    if (!container) return;
    
    if (ordersList.length === 0) {
        container.innerHTML = `
            <div class="no-orders">
                <i class="fas fa-clipboard-list"></i>
                <h3>Tidak ada pesanan</h3>
                <p>Belum ada pesanan yang Anda buat</p>
            </div>
        `;
        return;
    }
    
    container.innerHTML = ordersList.map(order => {
        const statusText = {
            'pending': 'Menunggu Konfirmasi',
            'confirmed': 'Dikonfirmasi',
            'completed': 'Selesai',
            'cancelled': 'Dibatalkan'
        };
        
        const statusClass = {
            'pending': 'status-pending',
            'confirmed': 'status-confirmed',
            'completed': 'status-completed',
            'cancelled': 'status-cancelled'
        };
        
        // Pastikan items ada
        const items = Array.isArray(order.items) ? order.items : [];
        
        // Cek apakah bisa reservasi (pesanan dikonfirmasi dan dine_in)
        const canReserve = order.status === 'confirmed' && 
                         order.orderType === 'dine_in' && 
                         !order.hasReservation;
        
        return `
            <div class="order-card" data-order-id="${order.id}">
                <div class="order-header">
                    <div class="order-number">${order.orderNumber}</div>
                    <span class="order-status ${statusClass[order.status]}">
                        ${statusText[order.status] || order.status}
                    </span>
                </div>
                <div class="order-details">
                    <div class="detail-item">
                        <strong>Nama:</strong> ${order.customer?.name || 'Tidak ada'}
                    </div>
                    <div class="detail-item">
                        <strong>Tanggal:</strong> ${order.createdAt ? new Date(order.createdAt).toLocaleDateString('id-ID') : 'Tidak diketahui'}
                    </div>
                    <div class="detail-item">
                        <strong>Total:</strong> Rp ${order.total ? order.total.toLocaleString() : '0'}
                    </div>
                    <div class="detail-item">
                        <strong>Tipe:</strong> ${order.orderType === 'dine_in' ? 'Makan di Tempat' : 'Bawa Pulang'}
                    </div>
                    <div class="detail-item">
                        <strong>Pembayaran:</strong> Transfer Bank
                    </div>
                </div>
                <div class="order-items">
                    <h4>Items Pesanan:</h4>
                    ${items.length > 0 ? items.map(item => `
                        <div class="order-item">
                            <span>${item.name || 'Item'} (${item.quantity || 1}x)</span>
                            <span>Rp ${((item.price || 0) * (item.quantity || 1)).toLocaleString()}</span>
                        </div>
                    `).join('') : '<p>Tidak ada item</p>'}
                    <div class="order-total">
                        Total: Rp ${order.total ? order.total.toLocaleString() : '0'}
                    </div>
                </div>
                <div class="order-actions">
                    <button class="action-btn action-details" onclick="viewOrderDetail(${order.id})">
                        <i class="fas fa-eye"></i> Detail
                    </button>
                    ${order.status === 'pending' ? `
                    <button class="action-btn action-cancel" onclick="cancelOrderCustomer(${order.id})">
                        <i class="fas fa-times"></i> Batalkan
                    </button>` : ''}
                    ${canReserve ? `
                    <button class="action-btn action-reservation" onclick="openReservationModal(${order.id})">
                        <i class="fas fa-calendar-alt"></i> Reservasi Meja
                    </button>` : ''}
                    ${order.hasReservation ? `
                    <button class="action-btn action-details" onclick="viewReservation(${order.id})">
                        <i class="fas fa-calendar-check"></i> Lihat Reservasi
                    </button>` : ''}
                </div>
            </div>
        `;
    }).join('');
}
        function displayReservations(container) {
            if (!customerSystem || !container) return;
            
            const reservations = customerSystem.getReservations();
            
            if (reservations.length === 0) {
                container.innerHTML = `
                    <div class="no-orders">
                        <i class="fas fa-calendar-alt"></i>
                        <h3>Tidak ada reservasi</h3>
                        <p>Belum ada reservasi yang Anda buat</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = reservations.map(res => `
                <div class="order-card">
                    <div class="order-header">
                        <div class="order-number">Reservasi #${res.id.toString().slice(-6)}</div>
                        <span class="order-status ${res.confirmed ? 'status-confirmed' : 'status-pending'}">
                            ${res.confirmed ? 'Dikonfirmasi' : 'Menunggu'}
                        </span>
                    </div>
                    <div class="order-details">
                        <div class="detail-item">
                            <strong>Nama:</strong> ${res.name}
                        </div>
                        <div class="detail-item">
                            <strong>Tanggal:</strong> ${res.date ? new Date(res.date).toLocaleDateString('id-ID') : '-'}
                        </div>
                        <div class="detail-item">
                            <strong>Waktu:</strong> ${res.time || '-'}
                        </div>
                        <div class="detail-item">
                            <strong>Jumlah:</strong> ${res.guests || 1} orang
                        </div>
                        <div class="detail-item">
                            <strong>Catatan:</strong> ${res.notes || '-'}
                        </div>
                    </div>
                    <div class="order-actions">
                        <button class="action-btn action-details" onclick="viewReservationDetail(${res.id})">
                            <i class="fas fa-eye"></i> Detail
                        </button>
                    </div>
                </div>
            `).join('');
        }

        // ============================
        // DETAIL ORDER FUNCTIONS
        // ============================
        function viewOrderDetail(orderId) {
            if (!customerSystem) return;
            
            try {
                const order = customerSystem.orders.find(o => o.id == orderId);
                if (!order) {
                    showToast('Pesanan tidak ditemukan', 'error');
                    return;
                }
                
                const modal = document.getElementById('orderDetailModal');
                const content = document.getElementById('order-detail-content');
                if (!modal || !content) return;
                
                const statusText = {
                    'pending': 'Menunggu Konfirmasi',
                    'confirmed': 'Dikonfirmasi',
                    'completed': 'Selesai',
                    'cancelled': 'Dibatalkan'
                };
                
                const statusClass = {
                    'pending': 'status-pending',
                    'confirmed': 'status-confirmed',
                    'completed': 'status-completed',
                    'cancelled': 'status-cancelled'
                };
                
                let reservationButton = '';
                if (order.status === 'confirmed' && order.orderType === 'dine_in' && !order.hasReservation) {
                    reservationButton = `
                        <button class="action-btn action-reservation" onclick="openReservationModal(${order.id})" style="margin-top: 1rem; width: 100%;">
                            <i class="fas fa-calendar-alt"></i> Reservasi Meja
                        </button>
                    `;
                }
                
                content.innerHTML = `
                    <h2 style="margin-bottom: 1rem; color: var(--primary-color);">Detail Pesanan</h2>
                    
                    <div style="background: #f8f9fa; padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                            <h3 style="margin: 0; font-size: 1.1rem;">${order.orderNumber}</h3>
                            <span class="order-status ${statusClass[order.status]}">
                                ${statusText[order.status] || order.status}
                            </span>
                        </div>
                        <p style="margin: 0; color: #666; font-size: 0.9rem;">
                            ${new Date(order.createdAt).toLocaleString('id-ID')}
                        </p>
                    </div>
                    
                    <div style="margin-bottom: 1rem;">
                        <h4 style="margin-bottom: 0.5rem; color: #555;">Informasi Pelanggan</h4>
                        <div style="background: white; border: 1px solid #eee; border-radius: 6px; padding: 1rem;">
                            <div style="margin-bottom: 0.5rem;">
                                <strong>Nama:</strong> ${order.customer.name}
                            </div>
                            <div style="margin-bottom: 0.5rem;">
                                <strong>Telepon:</strong> ${order.customer.phone}
                            </div>
                            <div>
                                <strong>Alamat:</strong> ${order.customer.address || '-'}
                            </div>
                        </div>
                    </div>
                    
                    <div style="margin-bottom: 1rem;">
                        <h4 style="margin-bottom: 0.5rem; color: #555;">Detail Pesanan</h4>
                        <div style="background: white; border: 1px solid #eee; border-radius: 6px; padding: 1rem;">
                            <div style="margin-bottom: 0.5rem;">
                                <strong>Tipe Pesanan:</strong> ${order.orderType === 'dine_in' ? 'Makan di Tempat' : 'Bawa Pulang'}
                            </div>
                            <div style="margin-bottom: 0.5rem;">
                                <strong>Metode Pembayaran:</strong> ${order.paymentMethod === 'transfer' ? 'Transfer Bank' : order.paymentMethod}
                            </div>
                            <div>
                                <strong>Status Pembayaran:</strong> ${order.paymentStatus === 'pending' ? 'Menunggu' : 'Lunas'}
                            </div>
                        </div>
                    </div>
                    
                    <div style="margin-bottom: 1rem;">
                        <h4 style="margin-bottom: 0.5rem; color: #555;">Items Pesanan</h4>
                        <div style="background: white; border: 1px solid #eee; border-radius: 6px; padding: 1rem;">
                            ${order.items.map(item => `
                                <div style="display: flex; justify-content: space-between; padding: 0.5rem 0; border-bottom: 1px dashed #eee;">
                                    <div>
                                        <strong>${item.name}</strong><br>
                                        <small style="color: #666;">${item.quantity} x Rp ${item.price.toLocaleString()}</small>
                                    </div>
                                    <div style="font-weight: bold;">
                                        Rp ${(item.price * item.quantity).toLocaleString()}
                                    </div>
                                </div>
                            `).join('')}
                            <div style="display: flex; justify-content: space-between; padding-top: 0.5rem; border-top: 2px solid #ddd; margin-top: 0.5rem; font-weight: bold; font-size: 1.1rem;">
                                <span>Total</span>
                                <span>Rp ${order.total.toLocaleString()}</span>
                            </div>
                        </div>
                    </div>
                    
                    ${order.notes ? `
                    <div style="margin-bottom: 1rem;">
                        <h4 style="margin-bottom: 0.5rem; color: #555;">Catatan</h4>
                        <div style="background: #fff3cd; border: 1px solid #ffeaa7; border-radius: 6px; padding: 1rem; color: #856404;">
                            ${order.notes}
                        </div>
                    </div>
                    ` : ''}
                    
                    ${reservationButton}
                    
                    <div style="display: flex; gap: 0.5rem; margin-top: 1rem;">
                        <button class="action-btn action-details" onclick="closeModal('orderDetailModal')" style="flex: 1;">
                            <i class="fas fa-times"></i> Tutup
                        </button>
                        ${order.status === 'pending' ? `
                        <button class="action-btn action-cancel" onclick="cancelOrderCustomer(${order.id})" style="flex: 1;">
                            <i class="fas fa-times"></i> Batalkan Pesanan
                        </button>` : ''}
                    </div>
                `;
                
                modal.style.display = 'flex';
                debugLog(`Showing order detail: ${order.orderNumber}`);
                
            } catch (error) {
                debugLog(`Error viewing order detail: ${error.message}`);
                showToast('Gagal memuat detail pesanan', 'error');
            }
        }

        function viewReservation(reservationId) {
            showToast('Fitur lihat reservasi akan segera tersedia', 'info');
        }

        function viewReservationDetail(reservationId) {
            if (!customerSystem) return;
            
            try {
                const reservation = customerSystem.reservations.find(r => r.id == reservationId);
                if (!reservation) {
                    showToast('Reservasi tidak ditemukan', 'error');
                    return;
                }
                
                const modal = document.createElement('div');
                modal.className = 'modal';
                modal.style.display = 'flex';
                modal.innerHTML = `
                    <div class="modal-content" style="max-width: 500px;">
                        <span class="close-modal" onclick="this.parentElement.parentElement.style.display='none'">&times;</span>
                        <h2 style="margin-bottom: 1rem; color: var(--primary-color);">Detail Reservasi</h2>
                        
                        <div style="background: #f8f9fa; padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                                <h3 style="margin: 0; font-size: 1.1rem;">Reservasi #${reservation.id.toString().slice(-6)}</h3>
                                <span class="order-status ${reservation.confirmed ? 'status-confirmed' : 'status-pending'}">
                                    ${reservation.confirmed ? 'Dikonfirmasi' : 'Menunggu'}
                                </span>
                            </div>
                            <p style="margin: 0; color: #666; font-size: 0.9rem;">
                                ${new Date(reservation.createdAt).toLocaleString('id-ID')}
                            </p>
                        </div>
                        
                        <div style="margin-bottom: 1rem;">
                            <h4 style="margin-bottom: 0.5rem; color: #555;">Informasi Reservasi</h4>
                            <div style="background: white; border: 1px solid #eee; border-radius: 6px; padding: 1rem;">
                                <div style="margin-bottom: 0.5rem;">
                                    <strong>Nama:</strong> ${reservation.name}
                                </div>
                                <div style="margin-bottom: 0.5rem;">
                                    <strong>Telepon:</strong> ${reservation.phone}
                                </div>
                                <div style="margin-bottom: 0.5rem;">
                                    <strong>Tanggal:</strong> ${reservation.date ? new Date(reservation.date).toLocaleDateString('id-ID') : '-'}
                                </div>
                                <div style="margin-bottom: 0.5rem;">
                                    <strong>Waktu:</strong> ${reservation.time || '-'}
                                </div>
                                <div style="margin-bottom: 0.5rem;">
                                    <strong>Jumlah Tamu:</strong> ${reservation.guests || 1} orang
                                </div>
                                ${reservation.notes ? `
                                <div>
                                    <strong>Catatan:</strong><br>
                                    <div style="background: #fff3cd; padding: 0.5rem; border-radius: 4px; margin-top: 0.5rem; color: #856404;">
                                        ${reservation.notes}
                                    </div>
                                </div>
                                ` : ''}
                            </div>
                        </div>
                        
                        <button class="modal-submit-btn" onclick="this.parentElement.parentElement.style.display='none'">
                            <i class="fas fa-times"></i> Tutup
                        </button>
                    </div>
                `;
                
                document.body.appendChild(modal);
                debugLog(`Showing reservation detail: ${reservation.id}`);
                
            } catch (error) {
                debugLog(`Error viewing reservation detail: ${error.message}`);
                showToast('Gagal memuat detail reservasi', 'error');
            }
        }

        // ============================
        // RESERVATION FUNCTIONS
        // ============================
        function openReservationModal(orderId) {
            if (!customerSystem) return;
            
            try {
                const order = customerSystem.orders.find(o => o.id == orderId);
                if (!order) {
                    showToast('Pesanan tidak ditemukan', 'error');
                    return;
                }
                
                // Cek apakah sudah ada reservasi
                if (order.hasReservation) {
                    showToast('Pesanan ini sudah memiliki reservasi', 'info');
                    return;
                }
                
                // Set order ID di form
                document.getElementById('reservationOrderId').value = orderId;
                
                // Set informasi pesanan
                document.getElementById('reservationOrderText').innerHTML = `
                    <strong>No. Order:</strong> ${order.orderNumber}<br>
                    <strong>Total:</strong> Rp ${order.total.toLocaleString()}<br>
                    <strong>Jumlah Item:</strong> ${order.items.length} item
                `;
                
                // Set default values
                document.getElementById('name').value = order.customer.name;
                document.getElementById('phone').value = order.customer.phone;
                
                // Set min date untuk tanggal (hari ini)
                const today = new Date().toISOString().split('T')[0];
                document.getElementById('date').min = today;
                
                // Reset form lainnya
                document.getElementById('date').value = '';
                document.getElementById('time').value = '';
                document.getElementById('guests').value = '';
                document.getElementById('notes').value = '';
                
                // Tampilkan modal
                document.getElementById('reservationModal').style.display = 'flex';
                debugLog(`Opening reservation modal for order: ${order.orderNumber}`);
                
            } catch (error) {
                debugLog(`Error opening reservation modal: ${error.message}`);
                showToast('Gagal membuka form reservasi', 'error');
            }
        }

        // ============================
        // UTILITY FUNCTIONS
        // ============================
        function showToast(message, type = 'success') {
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.innerHTML = `
                <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'}"></i>
                <span>${message}</span>
            `;
            document.body.appendChild(toast);
            setTimeout(() => toast.classList.add('show'), 100);
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => toast.remove(), 300);
            }, 3000);
            
            debugLog(`Toast: ${type} - ${message}`);
        }

        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.style.display = 'none';
                debugLog(`Modal ${modalId} closed`);
            }
        }

        function cancelOrderCustomer(orderId) {
            if (confirm('Yakin ingin membatalkan pesanan ini?')) {
                showToast('Fitur pembatalan pesanan akan segera tersedia', 'info');
            }
        }

        // Fungsi untuk update notifikasi admin
        function updateAdminNotifications() {
    try {
        // Update count untuk admin side
        const pendingOrders = JSON.parse(localStorage.getItem('pending_orders') || '[]');
        const newOrders = pendingOrders.filter(order => 
            order.adminStatus === 'new' || order.adminSeen === false
        );
        
        const pendingReservations = JSON.parse(localStorage.getItem('pending_reservations') || '[]');
        const newReservations = pendingReservations.filter(res => !res.adminSeen);
        
        const totalNotifications = newOrders.length + newReservations.length;
        
        // Simpan ke localStorage untuk admin
        localStorage.setItem('admin_notification_count', totalNotifications.toString());
        
        debugLog(`‚úÖ Admin notifications updated: ${totalNotifications} new items`);
        debugLog(`- New orders: ${newOrders.length}`);
        debugLog(`- New reservations: ${newReservations.length}`);
        
    } catch (error) {
        debugLog(`‚ùå Error updating admin notifications: ${error.message}`);
    }
}

       // ============================
// INISIALISASI SAAT DOKUMEN LOAD - DIPERBAIKI
// ============================

document.addEventListener('DOMContentLoaded', async function() {
    // Panggil di awal inisialisasi
migrateOldData();
    console.log('üì± Document loaded, initializing system...');
    debugLog('Document loaded');
    
    try {
        // Inisialisasi sistem pelanggan
        customerSystem = new CustomerSystem();
        await customerSystem.init();
        
        // Load cart dari sistem
        cart = customerSystem.cart || [];
        
        // Setup UI
        updateCartCount();
        updateOrdersCount();
        updateCartDisplay();
        
        // Load menus
        setTimeout(async () => {
            try {
                await loadMenuItems();
            } catch (menuError) {
                console.error('Error loading menus:', menuError);
                debugLog('Error loading menus: ' + menuError.message);
            }
        }, 100);
        
        // Load initial orders
        setTimeout(() => {
            try {
                if (typeof showOrders === 'function') {
                    showOrders('all');
                }
            } catch (orderError) {
                console.error('Error loading orders:', orderError);
                debugLog('Error loading orders: ' + orderError.message);
            }
        }, 200);
        
        // Setup event listeners untuk form checkout - PASTIKAN TERHUBUNG
        const checkoutForm = document.getElementById('checkoutForm');
        if (checkoutForm) {
            // Hapus listener lama jika ada
            checkoutForm.removeEventListener('submit', processCheckout);
            // Tambah listener baru
            checkoutForm.addEventListener('submit', function(e) {
                debugLog('Checkout form submitted');
                processCheckout(e);
            });
            
            debugLog('Checkout form event listener attached');
        } else {
            debugLog('ERROR: Checkout form not found!');
        }
        
        // Setup event listener untuk reservation form
        const reservationForm = document.getElementById('reservationForm');
        if (reservationForm) {
            reservationForm.addEventListener('submit', function(e) {
                e.preventDefault();
                handleReservationSubmit(e);
            });
        }
        
        // Setup tombol checkout di keranjang
        const checkoutButton = document.querySelector('[onclick="openCheckoutModal()"]');
        if (checkoutButton) {
            checkoutButton.addEventListener('click', openCheckoutModal);
        }
        
        // Setup tombol "Checkout" di modal
        const modalCheckoutBtn = document.querySelector('.modal-submit-btn#submitOrderBtn');
        if (modalCheckoutBtn) {
            modalCheckoutBtn.addEventListener('click', function(e) {
                if (checkoutForm) {
                    checkoutForm.dispatchEvent(new Event('submit'));
                }
            });
        }
        
        // Setup UI listeners
        window.addEventListener('scroll', function() {
            const header = document.getElementById('header');
            if (header) {
                if (window.scrollY > 50) {
                    header.classList.add('scrolled');
                } else {
                    header.classList.remove('scrolled');
                }
            }
        });

        const hamburger = document.getElementById('hamburger');
        if (hamburger) {
            hamburger.addEventListener('click', function() {
                const navLinks = document.getElementById('navLinks');
                if (navLinks) {
                    navLinks.classList.toggle('active');
                }
            });
        }
        

        // Smooth scroll
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });
                    
                    // Update active nav link
                    document.querySelectorAll('.nav-links a').forEach(link => {
                        link.classList.remove('active');
                    });
                    this.classList.add('active');
                    
                    // Tutup menu mobile jika terbuka
                    const navLinks = document.getElementById('navLinks');
                    if (navLinks && navLinks.classList.contains('active')) {
                        navLinks.classList.remove('active');
                    }
                }
            });
        });
        
        // Handle modal close dengan ESC
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                const modals = document.querySelectorAll('.modal');
                modals.forEach(modal => {
                    if (modal.style.display === 'flex') {
                        modal.style.display = 'none';
                    }
                });
            }
        });

        // Handle modal close dengan klik di luar
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('modal')) {
                e.target.style.display = 'none';
            }
        });
        
        console.log('üéâ Sistem siap digunakan!');
        debugLog('System ready');
        showToast('Sistem siap digunakan!', 'success');
        
        // Auto test connection
        setTimeout(() => {
            if (customerSystem && !customerSystem.isOnline) {
                debugLog('‚ö†Ô∏è Running in offline mode - testing connection');
                testSupabaseConnection();
            }
        }, 2000);
        
        // Auto-sync setiap 30 detik
        setInterval(async () => {
            if (customerSystem && customerSystem.isOnline) {
                try {
                    await customerSystem.processSyncQueue();
                    await customerSystem.syncDataFromSupabase();
                    
                    if (window.location.hash === '#my-orders') {
                        showOrders('all');
                    }
                } catch (syncError) {
                    console.error('Sync error:', syncError);
                    debugLog('Sync error: ' + syncError.message);
                }
            }
        }, 30000);
        
    } catch (error) {
        console.error('‚ùå Error during initialization:', error);
        debugLog(`Initialization error: ${error.message}`);
        showToast('Gagal menginisialisasi sistem: ' + error.message, 'error');
        
        // Fallback: load default menus even if system fails
        setTimeout(() => {
            try {
                const defaultMenus = getDefaultMenuData();
                currentMenus = defaultMenus;
                renderMenus(defaultMenus);
                showToast('Sistem offline - menggunakan menu default', 'info');
            } catch (fallbackError) {
                console.error('Fallback error:', fallbackError);
            }
        }, 500);
    }
});

        // Helper function untuk handle reservation submit
        async function handleReservationSubmit(e) {
            e.preventDefault();
            
            try {
                const orderId = document.getElementById('reservationOrderId').value;
                const name = document.getElementById('name').value.trim();
                const phone = document.getElementById('phone').value.trim();
                const date = document.getElementById('date').value;
                const time = document.getElementById('time').value;
                const guests = document.getElementById('guests').value;
                const notes = document.getElementById('notes').value.trim();
                
                // Validation
                if (!name || !phone || !date || !time || !guests) {
                    showToast('Harap isi semua field yang wajib', 'error');
                    return;
                }
                
                const reservationData = {
                    orderId: orderId,
                    name: name,
                    phone: phone,
                    date: date,
                    time: time,
                    guests: parseInt(guests),
                    notes: notes
                };
                
                if (!customerSystem) {
                    throw new Error('Sistem pelanggan belum diinisialisasi');
                }
                
                const reservation = await customerSystem.addReservation(reservationData);
                
                closeModal('reservationModal');
                showToast('‚úÖ Reservasi berhasil dibuat!', 'success');
                showOrders('confirmed');
                
            } catch (error) {
                debugLog(`Error in reservation: ${error.message}`);
                showToast('Gagal membuat reservasi: ' + error.message, 'error');
            }
        }
        
    
    // ============================
    // DEBUG FUNCTIONS YANG DITAMBAHKAN
    // ============================

        function checkAdminSystem() {
            const pendingOrders = JSON.parse(localStorage.getItem('pending_orders') || '[]');
            const allOrders = JSON.parse(localStorage.getItem('all_orders') || '[]');
            
            debugLog(`=== CHECK ADMIN SYSTEM ===`);
            debugLog(`Pending orders: ${pendingOrders.length}`);
            debugLog(`All orders: ${allOrders.length}`);
            
            if (pendingOrders.length > 0) {
                debugLog(`Latest order: ${JSON.stringify(pendingOrders[0])}`);
            }
            
            showToast(`Admin system check: ${pendingOrders.length} pending orders`, 'info');
        }

        // Test function untuk melihat apakah order masuk ke admin
        async function testAdminOrder() {
            const testOrder = {
                orderNumber: 'TEST-' + Date.now(),
                customer: {
                    name: 'Test Customer',
                    phone: '081234567890',
                    address: 'Test Address'
                },
                items: [
                    { name: 'Test Item 1', price: 10000, quantity: 2 },
                    { name: 'Test Item 2', price: 15000, quantity: 1 }
                ],
                total: 35000,
                orderType: 'dine_in',
                status: 'pending',
                paymentStatus: 'pending',
                adminStatus: 'new',
                adminSeen: false,
                createdAt: new Date().toISOString()
            };
            
            // Simpan ke pending_orders
            let pendingOrders = JSON.parse(localStorage.getItem('pending_orders') || '[]');
            pendingOrders.push(testOrder);
            localStorage.setItem('pending_orders', JSON.stringify(pendingOrders));
            
            // Simpan ke all_orders
            let allOrders = JSON.parse(localStorage.getItem('all_orders') || '[]');
            allOrders.unshift(testOrder);
            localStorage.setItem('all_orders', JSON.stringify(allOrders));
            
            updateAdminNotifications();
            
            debugLog(`Test order added: ${testOrder.orderNumber}`);
            showToast(`Test order ${testOrder.orderNumber} added to admin system`, 'success');
            
            return testOrder;
        }
    

    // ============================
    // INISIALISASI DEBUG PANEL TAMBAHAN
    // ============================
    document.addEventListener('DOMContentLoaded', function() {
        // Tunggu sistem utama selesai inisialisasi
        setTimeout(() => {
            // Tambah tombol debug ke debug panel yang sudah ada
            const debugPanel = document.getElementById('debugPanel');
            if (debugPanel) {
                // Cari tempat untuk menambahkan tombol baru
                const buttonsDiv = debugPanel.querySelector('div');
                if (buttonsDiv) {
                    // Tambah tombol baru untuk check admin system
                    const checkAdminBtn = document.createElement('button');
                    checkAdminBtn.className = 'debug-btn';
                    checkAdminBtn.innerHTML = '<i class="fas fa-user-cog"></i> Check Admin';
                    checkAdminBtn.onclick = checkAdminSystem;
                    buttonsDiv.appendChild(checkAdminBtn);
                    
                    // Tambah tombol baru untuk test admin order
                    const testAdminBtn = document.createElement('button');
                    testAdminBtn.className = 'debug-btn blue';
                    testAdminBtn.innerHTML = '<i class="fas fa-test"></i> Test Admin Order';
                    testAdminBtn.onclick = testAdminOrder;
                    buttonsDiv.appendChild(testAdminBtn);
                }
            }
        }, 2000);
    });
    // Fungsi untuk migrasi data lama ke struktur baru
function migrateOldData() {
    try {
        debugLog('Checking for old data migration...');
        
        // Cek data orders lama
        const customerOrders = JSON.parse(localStorage.getItem('customer_orders') || '[]');
        const pendingOrders = JSON.parse(localStorage.getItem('pending_orders') || '[]');
        
        // Jika ada customer orders tapi pending orders kosong, copy data
        if (customerOrders.length > 0 && pendingOrders.length === 0) {
            debugLog(`Migrating ${customerOrders.length} old orders to admin system`);
            
            customerOrders.forEach(order => {
                const adminOrder = {
                    id: order.id,
                    orderNumber: order.orderNumber,
                    customer: order.customer || { name: 'Pelanggan', phone: '', address: '-' },
                    items: order.items || [],
                    total: order.total || 0,
                    orderType: order.orderType || 'dine_in',
                    status: order.status || 'pending',
                    paymentMethod: order.paymentMethod || 'transfer',
                    paymentStatus: order.paymentStatus || 'pending',
                    adminStatus: 'new',
                    adminSeen: false,
                    payment_proof_url: null,
                    createdAt: order.createdAt || new Date().toISOString(),
                    hasReservation: order.hasReservation || false
                };
                
                pendingOrders.push(adminOrder);
            });
            
            localStorage.setItem('pending_orders', JSON.stringify(pendingOrders));
            localStorage.setItem('all_orders', JSON.stringify(pendingOrders));
            
            debugLog('‚úÖ Data migration completed');
        }
        
    } catch (error) {
        debugLog(`Migration error: ${error.message}`);
    }
}
</script>
</body>
</html>